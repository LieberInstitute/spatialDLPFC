Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br6522_ant...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  462.82187069039963 840.3738053488773 438.454465345922
Var of x,y,z =  25947801.564846624 21998488.613430697 25947801.56484662
Run 1: l [0.01, 1000], p [0.0, 24.63745526033335]
Run 2: l [0.01, 500.005], p [0.0, 3.6240739822387695]
Run 3: l [250.0075, 500.005], p [0.4419480562210083, 3.6240739822387695]
Run 4: l [250.0075, 375.00625], p [0.4419480562210083, 1.5597238540649414]
Run 5: l [250.0075, 312.50687500000004], p [0.4419480562210083, 0.896551251411438]
Run 6: l [250.0075, 281.2571875], p [0.4419480562210083, 0.6451306343078613]
Run 7: l [250.0075, 265.63234375], p [0.4419480562210083, 0.5377687215805054]
Run 8: l [257.819921875, 265.63234375], p [0.48844921588897705, 0.5377687215805054]
Run 9: l [257.819921875, 261.7261328125], p [0.48844921588897705, 0.5127525329589844]
recommended l =  259.77302734374996
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
delta_label  0.004885993485342019 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 25
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
delta_label  0.004653327128897162 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 31
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
delta_label  0.004653327128897162 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 25
Res =  0.8999999999999999 Num of clusters =  8
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  0.85
Epoch  0
Epoch  10
Epoch  20
Epoch  30
delta_label  0.003489995346672871 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 34
Res =  0.85 Num of clusters =  7
recommended res =  0.85
Initializing cluster centers with louvain, resolution =  0.85
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.85
Epoch  0
Epoch  10
Epoch  20
delta_label  0.0037226617031177293 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 25
Initializing cluster centers with louvain, resolution =  0.85
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.842307692307692, 430.6461538461538]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.842307692307692, 145.63846153846154]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.842307692307692, 57.75576923076923]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.842307692307692, 24.20576923076923]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.675
radius= 3.0240485668182373 average number of neighbors for each spot is 12.675
 Cluster 0 has neighbors:
Dmain  6 :  2216
Dmain  4 :  609
Dmain  5 :  236
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000162545', 'ENSG00000171617', 'ENSG00000128989', 'ENSG00000171476', 'ENSG00000115756']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 1.675735
Number of non-target spots reduced to: 633
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000128245
Minus gene:  ENSG00000110436
Absolute mean change: 2.450863
Number of non-target spots reduced to: 400
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971+ENSG00000128245-ENSG00000110436
===========================================================================
Add gene:  ENSG00000110436
Minus gene:  ENSG00000109846
Absolute mean change: 2.7537956
Number of non-target spots reduced to: 244
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971+ENSG00000128245-ENSG00000110436+ENSG00000110436-ENSG00000109846
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.692520775623269, 440.94875346260386]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.692520775623269, 144.24515235457065]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.692520775623269, 56.55263157894737]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.692520775623269, 23.725761772853186]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.457063711911358
radius= 3.0240485668182373 average number of neighbors for each spot is 12.457063711911358
 Cluster 1 has neighbors:
Dmain  6 :  893
SVGs for domain  1 : ['ENSG00000131095']
Add gene:  ENSG00000251562
Minus gene:  ENSG00000197971
Absolute mean change: 1.6287458
Number of non-target spots reduced to: 1325
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000197971
===========================================================================
Add gene:  ENSG00000171885
Minus gene:  ENSG00000154146
Absolute mean change: 3.0281177
Number of non-target spots reduced to: 173
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000197971+ENSG00000171885-ENSG00000154146
===========================================================================
Add gene:  ENSG00000228253
Minus gene:  ENSG00000128656
Absolute mean change: 4.133651
Number of non-target spots reduced to: 27
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000197971+ENSG00000171885-ENSG00000154146+ENSG00000228253-ENSG00000128656
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.756211180124224, 445.5698757763975]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.756211180124224, 146.277950310559]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.756211180124224, 57.161490683229815]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.756211180124224, 23.922360248447205]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.551242236024844
radius= 3.0240485668182373 average number of neighbors for each spot is 12.551242236024844
 Cluster 2 has neighbors:
Dmain  4 :  1946
Dmain  5 :  1355
Dmain  3 :  702
Dmain  6 :  340
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000198763']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198712
Absolute mean change: 0.63736963
Number of non-target spots reduced to: 2135
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000197971-ENSG00000198712
===========================================================================
Add gene:  ENSG00000212907
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 2135 857 0.63736963 0.07022214
Previous Number of non-target spots 2135 857 0.63736963 0.07022214
Previous Number of non-target spots 2135
Current Number of non-target spots 857
Absolute mean change 0.63736963
===========================================================================
Meta gene:  ENSG00000198763+ENSG00000197971-ENSG00000198712
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.88256880733945, 459.4807339449541]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.88256880733945, 149.67889908256882]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.88256880733945, 58.45137614678899]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.88256880733945, 24.377981651376146]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.763302752293578
radius= 3.0240485668182373 average number of neighbors for each spot is 12.763302752293578
 Cluster 3 has neighbors:
Dmain  2 :  702
SVGs for domain  3 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000091513']
Add gene:  ENSG00000166091
Minus gene:  ENSG00000198938
Absolute mean change: 3.1089349
Number of non-target spots reduced to: 313
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000166091-ENSG00000198938
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000166091-ENSG00000198938
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.91989319092123, 443.8384512683578]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.91989319092123, 147.71829105473967]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.91989319092123, 58.416555407209614]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.91989319092123, 24.46995994659546]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.822429906542055
radius= 3.0240485668182373 average number of neighbors for each spot is 12.822429906542055
 Cluster 4 has neighbors:
Dmain  5 :  2034
Dmain  2 :  1946
Dmain  0 :  609
Dmain  6 :  495
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 4 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 4!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.726495726495726, 424.68589743589746]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.726495726495726, 142.10042735042734]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.726495726495726, 56.35042735042735]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.726495726495726, 23.75854700854701]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.487179487179487
radius= 3.0240485668182373 average number of neighbors for each spot is 12.487179487179487
 Cluster 5 has neighbors:
Dmain  4 :  2034
Dmain  2 :  1355
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000269028', 'ENSG00000198888', 'ENSG00000198786', 'ENSG00000212907', 'ENSG00000228253']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000269028
Absolute mean change: 0.38139367
Number of non-target spots reduced to: 1060
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000197971-ENSG00000269028
===========================================================================
Add gene:  ENSG00000198763
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 1060 1469 0.38139367 0.45267534
Previous Number of non-target spots 1060 1469 0.38139367 0.45267534
Previous Number of non-target spots 1060
Current Number of non-target spots 1469
Absolute mean change 0.38139367
===========================================================================
Meta gene:  ENSG00000269028+ENSG00000197971-ENSG00000269028
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.69076923076923, 420.41076923076923]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.69076923076923, 140.13692307692307]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.69076923076923, 55.667692307692306]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.69076923076923, 23.563076923076924]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.412307692307692
radius= 3.0240485668182373 average number of neighbors for each spot is 12.412307692307692
 Cluster 6 has neighbors:
Dmain  0 :  2216
Dmain  1 :  893
Dmain  4 :  495
Dmain  2 :  340
Dmain  5 :  287
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000115756']
Add gene:  ENSG00000172137
Minus gene:  ENSG00000197971
Absolute mean change: 1.0679388
Number of non-target spots reduced to: 1563
===========================================================================
Meta gene is:  ENSG00000115756+ENSG00000172137-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 1563 700 1.0679388 0.7417233
Previous Number of non-target spots 1563 700 1.0679388 0.7417233
Previous Number of non-target spots 1563
Current Number of non-target spots 700
Absolute mean change 1.0679388
===========================================================================
Meta gene:  ENSG00000115756+ENSG00000172137-ENSG00000197971
===========================================================================
