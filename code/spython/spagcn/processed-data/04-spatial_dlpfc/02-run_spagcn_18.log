Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br6471_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  523.6224301336173 901.2658351320945 400.5725678040111
Var of x,y,z =  23600094.573887933 26757200.68411562 26757200.68411562
Run 1: l [0.01, 1000], p [0.0, 18.00496825136681]
Run 2: l [0.01, 500.005], p [0.0, 2.4996705055236816]
Run 3: l [250.0075, 500.005], p [0.2973560094833374, 2.4996705055236816]
Run 4: l [250.0075, 375.00625], p [0.2973560094833374, 1.0614354610443115]
Run 5: l [250.0075, 312.50687500000004], p [0.2973560094833374, 0.606544017791748]
Run 6: l [281.2571875, 312.50687500000004], p [0.4352869987487793, 0.606544017791748]
Run 7: l [281.2571875, 296.88203125], p [0.4352869987487793, 0.5165505409240723]
Run 8: l [289.069609375, 296.88203125], p [0.47485220432281494, 0.5165505409240723]
recommended l =  292.9758203125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
delta_label  0.0041841004184100415 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 58
Res =  0.7 Num of clusters =  7
recommended res =  0.7
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
delta_label  0.0041841004184100415 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 34
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
delta_label  0.0041841004184100415 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 157
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
delta_label  0.003963884606914776 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 40
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
delta_label  0.004844747852895838 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 37
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
delta_label  0.0030830213609337152 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 82
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.451472191930208, 374.58996728462375]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.451472191930208, 138.57470010905126]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.451472191930208, 51.92039258451472]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.451472191930208, 22.49400218102508]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=11.988004362050164
radius= 3.0375672578811646 average number of neighbors for each spot is 11.988004362050164
 Cluster 0 has neighbors:
Dmain  5 :  865
SVGs for domain  0 : ['ENSG00000131095']
Add gene:  ENSG00000269028
Minus gene:  ENSG00000167996
Absolute mean change: 1.7171535
Number of non-target spots reduced to: 807
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000269028-ENSG00000167996
===========================================================================
Add gene:  ENSG00000113140
Minus gene:  ENSG00000111640
Absolute mean change: 3.4259162
Number of non-target spots reduced to: 99
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000269028-ENSG00000167996+ENSG00000113140-ENSG00000111640
===========================================================================
Add gene:  ENSG00000228253
Minus gene:  ENSG00000197971
Absolute mean change: 4.438877
Number of non-target spots reduced to: 21
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000269028-ENSG00000167996+ENSG00000113140-ENSG00000111640+ENSG00000228253-ENSG00000197971
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.862116991643454, 499.55153203342616]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.862116991643454, 167.33983286908077]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.862116991643454, 58.82451253481894]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.862116991643454, 24.370473537604457]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.740947075208913
radius= 3.0375672578811646 average number of neighbors for each spot is 12.740947075208913
 Cluster 1 has neighbors:
Dmain  6 :  1353
Dmain  3 :  907
Dmain  4 :  574
SVGs for domain  1 : ['ENSG00000034510', 'ENSG00000132639', 'ENSG00000087460', 'ENSG00000117632', 'ENSG00000150625', 'ENSG00000067715', 'ENSG00000104888', 'ENSG00000156298', 'ENSG00000050165']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000130558
Absolute mean change: 1.4977603
Number of non-target spots reduced to: 415
===========================================================================
Meta gene is:  ENSG00000034510+ENSG00000197971-ENSG00000130558
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 415 531 1.4977603 1.5043969
Previous Number of non-target spots 415 531 1.4977603 1.5043969
Previous Number of non-target spots 415
Current Number of non-target spots 531
Absolute mean change 1.4977603
===========================================================================
Meta gene:  ENSG00000034510+ENSG00000197971-ENSG00000130558
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.846830985915492, 479.0968309859155]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.846830985915492, 164.44894366197184]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.846830985915492, 58.2887323943662]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.846830985915492, 24.234154929577464]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.721830985915492
radius= 3.0375672578811646 average number of neighbors for each spot is 12.721830985915492
 Cluster 2 has neighbors:
Dmain  5 :  1488
Dmain  3 :  1095
Dmain  6 :  542
SVGs for domain  2 : ['ENSG00000171617', 'ENSG00000162545', 'ENSG00000115310', 'ENSG00000128989', 'ENSG00000020129', 'ENSG00000214548']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 1.8744583
Number of non-target spots reduced to: 672
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000104722
Stopped! Previous Number of non-target spots 672 244 1.8744583 1.2679949
Previous Number of non-target spots 672 244 1.8744583 1.2679949
Previous Number of non-target spots 672
Current Number of non-target spots 244
Absolute mean change 1.8744583
===========================================================================
Meta gene:  ENSG00000171617+ENSG00000115756-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.927835051546392, 518.039764359352]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.927835051546392, 171.02503681885125]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.927835051546392, 59.661266568483065]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.927835051546392, 24.653902798232696]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.861561119293079
radius= 3.0375672578811646 average number of neighbors for each spot is 12.861561119293079
 Cluster 3 has neighbors:
Dmain  6 :  2503
Dmain  2 :  1095
Dmain  1 :  907
Dmain  5 :  561
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000228253']
Add gene:  ENSG00000172020
Minus gene:  ENSG00000228253
Absolute mean change: 0.1908899
Number of non-target spots reduced to: 1366
===========================================================================
Meta gene is:  ENSG00000228253+ENSG00000172020-ENSG00000228253
===========================================================================
Add gene:  ENSG00000228253
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 1366 1535 0.1908899 0.26106882
Previous Number of non-target spots 1366 1535 0.1908899 0.26106882
Previous Number of non-target spots 1366
Current Number of non-target spots 1535
Absolute mean change 0.1908899
===========================================================================
Meta gene:  ENSG00000228253+ENSG00000172020-ENSG00000228253
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.695555555555556, 382.68666666666667]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.695555555555556, 144.74]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.695555555555556, 54.49333333333333]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.695555555555556, 23.40222222222222]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.384444444444444
radius= 3.0375672578811646 average number of neighbors for each spot is 12.384444444444444
 Cluster 4 has neighbors:
Dmain  1 :  574
SVGs for domain  4 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000131095', 'ENSG00000109846', 'ENSG00000173786', 'ENSG00000099194', 'ENSG00000160307', 'ENSG00000244274', 'ENSG00000168314']
Add gene:  ENSG00000136541
Minus gene:  ENSG00000132639
Absolute mean change: 3.6283476
Number of non-target spots reduced to: 15
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000136541-ENSG00000132639
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000136541-ENSG00000132639
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.642023346303501, 453.84824902723733]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.642023346303501, 155.83463035019454]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.642023346303501, 55.80739299610895]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.642023346303501, 23.488326848249027]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.367704280155642
radius= 3.0375672578811646 average number of neighbors for each spot is 12.367704280155642
 Cluster 5 has neighbors:
Dmain  2 :  1488
Dmain  0 :  865
Dmain  3 :  561
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000198763', 'ENSG00000101439', 'ENSG00000162545', 'ENSG00000010404', 'ENSG00000228253', 'ENSG00000135821', 'ENSG00000110436', 'ENSG00000020129', 'ENSG00000224078', 'ENSG00000214548']
Add gene:  ENSG00000251562
Minus gene:  ENSG00000034510
Absolute mean change: 0.85470533
Number of non-target spots reduced to: 1713
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000251562-ENSG00000034510
===========================================================================
Add gene:  ENSG00000128989
Minus gene:  ENSG00000251562
Stopped! Previous Number of non-target spots 1713 852 0.85470533 0.72061396
Previous Number of non-target spots 1713 852 0.85470533 0.72061396
Previous Number of non-target spots 1713
Current Number of non-target spots 852
Absolute mean change 0.85470533
===========================================================================
Meta gene:  ENSG00000198763+ENSG00000251562-ENSG00000034510
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.912230215827337, 508.32374100719426]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.912230215827337, 168.93956834532375]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.912230215827337, 59.26187050359712]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.912230215827337, 24.528057553956835]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.818705035971224
radius= 3.0375672578811646 average number of neighbors for each spot is 12.818705035971224
 Cluster 6 has neighbors:
Dmain  3 :  2503
Dmain  1 :  1353
Dmain  2 :  542
SVGs for domain  6 : ['ENSG00000123416', 'ENSG00000154146', 'ENSG00000111640', 'ENSG00000132639', 'ENSG00000189043', 'ENSG00000152583', 'ENSG00000128245', 'ENSG00000277586', 'ENSG00000109971', 'ENSG00000154277', 'ENSG00000196262', 'ENSG00000014641', 'ENSG00000143153', 'ENSG00000163399', 'ENSG00000104435', 'ENSG00000104722', 'ENSG00000173267']
Add gene:  ENSG00000104722
Minus gene:  ENSG00000197971
Absolute mean change: 1.917665
Number of non-target spots reduced to: 373
===========================================================================
Meta gene is:  ENSG00000123416+ENSG00000104722-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000135821
Absolute mean change: 2.0285192
Number of non-target spots reduced to: 256
===========================================================================
Meta gene is:  ENSG00000123416+ENSG00000104722-ENSG00000197971+ENSG00000197971-ENSG00000135821
===========================================================================
Add gene:  ENSG00000277586
Minus gene:  ENSG00000197971
Absolute mean change: 3.1979156
Number of non-target spots reduced to: 200
===========================================================================
Meta gene is:  ENSG00000123416+ENSG00000104722-ENSG00000197971+ENSG00000197971-ENSG00000135821+ENSG00000277586-ENSG00000197971
===========================================================================
