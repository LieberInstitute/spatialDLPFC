Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
Continuing with sample Br2720_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  466.96029749436957 834.0066734635406 359.10609093256295
Var of x,y,z =  23729105.31943414 27741465.077839844 27741465.07783984
Run 1: l [0.01, 1000], p [0.0, 24.978329855854106]
Run 2: l [0.01, 500.005], p [0.0, 3.6373367309570312]
Run 3: l [250.0075, 500.005], p [0.43923842906951904, 3.6373367309570312]
Run 4: l [250.0075, 375.00625], p [0.43923842906951904, 1.5606815814971924]
Run 5: l [250.0075, 312.50687500000004], p [0.43923842906951904, 0.8952469825744629]
Run 6: l [250.0075, 281.2571875], p [0.43923842906951904, 0.6430319547653198]
Run 7: l [250.0075, 265.63234375], p [0.43923842906951904, 0.5353366136550903]
Run 8: l [257.819921875, 265.63234375], p [0.48587024211883545, 0.5353366136550903]
Run 9: l [257.819921875, 261.7261328125], p [0.48587024211883545, 0.5102452039718628]
recommended l =  259.77302734374996
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  7
recommended res =  0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.877822045152723, 509.52589641434264]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.877822045152723, 169.5019920318725]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.877822045152723, 59.330677290836654]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.877822045152723, 24.50464807436919]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.786188579017264
radius= 3.0542476177215576 average number of neighbors for each spot is 12.786188579017264
 Cluster 0 has neighbors:
Dmain  2 :  2866
Dmain  4 :  1494
Dmain  5 :  725
Dmain  3 :  481
Dmain  6 :  202
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000203930', 'ENSG00000282885']
Add gene:  ENSG00000198763
Minus gene:  ENSG00000203930
Absolute mean change: 0.59192276
Number of non-target spots reduced to: 1659
===========================================================================
Meta gene is:  ENSG00000203930+ENSG00000198763-ENSG00000203930
===========================================================================
Add gene:  ENSG00000163513
Minus gene:  ENSG00000154146
Stopped! Previous Number of non-target spots 1659 1227 0.59192276 0.43902946
Previous Number of non-target spots 1659 1227 0.59192276 0.43902946
Previous Number of non-target spots 1659
Current Number of non-target spots 1227
Absolute mean change 0.59192276
===========================================================================
Meta gene:  ENSG00000203930+ENSG00000198763-ENSG00000203930
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.774193548387096, 428.9791271347249]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.774193548387096, 154.36148007590134]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.774193548387096, 56.44686907020873]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.774193548387096, 23.859582542694497]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.55123339658444
radius= 3.0542476177215576 average number of neighbors for each spot is 12.55123339658444
 Cluster 1 has neighbors:
Dmain  3 :  1511
Dmain  4 :  295
SVGs for domain  1 : ['ENSG00000123560', 'ENSG00000109846', 'ENSG00000160307', 'ENSG00000244274', 'ENSG00000091513']
Add gene:  ENSG00000160781
Minus gene:  ENSG00000198840
Absolute mean change: 2.8548727
Number of non-target spots reduced to: 261
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000160781-ENSG00000198840
===========================================================================
Add gene:  ENSG00000091513
Minus gene:  ENSG00000132639
Absolute mean change: 4.7959633
Number of non-target spots reduced to: 29
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000160781-ENSG00000198840+ENSG00000091513-ENSG00000132639
===========================================================================
Add gene:  ENSG00000117450
Minus gene:  ENSG00000198712
Absolute mean change: 6.1717114
Number of non-target spots reduced to: 11
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000160781-ENSG00000198840+ENSG00000091513-ENSG00000132639+ENSG00000117450-ENSG00000198712
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.927553444180523, 491.5391923990499]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.927553444180523, 167.11638954869358]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.927553444180523, 59.18646080760095]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.927553444180523, 24.578384798099762]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.853919239904988
radius= 3.0542476177215576 average number of neighbors for each spot is 12.853919239904988
 Cluster 2 has neighbors:
Dmain  0 :  2866
Dmain  5 :  928
Dmain  4 :  606
SVGs for domain  2 : ['ENSG00000189043', 'ENSG00000111640', 'ENSG00000132639', 'ENSG00000277586']
Add gene:  ENSG00000100285
Minus gene:  ENSG00000101439
Absolute mean change: 1.8261943
Number of non-target spots reduced to: 259
===========================================================================
Meta gene is:  ENSG00000189043+ENSG00000100285-ENSG00000101439
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000133401
Absolute mean change: 3.0280075
Number of non-target spots reduced to: 134
===========================================================================
Meta gene is:  ENSG00000189043+ENSG00000100285-ENSG00000101439+ENSG00000132639-ENSG00000133401
===========================================================================
Add gene:  ENSG00000183036
Minus gene:  ENSG00000107758
Absolute mean change: 3.4679265
Number of non-target spots reduced to: 76
===========================================================================
Meta gene is:  ENSG00000189043+ENSG00000100285-ENSG00000101439+ENSG00000132639-ENSG00000133401+ENSG00000183036-ENSG00000107758
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.860232945091514, 501.0332778702163]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.860232945091514, 167.73044925124793]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.860232945091514, 58.983361064891845]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.860232945091514, 24.42928452579035]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.753743760399335
radius= 3.0542476177215576 average number of neighbors for each spot is 12.753743760399335
 Cluster 3 has neighbors:
Dmain  1 :  1511
Dmain  4 :  1226
Dmain  0 :  481
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000101439']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198899
Absolute mean change: 0.82260203
Number of non-target spots reduced to: 1606
===========================================================================
Meta gene is:  ENSG00000101439+ENSG00000197971-ENSG00000198899
===========================================================================
Add gene:  ENSG00000198899
Minus gene:  ENSG00000123560
Stopped! Previous Number of non-target spots 1606 1014 0.82260203 0.2873881
Previous Number of non-target spots 1606 1014 0.82260203 0.2873881
Previous Number of non-target spots 1606
Current Number of non-target spots 1014
Absolute mean change 0.82260203
===========================================================================
Meta gene:  ENSG00000101439+ENSG00000197971-ENSG00000198899
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.943686006825939, 501.3600682593857]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.943686006825939, 167.69453924914677]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.943686006825939, 59.19965870307167]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.943686006825939, 24.602389078498295]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.866894197952218
radius= 3.0542476177215576 average number of neighbors for each spot is 12.866894197952218
 Cluster 4 has neighbors:
Dmain  0 :  1494
Dmain  3 :  1226
Dmain  2 :  606
SVGs for domain  4 : ['ENSG00000132639', 'ENSG00000139970', 'ENSG00000128656', 'ENSG00000088986', 'ENSG00000067715', 'ENSG00000187094', 'ENSG00000150625', 'ENSG00000154096', 'ENSG00000156298', 'ENSG00000128989', 'ENSG00000171867', 'ENSG00000165023', 'ENSG00000171246']
Add gene:  ENSG00000165023
Minus gene:  ENSG00000198712
Absolute mean change: 1.0796337
Number of non-target spots reduced to: 812
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000165023-ENSG00000198712
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000183036
Absolute mean change: 1.8494418
Number of non-target spots reduced to: 446
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000165023-ENSG00000198712+ENSG00000187094-ENSG00000183036
===========================================================================
Add gene:  ENSG00000110436
Minus gene:  ENSG00000100285
Absolute mean change: 2.1686268
Number of non-target spots reduced to: 249
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000165023-ENSG00000198712+ENSG00000187094-ENSG00000183036+ENSG00000110436-ENSG00000100285
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.907894736842104, 437.53508771929825]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.907894736842104, 159.46491228070175]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.907894736842104, 58.00438596491228]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.907894736842104, 24.388157894736842]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.81140350877193
radius= 3.0542476177215576 average number of neighbors for each spot is 12.81140350877193
 Cluster 5 has neighbors:
Dmain  2 :  928
Dmain  0 :  725
Dmain  6 :  407
SVGs for domain  5 : ['ENSG00000162545', 'ENSG00000171617']
Add gene:  ENSG00000251562
Minus gene:  ENSG00000197971
Absolute mean change: 1.6799138
Number of non-target spots reduced to: 682
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000251562-ENSG00000197971
===========================================================================
Add gene:  ENSG00000198712
Minus gene:  ENSG00000251562
Absolute mean change: 1.9281898
Number of non-target spots reduced to: 426
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000251562-ENSG00000197971+ENSG00000198712-ENSG00000251562
===========================================================================
Add gene:  ENSG00000115756
Minus gene:  ENSG00000277586
Absolute mean change: 2.0838628
Number of non-target spots reduced to: 317
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000251562-ENSG00000197971+ENSG00000198712-ENSG00000251562+ENSG00000115756-ENSG00000277586
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.341836734693878, 340.51785714285717]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.341836734693878, 128.99744897959184]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.341836734693878, 50.255102040816325]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.341836734693878, 22.017857142857142]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=11.752551020408163
radius= 3.0542476177215576 average number of neighbors for each spot is 11.752551020408163
 Cluster 6 has neighbors:
Dmain  5 :  407
SVGs for domain  6 : ['ENSG00000251562', 'ENSG00000131095', 'ENSG00000282885']
Add gene:  ENSG00000282885
Minus gene:  ENSG00000132639
Absolute mean change: 2.796414
Number of non-target spots reduced to: 94
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000282885-ENSG00000132639
===========================================================================
Add gene:  ENSG00000244734
Minus gene:  ENSG00000197971
Absolute mean change: 4.9234324
Number of non-target spots reduced to: 20
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000282885-ENSG00000132639+ENSG00000244734-ENSG00000197971
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000282885-ENSG00000132639+ENSG00000244734-ENSG00000197971
