Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br2743_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  307.34256741275505 524.4375072616797 184.38408212053767
Var of x,y,z =  27057891.579277407 20550677.407113247 27057891.579277407
Run 1: l [0.01, 1000], p [0.0, 20.983184201059128]
Run 2: l [0.01, 500.005], p [0.0, 3.010463237762451]
Run 3: l [250.0075, 500.005], p [0.36565160751342773, 3.010463237762451]
Run 4: l [250.0075, 375.00625], p [0.36565160751342773, 1.2948009967803955]
Run 5: l [250.0075, 312.50687500000004], p [0.36565160751342773, 0.7444531917572021]
Run 6: l [250.0075, 281.2571875], p [0.36565160751342773, 0.5352634191513062]
Run 7: l [265.63234375, 281.2571875], p [0.4457191228866577, 0.5352634191513062]
Run 8: l [273.444765625, 281.2571875], p [0.4892805814743042, 0.5352634191513062]
Run 9: l [273.444765625, 277.3509765625], p [0.4892805814743042, 0.5119661092758179]
recommended l =  275.39787109375004
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  9
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.95 Num of clusters =  7
recommended res =  0.95
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.262676239013672], num_nbr [1.0, 365.671826625387]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.338444888591766], num_nbr [1.0, 117.85139318885449]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.376329213380814], num_nbr [1.0, 40.9969040247678]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.395271375775337], num_nbr [1.0, 19.667698658410732]
Calculateing adj matrix using xy only...
Run 5: radius [2.404742456972599, 3.395271375775337], num_nbr [8.648090815273477, 19.667698658410732]
Calculateing adj matrix using xy only...
recommended radius =  2.900006916373968 num_nbr=12.319917440660475
radius= 2.900006916373968 average number of neighbors for each spot is 12.319917440660475
 Cluster 0 has neighbors:
Dmain  3 :  1772
Dmain  6 :  823
Dmain  4 :  675
Dmain  2 :  630
Dmain  1 :  547
Dmain  5 :  458
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000197971']
Add gene:  ENSG00000240583
Minus gene:  ENSG00000132639
Absolute mean change: 0.7618749
Number of non-target spots reduced to: 2117
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000240583-ENSG00000132639
===========================================================================
Add gene:  ENSG00000198763
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 2117 321 0.7618749 0.7392745
Previous Number of non-target spots 2117 321 0.7618749 0.7392745
Previous Number of non-target spots 2117
Current Number of non-target spots 321
Absolute mean change 0.7618749
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000240583-ENSG00000132639
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.262676239013672], num_nbr [1.0, 400.94528301886794]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.338444888591766], num_nbr [1.0, 127.20943396226416]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.376329213380814], num_nbr [1.0, 43.471698113207545]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.395271375775337], num_nbr [1.0, 20.581132075471697]
Calculateing adj matrix using xy only...
Run 5: radius [2.404742456972599, 3.395271375775337], num_nbr [8.907547169811322, 20.581132075471697]
Calculateing adj matrix using xy only...
recommended radius =  2.900006916373968 num_nbr=12.80188679245283
radius= 2.900006916373968 average number of neighbors for each spot is 12.80188679245283
 Cluster 1 has neighbors:
Dmain  5 :  1980
Dmain  4 :  1020
Dmain  3 :  604
Dmain  0 :  547
Dmain  2 :  440
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000198763']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000198763
Absolute mean change: 0.20493665
Number of non-target spots reduced to: 1121
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000183036-ENSG00000198763
===========================================================================
Add gene:  ENSG00000198938
Minus gene:  ENSG00000183036
Stopped! Previous Number of non-target spots 1121 1321 0.20493665 0.5105002
Previous Number of non-target spots 1121 1321 0.20493665 0.5105002
Previous Number of non-target spots 1121
Current Number of non-target spots 1321
Absolute mean change 0.20493665
===========================================================================
Meta gene:  ENSG00000198763+ENSG00000183036-ENSG00000198763
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.262676239013672], num_nbr [1.0, 423.7142857142857]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.338444888591766], num_nbr [1.0, 129.94897959183675]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.376329213380814], num_nbr [1.0, 43.94642857142857]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.395271375775337], num_nbr [1.0, 20.73469387755102]
Calculateing adj matrix using xy only...
Run 5: radius [2.404742456972599, 3.395271375775337], num_nbr [8.948979591836734, 20.73469387755102]
Calculateing adj matrix using xy only...
recommended radius =  2.900006916373968 num_nbr=12.887755102040817
radius= 2.900006916373968 average number of neighbors for each spot is 12.887755102040817
 Cluster 2 has neighbors:
Dmain  3 :  1285
Dmain  5 :  692
Dmain  0 :  630
Dmain  1 :  440
Dmain  4 :  281
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 2 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 2!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.262676239013672], num_nbr [1.0, 393.4556313993174]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.338444888591766], num_nbr [1.0, 123.56143344709898]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.376329213380814], num_nbr [1.0, 42.77815699658703]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.395271375775337], num_nbr [1.0, 20.399317406143346]
Calculateing adj matrix using xy only...
Run 5: radius [2.404742456972599, 3.395271375775337], num_nbr [8.877133105802049, 20.399317406143346]
Calculateing adj matrix using xy only...
recommended radius =  2.900006916373968 num_nbr=12.728668941979523
radius= 2.900006916373968 average number of neighbors for each spot is 12.728668941979523
 Cluster 3 has neighbors:
Dmain  0 :  1772
Dmain  2 :  1285
Dmain  5 :  752
Dmain  1 :  604
Dmain  4 :  545
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000198804', 'ENSG00000101439']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000198804
Absolute mean change: 0.2867068
Number of non-target spots reduced to: 1484
===========================================================================
Meta gene is:  ENSG00000198804+ENSG00000131095-ENSG00000198804
===========================================================================
Add gene:  ENSG00000130203
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 1484 1369 0.2867068 0.1376059
Previous Number of non-target spots 1484 1369 0.2867068 0.1376059
Previous Number of non-target spots 1484
Current Number of non-target spots 1369
Absolute mean change 0.2867068
===========================================================================
Meta gene:  ENSG00000198804+ENSG00000131095-ENSG00000198804
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.262676239013672], num_nbr [1.0, 391.0946291560102]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.338444888591766], num_nbr [1.0, 124.60102301790282]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.376329213380814], num_nbr [1.0, 42.849104859335036]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.395271375775337], num_nbr [1.0, 20.32225063938619]
Calculateing adj matrix using xy only...
Run 5: radius [2.404742456972599, 3.395271375775337], num_nbr [8.831202046035806, 20.32225063938619]
Calculateing adj matrix using xy only...
recommended radius =  2.900006916373968 num_nbr=12.664961636828645
radius= 2.900006916373968 average number of neighbors for each spot is 12.664961636828645
 Cluster 4 has neighbors:
Dmain  5 :  1127
Dmain  1 :  1020
Dmain  0 :  675
Dmain  3 :  545
Dmain  2 :  281
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000198840', 'ENSG00000198712', 'ENSG00000198899', 'ENSG00000198938']
Add gene:  ENSG00000255153
Minus gene:  ENSG00000120885
Absolute mean change: 0.4336983
Number of non-target spots reduced to: 1250
===========================================================================
Meta gene is:  ENSG00000198840+ENSG00000255153-ENSG00000120885
===========================================================================
Add gene:  ENSG00000120885
Minus gene:  ENSG00000251562
Absolute mean change: 0.47109985
Number of non-target spots reduced to: 820
===========================================================================
Meta gene is:  ENSG00000198840+ENSG00000255153-ENSG00000120885+ENSG00000120885-ENSG00000251562
===========================================================================
Add gene:  ENSG00000251562
Minus gene:  ENSG00000120885
Stopped! Previous Number of non-target spots 820 1176 0.47109985 0.4336983
Previous Number of non-target spots 820 1176 0.47109985 0.4336983
Previous Number of non-target spots 820
Current Number of non-target spots 1176
Absolute mean change 0.47109985
===========================================================================
Meta gene:  ENSG00000198840+ENSG00000255153-ENSG00000120885+ENSG00000120885-ENSG00000251562
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.262676239013672], num_nbr [1.0, 417.45185185185187]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.338444888591766], num_nbr [1.0, 129.68444444444444]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.376329213380814], num_nbr [1.0, 43.69777777777778]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.395271375775337], num_nbr [1.0, 20.598518518518517]
Calculateing adj matrix using xy only...
Run 5: radius [2.404742456972599, 3.395271375775337], num_nbr [8.90074074074074, 20.598518518518517]
Calculateing adj matrix using xy only...
recommended radius =  2.900006916373968 num_nbr=12.797037037037038
radius= 2.900006916373968 average number of neighbors for each spot is 12.797037037037038
 Cluster 5 has neighbors:
Dmain  1 :  1980
Dmain  4 :  1127
Dmain  3 :  752
Dmain  2 :  692
Can't find any genes such that more spots in domain 5 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.262676239013672], num_nbr [1.0, 290.0062695924765]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.338444888591766], num_nbr [1.0, 99.27899686520377]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.376329213380814], num_nbr [1.0, 36.51724137931034]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.395271375775337], num_nbr [1.0, 17.88087774294671]
Calculateing adj matrix using xy only...
Run 5: radius [2.404742456972599, 3.395271375775337], num_nbr [8.031347962382446, 17.88087774294671]
Calculateing adj matrix using xy only...
recommended radius =  2.900006916373968 num_nbr=11.310344827586206
radius= 2.900006916373968 average number of neighbors for each spot is 11.310344827586206
 Cluster 6 has neighbors:
Dmain  0 :  823
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 6 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 6!
