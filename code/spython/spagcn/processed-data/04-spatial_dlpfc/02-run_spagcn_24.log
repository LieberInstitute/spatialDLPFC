Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8325_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  367.7490384405394 582.559840730511 265.8729869630503
Var of x,y,z =  22060880.997265957 27655987.891373254 27655987.891373247
Run 1: l [0.01, 1000], p [0.0, 18.506941430709595]
Run 2: l [0.01, 500.005], p [0.0, 2.6575512886047363]
Run 3: l [250.0075, 500.005], p [0.3311885595321655, 2.6575512886047363]
Run 4: l [250.0075, 375.00625], p [0.3311885595321655, 1.1534967422485352]
Run 5: l [250.0075, 312.50687500000004], p [0.3311885595321655, 0.6677231788635254]
Run 6: l [281.2571875, 312.50687500000004], p [0.48216724395751953, 0.6677231788635254]
Run 7: l [281.2571875, 296.88203125], p [0.48216724395751953, 0.5704509019851685]
Run 8: l [281.2571875, 289.069609375], p [0.48216724395751953, 0.5252069234848022]
recommended l =  285.1633984375
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  4
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  5
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  6
Res changed to 0.9999999999999999
Initializing cluster centers with louvain, resolution =  1.0999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.0999999999999999 Num of clusters =  8
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  1.0499999999999998
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.0499999999999998 Num of clusters =  7
recommended res =  1.0499999999999998
Initializing cluster centers with louvain, resolution =  1.0499999999999998
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.747282608695652, 426.4664855072464]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.747282608695652, 147.60507246376812]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.747282608695652, 55.95199275362319]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.747282608695652, 23.701992753623188]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.48822463768116
radius= 3.027443051338196 average number of neighbors for each spot is 12.48822463768116
 Cluster 0 has neighbors:
Dmain  4 :  3727
Dmain  2 :  1154
Dmain  3 :  913
Dmain  6 :  23
Dmain  5 :  4
SVGs for domain  0 : ['ENSG00000132639', 'ENSG00000154146', 'ENSG00000111640', 'ENSG00000034510', 'ENSG00000131711', 'ENSG00000143153', 'ENSG00000277586']
Add gene:  ENSG00000111674
Minus gene:  ENSG00000198899
Absolute mean change: 1.455414
Number of non-target spots reduced to: 222
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000111674-ENSG00000198899
===========================================================================
Add gene:  ENSG00000277586
Minus gene:  ENSG00000111674
Absolute mean change: 1.5833972
Number of non-target spots reduced to: 201
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000111674-ENSG00000198899+ENSG00000277586-ENSG00000111674
===========================================================================
Add gene:  ENSG00000111640
Minus gene:  ENSG00000167614
Absolute mean change: 2.2742567
Number of non-target spots reduced to: 155
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000111674-ENSG00000198899+ENSG00000277586-ENSG00000111674+ENSG00000111640-ENSG00000167614
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.709189189189189, 451.99783783783784]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.709189189189189, 152.84324324324325]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.709189189189189, 56.85405405405405]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.709189189189189, 23.736216216216217]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.486486486486486
radius= 3.027443051338196 average number of neighbors for each spot is 12.486486486486486
 Cluster 1 has neighbors:
Dmain  3 :  1569
Dmain  5 :  6
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000131095']
Add gene:  ENSG00000244734
Minus gene:  ENSG00000132639
Absolute mean change: 1.8984377
Number of non-target spots reduced to: 944
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000132639
===========================================================================
Add gene:  ENSG00000160307
Minus gene:  ENSG00000154146
Absolute mean change: 3.2366323
Number of non-target spots reduced to: 63
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000132639+ENSG00000160307-ENSG00000154146
===========================================================================
Add gene:  ENSG00000228253
Minus gene:  ENSG00000198668
Absolute mean change: 4.3654656
Number of non-target spots reduced to: 24
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000132639+ENSG00000160307-ENSG00000154146+ENSG00000228253-ENSG00000198668
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.841149773071104, 431.624810892587]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.841149773071104, 152.4765506807867]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.841149773071104, 57.62783661119516]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.841149773071104, 24.187594553706504]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.691376701966718
radius= 3.027443051338196 average number of neighbors for each spot is 12.691376701966718
 Cluster 2 has neighbors:
Dmain  3 :  2653
Dmain  0 :  1154
Dmain  4 :  921
Dmain  5 :  10
Dmain  6 :  7
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000162545', 'ENSG00000171617']
Add gene:  ENSG00000171617
Minus gene:  ENSG00000162545
Absolute mean change: 0.50294185
Number of non-target spots reduced to: 1130
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000171617-ENSG00000162545
===========================================================================
Add gene:  ENSG00000171476
Minus gene:  ENSG00000197971
Absolute mean change: 1.0244246
Number of non-target spots reduced to: 1012
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000171617-ENSG00000162545+ENSG00000171476-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000171476
Stopped! Previous Number of non-target spots 1012 513 1.0244246 0.50294185
Previous Number of non-target spots 1012 513 1.0244246 0.50294185
Previous Number of non-target spots 1012
Current Number of non-target spots 513
Absolute mean change 1.0244246
===========================================================================
Meta gene:  ENSG00000162545+ENSG00000171617-ENSG00000162545+ENSG00000171476-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.857302118171683, 441.5440356744705]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.857302118171683, 155.03567447045708]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.857302118171683, 58.21516164994426]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.857302118171683, 24.309921962095874]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.732441471571907
radius= 3.027443051338196 average number of neighbors for each spot is 12.732441471571907
 Cluster 3 has neighbors:
Dmain  2 :  2653
Dmain  1 :  1569
Dmain  4 :  1075
Dmain  0 :  913
Dmain  6 :  4
Dmain  5 :  4
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000087250', 'ENSG00000101439', 'ENSG00000162545']
Add gene:  ENSG00000137285
Minus gene:  ENSG00000132639
Absolute mean change: 0.36987305
Number of non-target spots reduced to: 1747
===========================================================================
Meta gene is:  ENSG00000087250+ENSG00000137285-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 1747 1068 0.36987305 0.20631623
Previous Number of non-target spots 1747 1068 0.36987305 0.20631623
Previous Number of non-target spots 1747
Current Number of non-target spots 1068
Absolute mean change 0.36987305
===========================================================================
Meta gene:  ENSG00000087250+ENSG00000137285-ENSG00000132639
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.812422360248448, 446.88695652173914]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.812422360248448, 154.23975155279504]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.812422360248448, 57.756521739130434]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.812422360248448, 24.142857142857142]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.647204968944099
radius= 3.027443051338196 average number of neighbors for each spot is 12.647204968944099
 Cluster 4 has neighbors:
Dmain  0 :  3727
Dmain  3 :  1075
Dmain  2 :  921
Dmain  6 :  9
Dmain  5 :  6
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000197971', 'ENSG00000123560']
Add gene:  ENSG00000198840
Minus gene:  ENSG00000197971
Absolute mean change: 0.19651651
Number of non-target spots reduced to: 994
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000198840-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198840
Stopped! Previous Number of non-target spots 994 1404 0.19651651 0.47797674
Previous Number of non-target spots 994 1404 0.19651651 0.47797674
Previous Number of non-target spots 994
Current Number of non-target spots 1404
Absolute mean change 0.19651651
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000198840-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [7.666666666666667, 311.3333333333333]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [7.666666666666667, 107.66666666666667]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [7.666666666666667, 43.333333333333336]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [7.666666666666667, 19.666666666666668]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=11.0
radius= 3.027443051338196 average number of neighbors for each spot is 11.0
 Cluster 5 has neighbors:
No neighbor domain found, try bigger radius or smaller ratio.
Found no neighbors for domain 5 . No SVGs will be found for this domain.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.5, 406.25]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.5, 138.25]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.5, 52.75]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.5, 23.0]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.0
radius= 3.027443051338196 average number of neighbors for each spot is 12.0
 Cluster 6 has neighbors:
No neighbor domain found, try bigger radius or smaller ratio.
Found no neighbors for domain 6 . No SVGs will be found for this domain.
