Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br6432_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  593.0834707787767 997.22504154085 507.94265207088466
Var of x,y,z =  19040282.015237615 15310291.434957348 19040282.015237615
Run 1: l [0.01, 1000], p [0.0, 26.93337928949353]
Run 2: l [0.01, 500.005], p [0.0, 4.152975559234619]
Run 3: l [0.01, 250.0075], p [0.0, 0.5102863311767578]
Run 4: l [125.00874999999999, 250.0075], p [0.027487993240356445, 0.5102863311767578]
Run 5: l [187.508125, 250.0075], p [0.18437707424163818, 0.5102863311767578]
Run 6: l [218.7578125, 250.0075], p [0.3239086866378784, 0.5102863311767578]
Run 7: l [234.38265625, 250.0075], p [0.41095924377441406, 0.5102863311767578]
Run 8: l [242.195078125, 250.0075], p [0.4590543508529663, 0.5102863311767578]
Run 9: l [246.1012890625, 250.0075], p [0.48427414894104004, 0.5102863311767578]
recommended l =  248.05439453125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  7
recommended res =  0.7
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
delta_label  0.004502944232767579 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 199
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
delta_label  0.004156563907170073 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 124
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.29705810546875], num_nbr [1.0, 289.67857142857144]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.355635821819305], num_nbr [1.0, 92.83928571428571]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.884924679994583], num_nbr [1.0, 33.005102040816325]
Calculateing adj matrix using xy only...
recommended radius =  3.149569109082222 num_nbr=11.903061224489797
radius= 3.149569109082222 average number of neighbors for each spot is 11.903061224489797
 Cluster 0 has neighbors:
Dmain  3 :  622
Dmain  4 :  364
Dmain  1 :  362
Dmain  5 :  335
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000171885']
Add gene:  ENSG00000244734
Minus gene:  ENSG00000132639
Absolute mean change: 1.1405168
Number of non-target spots reduced to: 1233
===========================================================================
Meta gene is:  ENSG00000171885+ENSG00000244734-ENSG00000132639
===========================================================================
Add gene:  ENSG00000198763
Minus gene:  ENSG00000244274
Absolute mean change: 1.5790925
Number of non-target spots reduced to: 456
===========================================================================
Meta gene is:  ENSG00000171885+ENSG00000244734-ENSG00000132639+ENSG00000198763-ENSG00000244274
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000163032
Absolute mean change: 2.5740657
Number of non-target spots reduced to: 171
===========================================================================
Meta gene is:  ENSG00000171885+ENSG00000244734-ENSG00000132639+ENSG00000198763-ENSG00000244274+ENSG00000131095-ENSG00000163032
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.29705810546875], num_nbr [1.0, 303.8257142857143]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.355635821819305], num_nbr [1.0, 97.52857142857142]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.884924679994583], num_nbr [1.0, 34.58857142857143]
Calculateing adj matrix using xy only...
recommended radius =  3.149569109082222 num_nbr=12.491428571428571
radius= 3.149569109082222 average number of neighbors for each spot is 12.491428571428571
 Cluster 1 has neighbors:
Dmain  2 :  1573
Dmain  3 :  425
Dmain  0 :  362
SVGs for domain  1 : ['ENSG00000123560']
Add gene:  ENSG00000171246
Minus gene:  ENSG00000123560
Absolute mean change: 0.3700906
Number of non-target spots reduced to: 756
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000171246-ENSG00000123560
===========================================================================
Add gene:  ENSG00000123560
Minus gene:  ENSG00000171246
Absolute mean change: 0.3739165
Number of non-target spots reduced to: 723
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000171246-ENSG00000123560+ENSG00000123560-ENSG00000171246
===========================================================================
Add gene:  ENSG00000171246
Minus gene:  ENSG00000123560
Stopped! Previous Number of non-target spots 723 756 0.3739165 0.3700906
Previous Number of non-target spots 723 756 0.3739165 0.3700906
Previous Number of non-target spots 723
Current Number of non-target spots 756
Absolute mean change 0.3739165
===========================================================================
Meta gene:  ENSG00000123560+ENSG00000171246-ENSG00000123560+ENSG00000123560-ENSG00000171246
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.29705810546875], num_nbr [1.0, 320.3703041144902]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.355635821819305], num_nbr [1.0, 102.19141323792486]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.884924679994583], num_nbr [1.0, 35.651162790697676]
Calculateing adj matrix using xy only...
recommended radius =  3.149569109082222 num_nbr=12.724508050089446
radius= 3.149569109082222 average number of neighbors for each spot is 12.724508050089446
 Cluster 2 has neighbors:
Dmain  1 :  1573
Dmain  3 :  537
Dmain  5 :  287
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000139970', 'ENSG00000164919', 'ENSG00000152583', 'ENSG00000111640', 'ENSG00000117632', 'ENSG00000154277', 'ENSG00000170027', 'ENSG00000173915', 'ENSG00000143153', 'ENSG00000128739', 'ENSG00000131711', 'ENSG00000014641', 'ENSG00000142192', 'ENSG00000277586', 'ENSG00000080824', 'ENSG00000133318', 'ENSG00000173660', 'ENSG00000067715', 'ENSG00000137267', 'ENSG00000169567', 'ENSG00000166681', 'ENSG00000176788', 'ENSG00000111674', 'ENSG00000113558', 'ENSG00000103034', 'ENSG00000163399', 'ENSG00000133872', 'ENSG00000126214', 'ENSG00000138078', 'ENSG00000184076', 'ENSG00000102144', 'ENSG00000104435', 'ENSG00000141367', 'ENSG00000165678', 'ENSG00000073969', 'ENSG00000171314', 'ENSG00000143198', 'ENSG00000166922', 'ENSG00000178741', 'ENSG00000165943', 'ENSG00000022355', 'ENSG00000133083', 'ENSG00000182220', 'ENSG00000155886', 'ENSG00000148660']
Add gene:  ENSG00000143499
Minus gene:  ENSG00000162545
Absolute mean change: 0.91645575
Number of non-target spots reduced to: 379
===========================================================================
Meta gene is:  ENSG00000139970+ENSG00000143499-ENSG00000162545
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Absolute mean change: 2.2710586
Number of non-target spots reduced to: 254
===========================================================================
Meta gene is:  ENSG00000139970+ENSG00000143499-ENSG00000162545+ENSG00000132639-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000251562
Stopped! Previous Number of non-target spots 254 90 2.2710586 2.1624217
Previous Number of non-target spots 254 90 2.2710586 2.1624217
Previous Number of non-target spots 254
Current Number of non-target spots 90
Absolute mean change 2.2710586
===========================================================================
Meta gene:  ENSG00000139970+ENSG00000143499-ENSG00000162545+ENSG00000132639-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.29705810546875], num_nbr [1.0, 249.7343976777939]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.355635821819305], num_nbr [1.0, 86.98838896952104]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.884924679994583], num_nbr [1.0, 32.49201741654572]
Calculateing adj matrix using xy only...
recommended radius =  3.149569109082222 num_nbr=12.108853410740203
radius= 3.149569109082222 average number of neighbors for each spot is 12.108853410740203
 Cluster 3 has neighbors:
Dmain  0 :  622
Dmain  2 :  537
Dmain  1 :  425
Dmain  5 :  385
SVGs for domain  3 : ['ENSG00000269028']
Add gene:  ENSG00000251562
Minus gene:  ENSG00000198840
Absolute mean change: 0.61499333
Number of non-target spots reduced to: 366
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000251562-ENSG00000198840
===========================================================================
Add gene:  ENSG00000198804
Minus gene:  ENSG00000251562
Stopped! Previous Number of non-target spots 366 395 0.61499333 0.9873762
Previous Number of non-target spots 366 395 0.61499333 0.9873762
Previous Number of non-target spots 366
Current Number of non-target spots 395
Absolute mean change 0.61499333
===========================================================================
Meta gene:  ENSG00000269028+ENSG00000251562-ENSG00000198840
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.29705810546875], num_nbr [1.0, 311.0354223433242]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.355635821819305], num_nbr [1.0, 98.79019073569482]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.884924679994583], num_nbr [1.0, 34.62942779291553]
Calculateing adj matrix using xy only...
recommended radius =  3.149569109082222 num_nbr=12.44141689373297
radius= 3.149569109082222 average number of neighbors for each spot is 12.44141689373297
 Cluster 4 has neighbors:
Dmain  6 :  508
Dmain  0 :  364
SVGs for domain  4 : ['ENSG00000197971', 'ENSG00000167996', 'ENSG00000123560', 'ENSG00000107317', 'ENSG00000109846', 'ENSG00000091513', 'ENSG00000173786', 'ENSG00000244274', 'ENSG00000099194', 'ENSG00000151552', 'ENSG00000105695']
Add gene:  ENSG00000123560
Minus gene:  ENSG00000198938
Absolute mean change: 3.3612523
Number of non-target spots reduced to: 138
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000123560-ENSG00000198938
===========================================================================
Add gene:  ENSG00000198938
Minus gene:  ENSG00000149932
Stopped! Previous Number of non-target spots 138 9 3.3612523 2.2392645
Previous Number of non-target spots 138 9 3.3612523 2.2392645
Previous Number of non-target spots 138
Current Number of non-target spots 9
Absolute mean change 3.3612523
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000123560-ENSG00000198938
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.29705810546875], num_nbr [1.0, 313.09060402684565]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.355635821819305], num_nbr [1.0, 100.75838926174497]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.884924679994583], num_nbr [1.0, 35.399328859060404]
Calculateing adj matrix using xy only...
recommended radius =  3.149569109082222 num_nbr=12.671140939597315
radius= 3.149569109082222 average number of neighbors for each spot is 12.671140939597315
 Cluster 5 has neighbors:
Dmain  3 :  385
Dmain  0 :  335
Dmain  2 :  287
SVGs for domain  5 : ['ENSG00000162545', 'ENSG00000171617', 'ENSG00000171476', 'ENSG00000115756']
Add gene:  ENSG00000135919
Minus gene:  ENSG00000197971
Absolute mean change: 1.6561444
Number of non-target spots reduced to: 546
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000135919-ENSG00000197971
===========================================================================
Add gene:  ENSG00000171476
Minus gene:  ENSG00000131095
Absolute mean change: 2.5441918
Number of non-target spots reduced to: 137
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000135919-ENSG00000197971+ENSG00000171476-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000131711
Stopped! Previous Number of non-target spots 137 84 2.5441918 2.0769372
Previous Number of non-target spots 137 84 2.5441918 2.0769372
Previous Number of non-target spots 137
Current Number of non-target spots 84
Absolute mean change 2.5441918
===========================================================================
Meta gene:  ENSG00000162545+ENSG00000135919-ENSG00000197971+ENSG00000171476-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.29705810546875], num_nbr [1.0, 240.03879310344828]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.355635821819305], num_nbr [1.0, 85.60775862068965]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.884924679994583], num_nbr [1.0, 31.892241379310345]
Calculateing adj matrix using xy only...
recommended radius =  3.149569109082222 num_nbr=11.857758620689655
radius= 3.149569109082222 average number of neighbors for each spot is 11.857758620689655
 Cluster 6 has neighbors:
Dmain  4 :  508
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 6 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 6!
