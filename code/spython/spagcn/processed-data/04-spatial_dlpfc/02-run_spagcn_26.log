Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8667_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  452.9148194819726 801.0872698317455 405.28324724438755
Var of x,y,z =  26040503.616727117 24342758.961711798 26040503.61672712
Run 1: l [0.01, 1000], p [0.0, 20.185511649545663]
Run 2: l [0.01, 500.005], p [0.0, 2.8490653038024902]
Run 3: l [250.0075, 500.005], p [0.34022629261016846, 2.8490653038024902]
Run 4: l [250.0075, 375.00625], p [0.34022629261016846, 1.2154719829559326]
Run 5: l [250.0075, 312.50687500000004], p [0.34022629261016846, 0.6953026056289673]
recommended l =  281.2571875
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
delta_label  0.0035169988276670576 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 133
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
delta_label  0.004454865181711606 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 106
Res =  0.7999999999999999 Num of clusters =  7
recommended res =  0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
delta_label  0.004689331770222743 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 55
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.898778359511343, 473.2547993019197]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.898778359511343, 152.02268760907504]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.898778359511343, 58.89179755671902]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.898778359511343, 24.471204188481675]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.783595113438045
radius= 3.0240485668182373 average number of neighbors for each spot is 12.783595113438045
 Cluster 0 has neighbors:
Dmain  1 :  1221
Dmain  4 :  1175
Dmain  2 :  492
Dmain  6 :  359
SVGs for domain  0 : ['ENSG00000034510', 'ENSG00000183036']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000187094
Absolute mean change: 1.7929716
Number of non-target spots reduced to: 664
===========================================================================
Meta gene is:  ENSG00000034510+ENSG00000183036-ENSG00000187094
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000214548
Stopped! Previous Number of non-target spots 664 166 1.7929716 1.6066067
Previous Number of non-target spots 664 166 1.7929716 1.6066067
Previous Number of non-target spots 664
Current Number of non-target spots 166
Absolute mean change 1.7929716
===========================================================================
Meta gene:  ENSG00000034510+ENSG00000183036-ENSG00000187094
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.898007033997656, 463.12075029308323]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.898007033997656, 151.45955451348183]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.898007033997656, 58.957796014067995]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.898007033997656, 24.487690504103167]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.801875732708089
radius= 3.0240485668182373 average number of neighbors for each spot is 12.801875732708089
 Cluster 1 has neighbors:
Dmain  4 :  2551
Dmain  5 :  1742
Dmain  0 :  1221
Dmain  3 :  521
Dmain  2 :  444
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000198786', 'ENSG00000135821', 'ENSG00000228253', 'ENSG00000130203', 'ENSG00000018625', 'ENSG00000079215', 'ENSG00000125148', 'ENSG00000131095', 'ENSG00000169715', 'ENSG00000152661']
Add gene:  ENSG00000146469
Minus gene:  ENSG00000132639
Absolute mean change: 0.5944805
Number of non-target spots reduced to: 1074
===========================================================================
Meta gene is:  ENSG00000198786+ENSG00000146469-ENSG00000132639
===========================================================================
Add gene:  ENSG00000198712
Minus gene:  ENSG00000131095
Absolute mean change: 1.0543704
Number of non-target spots reduced to: 788
===========================================================================
Meta gene is:  ENSG00000198786+ENSG00000146469-ENSG00000132639+ENSG00000198712-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000115310
Absolute mean change: 1.1020136
Number of non-target spots reduced to: 593
===========================================================================
Meta gene is:  ENSG00000198786+ENSG00000146469-ENSG00000132639+ENSG00000198712-ENSG00000131095+ENSG00000131095-ENSG00000115310
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.762195121951219, 379.4817073170732]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.762195121951219, 134.89786585365854]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.762195121951219, 55.260670731707314]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.762195121951219, 23.6890243902439]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.535060975609756
radius= 3.0240485668182373 average number of neighbors for each spot is 12.535060975609756
 Cluster 2 has neighbors:
Dmain  6 :  1890
Dmain  0 :  492
Dmain  1 :  444
SVGs for domain  2 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000131095', 'ENSG00000109846', 'ENSG00000173786', 'ENSG00000160307', 'ENSG00000244274', 'ENSG00000091513']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000139970
Absolute mean change: 2.0990176
Number of non-target spots reduced to: 172
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000131095-ENSG00000139970
===========================================================================
Add gene:  ENSG00000139970
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 172 191 2.0990176 1.3305104
Previous Number of non-target spots 172 191 2.0990176 1.3305104
Previous Number of non-target spots 172
Current Number of non-target spots 191
Absolute mean change 2.0990176
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000131095-ENSG00000139970
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.357737104825292, 380.1763727121464]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.357737104825292, 126.83527454242929]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.357737104825292, 51.437603993344425]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.357737104825292, 22.161397670549086]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=11.86855241264559
radius= 3.0240485668182373 average number of neighbors for each spot is 11.86855241264559
 Cluster 3 has neighbors:
Dmain  1 :  521
Dmain  5 :  515
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000131095']
Add gene:  ENSG00000244734
Minus gene:  ENSG00000167996
Absolute mean change: 2.1400123
Number of non-target spots reduced to: 1016
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000167996
===========================================================================
Add gene:  ENSG00000282885
Minus gene:  ENSG00000132639
Absolute mean change: 4.272071
Number of non-target spots reduced to: 57
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000167996+ENSG00000282885-ENSG00000132639
===========================================================================
Add gene:  ENSG00000166441
Minus gene:  ENSG00000197971
Absolute mean change: 5.1205487
Number of non-target spots reduced to: 16
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000167996+ENSG00000282885-ENSG00000132639+ENSG00000166441-ENSG00000197971
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.900943396226415, 476.9685534591195]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.900943396226415, 153.27201257861634]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.900943396226415, 59.20125786163522]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.900943396226415, 24.537735849056602]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.812893081761006
radius= 3.0240485668182373 average number of neighbors for each spot is 12.812893081761006
 Cluster 4 has neighbors:
Dmain  1 :  2551
Dmain  0 :  1175
Dmain  5 :  553
SVGs for domain  4 : ['ENSG00000154146', 'ENSG00000277586', 'ENSG00000111640', 'ENSG00000128245', 'ENSG00000132639', 'ENSG00000163399']
Add gene:  ENSG00000211445
Minus gene:  ENSG00000197971
Absolute mean change: 1.4531841
Number of non-target spots reduced to: 425
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000211445-ENSG00000197971
===========================================================================
Add gene:  ENSG00000277586
Minus gene:  ENSG00000115756
Absolute mean change: 2.5535212
Number of non-target spots reduced to: 325
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000211445-ENSG00000197971+ENSG00000277586-ENSG00000115756
===========================================================================
Add gene:  ENSG00000241837
Minus gene:  ENSG00000131095
Absolute mean change: 3.564252
Number of non-target spots reduced to: 118
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000211445-ENSG00000197971+ENSG00000277586-ENSG00000115756+ENSG00000241837-ENSG00000131095
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.909090909090908, 439.3987603305785]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.909090909090908, 148.96694214876032]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.909090909090908, 58.66115702479339]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.909090909090908, 24.464876033057852]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.807851239669422
radius= 3.0240485668182373 average number of neighbors for each spot is 12.807851239669422
 Cluster 5 has neighbors:
Dmain  1 :  1742
Dmain  4 :  553
Dmain  3 :  515
SVGs for domain  5 : ['ENSG00000171617', 'ENSG00000162545', 'ENSG00000150625', 'ENSG00000128656', 'ENSG00000115310', 'ENSG00000128989', 'ENSG00000020129', 'ENSG00000138814', 'ENSG00000171476', 'ENSG00000214548', 'ENSG00000070961', 'ENSG00000120251', 'ENSG00000066248']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000123416
Absolute mean change: 1.5309055
Number of non-target spots reduced to: 490
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000123416
===========================================================================
Add gene:  ENSG00000162545
Minus gene:  ENSG00000123560
Absolute mean change: 3.0752087
Number of non-target spots reduced to: 166
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000123416+ENSG00000162545-ENSG00000123560
===========================================================================
Add gene:  ENSG00000123560
Minus gene:  ENSG00000104435
Stopped! Previous Number of non-target spots 166 100 3.0752087 2.4300516
Previous Number of non-target spots 166 100 3.0752087 2.4300516
Previous Number of non-target spots 166
Current Number of non-target spots 100
Absolute mean change 3.0752087
===========================================================================
Meta gene:  ENSG00000171617+ENSG00000115756-ENSG00000123416+ENSG00000162545-ENSG00000123560
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.805194805194805, 422.2705627705628]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.805194805194805, 143.6904761904762]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.805194805194805, 57.121212121212125]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.805194805194805, 24.023809523809526]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.61038961038961
radius= 3.0240485668182373 average number of neighbors for each spot is 12.61038961038961
 Cluster 6 has neighbors:
Dmain  2 :  1890
Dmain  0 :  359
SVGs for domain  6 : ['ENSG00000088986', 'ENSG00000139970', 'ENSG00000154096', 'ENSG00000128989', 'ENSG00000187094', 'ENSG00000020129', 'ENSG00000165023', 'ENSG00000166501', 'ENSG00000171246', 'ENSG00000070961']
Add gene:  ENSG00000171246
Minus gene:  ENSG00000198840
Absolute mean change: 1.4924309
Number of non-target spots reduced to: 592
===========================================================================
Meta gene is:  ENSG00000088986+ENSG00000171246-ENSG00000198840
===========================================================================
Add gene:  ENSG00000165023
Minus gene:  ENSG00000183036
Absolute mean change: 2.4488904
Number of non-target spots reduced to: 234
===========================================================================
Meta gene is:  ENSG00000088986+ENSG00000171246-ENSG00000198840+ENSG00000165023-ENSG00000183036
===========================================================================
Add gene:  ENSG00000034510
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 234 103 2.4488904 2.4474254
Previous Number of non-target spots 234 103 2.4488904 2.4474254
Previous Number of non-target spots 234
Current Number of non-target spots 103
Absolute mean change 2.4488904
===========================================================================
Meta gene:  ENSG00000088986+ENSG00000171246-ENSG00000198840+ENSG00000165023-ENSG00000183036
===========================================================================
