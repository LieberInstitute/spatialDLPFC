Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br2720_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  353.1208770459166 581.4141263464477 293.68840873199787
Var of x,y,z =  12202192.329458885 8522181.270192232 12202192.329458885
Run 1: l [0.01, 1000], p [0.0, 31.498792692451254]
Run 2: l [0.01, 500.005], p [0.0, 5.088163375854492]
Run 3: l [0.01, 250.0075], p [0.0, 0.652019739151001]
Run 4: l [125.00874999999999, 250.0075], p [0.037951111793518066, 0.652019739151001]
Run 5: l [187.508125, 250.0075], p [0.24320721626281738, 0.652019739151001]
Run 6: l [218.7578125, 250.0075], p [0.4195101261138916, 0.652019739151001]
Run 7: l [218.7578125, 234.38265625], p [0.4195101261138916, 0.528375506401062]
Run 8: l [226.57023437499998, 234.38265625], p [0.47213971614837646, 0.528375506401062]
recommended l =  230.4764453125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  4
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  8
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.95 Num of clusters =  7
recommended res =  0.95
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
delta_label  0.004383561643835616 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 58
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
delta_label  0.004383561643835616 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 28
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 12.0], num_nbr [1.0, 187.03065134099617]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 6.70710676908493], num_nbr [1.0, 62.97318007662835]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.060660153627396], num_nbr [1.0, 23.904214559386972]
Calculateing adj matrix using xy only...
Run 4: radius [2.7374368458986282, 4.060660153627396], num_nbr [8.831417624521073, 23.904214559386972]
Calculateing adj matrix using xy only...
Run 5: radius [2.7374368458986282, 3.399048499763012], num_nbr [8.831417624521073, 20.199233716475096]
Calculateing adj matrix using xy only...
recommended radius =  3.06824267283082 num_nbr=12.632183908045977
radius= 3.06824267283082 average number of neighbors for each spot is 12.632183908045977
 Cluster 0 has neighbors:
Dmain  5 :  1128
Dmain  2 :  432
Dmain  4 :  178
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000269028', 'ENSG00000212907', 'ENSG00000183011', 'ENSG00000173267']
Add gene:  ENSG00000173267
Minus gene:  ENSG00000197971
Absolute mean change: 1.7817128
Number of non-target spots reduced to: 336
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000173267-ENSG00000197971
===========================================================================
Add gene:  ENSG00000198938
Minus gene:  ENSG00000173267
Absolute mean change: 2.3203917
Number of non-target spots reduced to: 176
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000173267-ENSG00000197971+ENSG00000198938-ENSG00000173267
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000269028
Stopped! Previous Number of non-target spots 176 144 2.3203917 0.8753457
Previous Number of non-target spots 176 144 2.3203917 0.8753457
Previous Number of non-target spots 176
Current Number of non-target spots 144
Absolute mean change 2.3203917
===========================================================================
Meta gene:  ENSG00000269028+ENSG00000173267-ENSG00000197971+ENSG00000198938-ENSG00000173267
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 12.0], num_nbr [1.0, 206.03333333333333]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 6.70710676908493], num_nbr [1.0, 66.44871794871794]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.060660153627396], num_nbr [1.0, 24.55128205128205]
Calculateing adj matrix using xy only...
Run 4: radius [2.7374368458986282, 4.060660153627396], num_nbr [8.930769230769231, 24.55128205128205]
Calculateing adj matrix using xy only...
Run 5: radius [2.7374368458986282, 3.399048499763012], num_nbr [8.930769230769231, 20.65897435897436]
Calculateing adj matrix using xy only...
recommended radius =  3.06824267283082 num_nbr=12.841025641025642
radius= 3.06824267283082 average number of neighbors for each spot is 12.841025641025642
 Cluster 1 has neighbors:
Dmain  6 :  800
Dmain  3 :  518
SVGs for domain  1 : ['ENSG00000123560', 'ENSG00000197971', 'ENSG00000109846', 'ENSG00000244274', 'ENSG00000173786', 'ENSG00000105695']
Add gene:  ENSG00000167123
Minus gene:  ENSG00000198938
Absolute mean change: 2.949481
Number of non-target spots reduced to: 107
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000167123-ENSG00000198938
===========================================================================
Add gene:  ENSG00000160678
Minus gene:  ENSG00000137409
Absolute mean change: 3.589096
Number of non-target spots reduced to: 36
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000167123-ENSG00000198938+ENSG00000160678-ENSG00000137409
===========================================================================
Add gene:  ENSG00000187164
Minus gene:  ENSG00000154146
Absolute mean change: 5.0407376
Number of non-target spots reduced to: 29
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000167123-ENSG00000198938+ENSG00000160678-ENSG00000137409+ENSG00000187164-ENSG00000154146
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 12.0], num_nbr [1.0, 172.834008097166]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 6.70710676908493], num_nbr [1.0, 58.76518218623482]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.060660153627396], num_nbr [1.0, 22.63157894736842]
Calculateing adj matrix using xy only...
Run 4: radius [2.7374368458986282, 4.060660153627396], num_nbr [8.48582995951417, 22.63157894736842]
Calculateing adj matrix using xy only...
Run 5: radius [2.7374368458986282, 3.399048499763012], num_nbr [8.48582995951417, 19.105263157894736]
Calculateing adj matrix using xy only...
recommended radius =  3.06824267283082 num_nbr=12.020242914979757
radius= 3.06824267283082 average number of neighbors for each spot is 12.020242914979757
 Cluster 2 has neighbors:
Dmain  4 :  620
Dmain  5 :  473
Dmain  0 :  432
Dmain  3 :  288
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000130203']
Add gene:  ENSG00000198888
Minus gene:  ENSG00000123560
Absolute mean change: 1.5900159
Number of non-target spots reduced to: 482
===========================================================================
Meta gene is:  ENSG00000130203+ENSG00000198888-ENSG00000123560
===========================================================================
Add gene:  ENSG00000123560
Minus gene:  ENSG00000154146
Stopped! Previous Number of non-target spots 482 303 1.5900159 0.8016825
Previous Number of non-target spots 482 303 1.5900159 0.8016825
Previous Number of non-target spots 482
Current Number of non-target spots 303
Absolute mean change 1.5900159
===========================================================================
Meta gene:  ENSG00000130203+ENSG00000198888-ENSG00000123560
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 12.0], num_nbr [1.0, 174.13503649635035]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 6.70710676908493], num_nbr [1.0, 59.3978102189781]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.060660153627396], num_nbr [1.0, 22.59124087591241]
Calculateing adj matrix using xy only...
Run 4: radius [2.7374368458986282, 4.060660153627396], num_nbr [8.41970802919708, 22.59124087591241]
Calculateing adj matrix using xy only...
Run 5: radius [2.7374368458986282, 3.399048499763012], num_nbr [8.41970802919708, 19.065693430656935]
Calculateing adj matrix using xy only...
recommended radius =  3.06824267283082 num_nbr=11.974452554744525
radius= 3.06824267283082 average number of neighbors for each spot is 11.974452554744525
 Cluster 3 has neighbors:
Dmain  1 :  518
Dmain  6 :  493
Dmain  4 :  388
Dmain  2 :  288
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000198763', 'ENSG00000269028', 'ENSG00000198786', 'ENSG00000212907']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Absolute mean change: 0.9893787
Number of non-target spots reduced to: 1059
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000131095-ENSG00000132639
===========================================================================
Add gene:  ENSG00000203930
Minus gene:  ENSG00000167996
Absolute mean change: 1.6446476
Number of non-target spots reduced to: 249
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000131095-ENSG00000132639+ENSG00000203930-ENSG00000167996
===========================================================================
Add gene:  ENSG00000282885
Minus gene:  ENSG00000075624
Absolute mean change: 2.7570133
Number of non-target spots reduced to: 125
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000131095-ENSG00000132639+ENSG00000203930-ENSG00000167996+ENSG00000282885-ENSG00000075624
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 12.0], num_nbr [1.0, 183.27403846153845]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 6.70710676908493], num_nbr [1.0, 61.39903846153846]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.060660153627396], num_nbr [1.0, 23.317307692307693]
Calculateing adj matrix using xy only...
Run 4: radius [2.7374368458986282, 4.060660153627396], num_nbr [8.653846153846153, 23.317307692307693]
Calculateing adj matrix using xy only...
Run 5: radius [2.7374368458986282, 3.399048499763012], num_nbr [8.653846153846153, 19.701923076923077]
Calculateing adj matrix using xy only...
recommended radius =  3.06824267283082 num_nbr=12.365384615384615
radius= 3.06824267283082 average number of neighbors for each spot is 12.365384615384615
 Cluster 4 has neighbors:
Dmain  2 :  620
Dmain  3 :  388
Dmain  5 :  340
Dmain  0 :  178
Dmain  6 :  125
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 4 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 4!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 12.0], num_nbr [1.0, 179.41052631578947]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 6.70710676908493], num_nbr [1.0, 61.305263157894736]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.060660153627396], num_nbr [1.0, 23.385964912280702]
Calculateing adj matrix using xy only...
Run 4: radius [2.7374368458986282, 4.060660153627396], num_nbr [8.680701754385964, 23.385964912280702]
Calculateing adj matrix using xy only...
Run 5: radius [2.7374368458986282, 3.399048499763012], num_nbr [8.680701754385964, 19.75438596491228]
Calculateing adj matrix using xy only...
recommended radius =  3.06824267283082 num_nbr=12.39298245614035
radius= 3.06824267283082 average number of neighbors for each spot is 12.39298245614035
 Cluster 5 has neighbors:
Dmain  0 :  1128
Dmain  2 :  473
Dmain  4 :  340
SVGs for domain  5 : ['ENSG00000132639', 'ENSG00000130558', 'ENSG00000111640', 'ENSG00000139970', 'ENSG00000128245', 'ENSG00000154146', 'ENSG00000014641']
Add gene:  ENSG00000014641
Minus gene:  ENSG00000198840
Absolute mean change: 1.7343509
Number of non-target spots reduced to: 87
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000014641-ENSG00000198840
===========================================================================
Add gene:  ENSG00000164919
Minus gene:  ENSG00000197971
Absolute mean change: 3.1244068
Number of non-target spots reduced to: 36
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000014641-ENSG00000198840+ENSG00000164919-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000138944
Stopped! Previous Number of non-target spots 36 32 3.1244068 2.5118396
Previous Number of non-target spots 36 32 3.1244068 2.5118396
Previous Number of non-target spots 36
Current Number of non-target spots 32
Absolute mean change 3.1244068
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000014641-ENSG00000198840+ENSG00000164919-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 12.0], num_nbr [1.0, 194.14375]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 6.70710676908493], num_nbr [1.0, 65.05625]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 4.060660153627396], num_nbr [1.0, 24.375]
Calculateing adj matrix using xy only...
Run 4: radius [2.7374368458986282, 4.060660153627396], num_nbr [8.8875, 24.375]
Calculateing adj matrix using xy only...
Run 5: radius [2.7374368458986282, 3.399048499763012], num_nbr [8.8875, 20.54375]
Calculateing adj matrix using xy only...
recommended radius =  3.06824267283082 num_nbr=12.775
radius= 3.06824267283082 average number of neighbors for each spot is 12.775
 Cluster 6 has neighbors:
Dmain  1 :  800
Dmain  3 :  493
Dmain  4 :  125
Can't find any genes such that more spots in domain 6 express the gene than its neighbors!
