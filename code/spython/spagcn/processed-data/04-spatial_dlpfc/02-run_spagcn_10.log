Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8492_ant...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  330.58530142069213 550.8166220144432 231.12861017852418
Var of x,y,z =  26509067.4105607 28917256.0347613 28917256.0347613
Run 1: l [0.01, 1000], p [0.0, 17.004664009661727]
Run 2: l [0.01, 500.005], p [0.0, 2.3601295948028564]
Run 3: l [250.0075, 500.005], p [0.2795586585998535, 2.3601295948028564]
Run 4: l [250.0075, 375.00625], p [0.2795586585998535, 1.0040194988250732]
Run 5: l [250.0075, 312.50687500000004], p [0.2795586585998535, 0.5736608505249023]
Run 6: l [281.2571875, 312.50687500000004], p [0.41095495223999023, 0.5736608505249023]
Run 7: l [296.88203125, 312.50687500000004], p [0.48822271823883057, 0.5736608505249023]
Run 8: l [296.88203125, 304.694453125], p [0.48822271823883057, 0.529899001121521]
recommended l =  300.78824218750003
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  7
recommended res =  0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.84884792626728, 496.1023041474654]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.84884792626728, 163.43870967741935]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.84884792626728, 58.242396313364054]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.84884792626728, 24.283870967741937]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.710599078341014
radius= 3.064143657684326 average number of neighbors for each spot is 12.710599078341014
 Cluster 0 has neighbors:
Dmain  6 :  3070
Dmain  5 :  2218
Dmain  3 :  1358
Dmain  2 :  1199
Dmain  1 :  1096
Dmain  4 :  535
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000269028']
Add gene:  ENSG00000197943
Minus gene:  ENSG00000269028
Absolute mean change: 0.024814557
Number of non-target spots reduced to: 1815
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000197943-ENSG00000269028
===========================================================================
Add gene:  ENSG00000186298
Minus gene:  ENSG00000197943
Stopped! Previous Number of non-target spots 1815 306 0.024814557 -0.03128408
Previous Number of non-target spots 1815 306 0.024814557 -0.03128408
Previous Number of non-target spots 1815
Current Number of non-target spots 306
Absolute mean change 0.024814557
===========================================================================
Meta gene:  ENSG00000269028+ENSG00000197943-ENSG00000269028
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.80877192982456, 454.6333333333333]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.80877192982456, 155.7421052631579]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.80877192982456, 56.83684210526316]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.80877192982456, 23.987719298245615]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.608771929824561
radius= 3.064143657684326 average number of neighbors for each spot is 12.608771929824561
 Cluster 1 has neighbors:
Dmain  5 :  1463
Dmain  0 :  1096
Dmain  4 :  1071
Dmain  6 :  811
Dmain  3 :  430
Dmain  2 :  282
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 1 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 1!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.922043010752688, 500.4193548387097]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.922043010752688, 165.78763440860214]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.922043010752688, 59.134408602150536]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.922043010752688, 24.583333333333332]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.86021505376344
radius= 3.064143657684326 average number of neighbors for each spot is 12.86021505376344
 Cluster 2 has neighbors:
Dmain  0 :  1199
Dmain  6 :  989
Dmain  5 :  826
Dmain  3 :  514
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 2 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 2!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.90249433106576, 517.7301587301587]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.90249433106576, 168.43990929705217]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.90249433106576, 59.34920634920635]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.90249433106576, 24.569160997732425]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.80498866213152
radius= 3.064143657684326 average number of neighbors for each spot is 12.80498866213152
 Cluster 3 has neighbors:
Dmain  0 :  1358
Dmain  6 :  1188
Dmain  5 :  997
Dmain  2 :  514
Dmain  1 :  430
Can't find any genes such that more spots in domain 3 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.628242074927954, 416.97694524495677]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.628242074927954, 145.85302593659944]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.628242074927954, 54.15561959654179]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.628242074927954, 23.178674351585013]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.285302593659942
radius= 3.064143657684326 average number of neighbors for each spot is 12.285302593659942
 Cluster 4 has neighbors:
Dmain  1 :  1071
Dmain  5 :  770
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000269028', 'ENSG00000256618', 'ENSG00000251562']
Add gene:  ENSG00000251562
Minus gene:  ENSG00000269028
Absolute mean change: 0.6640972
Number of non-target spots reduced to: 1054
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000251562-ENSG00000269028
===========================================================================
Add gene:  ENSG00000256618
Minus gene:  ENSG00000251562
Stopped! Previous Number of non-target spots 1054 572 0.6640972 0.5089724
Previous Number of non-target spots 1054 572 0.6640972 0.5089724
Previous Number of non-target spots 1054
Current Number of non-target spots 572
Absolute mean change 0.6640972
===========================================================================
Meta gene:  ENSG00000269028+ENSG00000251562-ENSG00000269028
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.893785310734463, 487.95028248587573]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.893785310734463, 162.5322033898305]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.893785310734463, 58.280225988700565]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.893785310734463, 24.377401129943504]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.774011299435028
radius= 3.064143657684326 average number of neighbors for each spot is 12.774011299435028
 Cluster 5 has neighbors:
Dmain  0 :  2218
Dmain  6 :  1768
Dmain  1 :  1463
Dmain  3 :  997
Dmain  2 :  826
Dmain  4 :  770
Can't find any genes such that more spots in domain 5 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.778591033851784, 484.47301006404393]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.778591033851784, 159.87008234217748]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.778591033851784, 57.22415370539799]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.778591033851784, 23.98444647758463]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.580054894784995
radius= 3.064143657684326 average number of neighbors for each spot is 12.580054894784995
 Cluster 6 has neighbors:
Dmain  0 :  3070
Dmain  5 :  1768
Dmain  3 :  1188
Dmain  2 :  989
Dmain  1 :  811
Dmain  4 :  389
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 6 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 6!
