Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
Continuing with sample Br6432_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  901.4217324543004 1523.4216423449948 616.9406834534881
Var of x,y,z =  15104420.718128588 25648655.302832995 25648655.302832995
Run 1: l [0.01, 1000], p [0.0, 20.673107913092252]
Run 2: l [0.01, 500.005], p [0.0, 3.0323638916015625]
Run 3: l [250.0075, 500.005], p [0.3782240152359009, 3.0323638916015625]
Run 4: l [250.0075, 375.00625], p [0.3782240152359009, 1.3162457942962646]
Run 5: l [250.0075, 312.50687500000004], p [0.3782240152359009, 0.7618312835693359]
Run 6: l [250.0075, 281.2571875], p [0.3782240152359009, 0.5502634048461914]
Run 7: l [265.63234375, 281.2571875], p [0.4595053195953369, 0.5502634048461914]
recommended l =  273.444765625
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  7
recommended res =  0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 381.34393638170974]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 121.54671968190856]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 43.2544731610338]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.41948310139165]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.842942345924452, 20.41948310139165]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.842942345924452, 20.41948310139165]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.713717693836978
radius= 3.063392600044608 average number of neighbors for each spot is 12.713717693836978
 Cluster 0 has neighbors:
Dmain  2 :  1506
Dmain  4 :  848
Dmain  5 :  569
Dmain  6 :  398
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000197971', 'ENSG00000131095', 'ENSG00000123560']
Add gene:  ENSG00000164241
Minus gene:  ENSG00000167996
Absolute mean change: 0.6157422
Number of non-target spots reduced to: 796
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000164241-ENSG00000167996
===========================================================================
Add gene:  ENSG00000171246
Minus gene:  ENSG00000164241
Stopped! Previous Number of non-target spots 796 727 0.6157422 0.571929
Previous Number of non-target spots 796 727 0.6157422 0.571929
Previous Number of non-target spots 796
Current Number of non-target spots 727
Absolute mean change 0.6157422
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000164241-ENSG00000167996
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 323.2142857142857]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 106.96031746031746]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 39.36031746031746]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 18.926984126984127]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.373015873015873, 18.926984126984127]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.373015873015873, 18.926984126984127]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=11.895238095238096
radius= 3.063392600044608 average number of neighbors for each spot is 11.895238095238096
 Cluster 1 has neighbors:
Dmain  5 :  1180
Dmain  3 :  466
Dmain  0 :  260
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000251562']
Add gene:  ENSG00000244734
Minus gene:  ENSG00000132639
Absolute mean change: 1.6325486
Number of non-target spots reduced to: 1195
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000244734-ENSG00000132639
===========================================================================
Add gene:  ENSG00000113140
Minus gene:  ENSG00000197971
Absolute mean change: 2.853399
Number of non-target spots reduced to: 134
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000244734-ENSG00000132639+ENSG00000113140-ENSG00000197971
===========================================================================
Add gene:  ENSG00000147027
Minus gene:  ENSG00000139970
Absolute mean change: 3.8990135
Number of non-target spots reduced to: 44
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000244734-ENSG00000132639+ENSG00000113140-ENSG00000197971+ENSG00000147027-ENSG00000139970
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 349.9031770045386]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 116.62632375189108]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 42.635400907715585]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.302571860816943]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.829046898638426, 20.302571860816943]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.829046898638426, 20.302571860816943]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.659606656580937
radius= 3.063392600044608 average number of neighbors for each spot is 12.659606656580937
 Cluster 2 has neighbors:
Dmain  0 :  1506
Dmain  4 :  1286
Dmain  5 :  624
Dmain  3 :  413
Dmain  6 :  187
SVGs for domain  2 : ['ENSG00000132639', 'ENSG00000034510']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198727
Absolute mean change: 1.2888422
Number of non-target spots reduced to: 149
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000197971-ENSG00000198727
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 149 327 1.2888422 1.618228
Previous Number of non-target spots 149 327 1.2888422 1.618228
Previous Number of non-target spots 149
Current Number of non-target spots 327
Absolute mean change 1.2888422
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000197971-ENSG00000198727
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 321.15555555555557]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 111.44444444444444]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 41.49166666666667]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.041666666666668]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.805555555555555, 20.041666666666668]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.805555555555555, 20.041666666666668]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.588888888888889
radius= 3.063392600044608 average number of neighbors for each spot is 12.588888888888889
 Cluster 3 has neighbors:
Dmain  5 :  1469
Dmain  4 :  516
Dmain  1 :  466
Dmain  2 :  413
SVGs for domain  3 : ['ENSG00000132639', 'ENSG00000139970', 'ENSG00000187094']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 1.3353596
Number of non-target spots reduced to: 623
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000115756
Absolute mean change: 1.5552859
Number of non-target spots reduced to: 284
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000115756-ENSG00000197971+ENSG00000187094-ENSG00000115756
===========================================================================
Add gene:  ENSG00000115756
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 284 259 1.5552859 1.4146218
Previous Number of non-target spots 284 259 1.5552859 1.4146218
Previous Number of non-target spots 284
Current Number of non-target spots 259
Absolute mean change 1.5552859
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000115756-ENSG00000197971+ENSG00000187094-ENSG00000115756
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 370.29383886255926]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 120.58530805687204]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 43.485781990521325]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.585308056872037]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.90521327014218, 20.585308056872037]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.90521327014218, 20.585308056872037]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.800947867298579
radius= 3.063392600044608 average number of neighbors for each spot is 12.800947867298579
 Cluster 4 has neighbors:
Dmain  2 :  1286
Dmain  5 :  1078
Dmain  0 :  848
Dmain  3 :  516
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 4 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 4!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 348.6714285714286]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 115.70428571428572]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 41.97571428571428]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 19.97714285714286]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.695714285714285, 19.97714285714286]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.695714285714285, 19.97714285714286]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.471428571428572
radius= 3.063392600044608 average number of neighbors for each spot is 12.471428571428572
 Cluster 5 has neighbors:
Dmain  3 :  1469
Dmain  1 :  1180
Dmain  4 :  1078
Dmain  2 :  624
Dmain  0 :  569
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000198727', 'ENSG00000212907']
Add gene:  ENSG00000282885
Minus gene:  ENSG00000132639
Absolute mean change: 0.34060955
Number of non-target spots reduced to: 1183
===========================================================================
Meta gene is:  ENSG00000198727+ENSG00000282885-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Absolute mean change: 0.6125696
Number of non-target spots reduced to: 792
===========================================================================
Meta gene is:  ENSG00000198727+ENSG00000282885-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000282885
Stopped! Previous Number of non-target spots 792 636 0.6125696 0.15819573
Previous Number of non-target spots 792 636 0.6125696 0.15819573
Previous Number of non-target spots 792
Current Number of non-target spots 636
Absolute mean change 0.6125696
===========================================================================
Meta gene:  ENSG00000198727+ENSG00000282885-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 327.18297872340423]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 111.56595744680851]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 41.34468085106383]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 19.85531914893617]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.719148936170212, 19.85531914893617]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.719148936170212, 19.85531914893617]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.451063829787234
radius= 3.063392600044608 average number of neighbors for each spot is 12.451063829787234
 Cluster 6 has neighbors:
Dmain  0 :  398
SVGs for domain  6 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000131095', 'ENSG00000160307', 'ENSG00000099194', 'ENSG00000109846', 'ENSG00000168314', 'ENSG00000244274', 'ENSG00000173786', 'ENSG00000091513', 'ENSG00000151552']
Add gene:  ENSG00000167641
Minus gene:  ENSG00000198804
Absolute mean change: 2.7683747
Number of non-target spots reduced to: 28
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000167641-ENSG00000198804
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000167641-ENSG00000198804
