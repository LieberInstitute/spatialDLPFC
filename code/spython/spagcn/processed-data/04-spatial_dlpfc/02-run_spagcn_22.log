Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br6522_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  599.4696697953375 935.362484006687 532.437773783485
Var of x,y,z =  19929100.12349998 25523686.61407899 25523686.614078995
Run 1: l [0.01, 1000], p [0.0, 22.81535985306834]
Run 2: l [0.01, 500.005], p [0.0, 3.4230098724365234]
Run 3: l [250.0075, 500.005], p [0.4224773645401001, 3.4230098724365234]
Run 4: l [250.0075, 375.00625], p [0.4224773645401001, 1.485762119293213]
Run 5: l [250.0075, 312.50687500000004], p [0.4224773645401001, 0.8567498922348022]
Run 6: l [250.0075, 281.2571875], p [0.4224773645401001, 0.6169075965881348]
Run 7: l [250.0075, 265.63234375], p [0.4224773645401001, 0.5142340660095215]
Run 8: l [257.819921875, 265.63234375], p [0.4670194387435913, 0.5142340660095215]
recommended l =  261.7261328125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
delta_label  0.0038363171355498722 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 43
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
delta_label  0.004859335038363171 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 49
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
delta_label  0.004347826086956522 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 37
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.485632183908047, 357.2284482758621]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.485632183908047, 121.38074712643679]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.485632183908047, 43.51867816091954]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.485632183908047, 19.28448275862069]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.100574712643677
radius= 2.9539172649383545 average number of neighbors for each spot is 12.100574712643677
 Cluster 0 has neighbors:
Dmain  4 :  759
Dmain  2 :  440
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000131095']
Add gene:  ENSG00000244734
Minus gene:  ENSG00000197971
Absolute mean change: 2.1450667
Number of non-target spots reduced to: 1255
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000132639
Absolute mean change: 2.3718746
Number of non-target spots reduced to: 57
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000197971+ENSG00000197971-ENSG00000132639
===========================================================================
Add gene:  ENSG00000228253
Minus gene:  ENSG00000123560
Stopped! Previous Number of non-target spots 57 132 2.3718746 3.8149896
Previous Number of non-target spots 57 132 2.3718746 3.8149896
Previous Number of non-target spots 57
Current Number of non-target spots 132
Absolute mean change 2.3718746
===========================================================================
Meta gene:  ENSG00000131095+ENSG00000244734-ENSG00000197971+ENSG00000197971-ENSG00000132639
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.852430555555555, 379.8385416666667]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.852430555555555, 131.33680555555554]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.852430555555555, 46.713541666666664]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.852430555555555, 20.43576388888889]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.734375
radius= 2.9539172649383545 average number of neighbors for each spot is 12.734375
 Cluster 1 has neighbors:
Dmain  5 :  1267
Dmain  3 :  210
SVGs for domain  1 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000131095', 'ENSG00000173786']
Add gene:  ENSG00000157483
Minus gene:  ENSG00000132639
Absolute mean change: 2.4042866
Number of non-target spots reduced to: 135
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000157483-ENSG00000132639
===========================================================================
Add gene:  ENSG00000125462
Minus gene:  ENSG00000131507
Absolute mean change: 2.7373834
Number of non-target spots reduced to: 7
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000157483-ENSG00000132639+ENSG00000125462-ENSG00000131507
===========================================================================
Add gene:  ENSG00000123560
Minus gene:  ENSG00000198763
Stopped! Previous Number of non-target spots 7 35 2.7373834 4.7321854
Previous Number of non-target spots 7 35 2.7373834 4.7321854
Previous Number of non-target spots 7
Current Number of non-target spots 35
Absolute mean change 2.7373834
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000157483-ENSG00000132639+ENSG00000125462-ENSG00000131507
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.7162471395881, 384.03661327231123]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.7162471395881, 128.76201372997713]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.7162471395881, 45.41876430205949]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.7162471395881, 19.958810068649885]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.45766590389016
radius= 2.9539172649383545 average number of neighbors for each spot is 12.45766590389016
 Cluster 2 has neighbors:
Dmain  6 :  1450
Dmain  4 :  1225
Dmain  0 :  440
Dmain  3 :  220
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000198712']
Add gene:  ENSG00000109220
Minus gene:  ENSG00000132639
Absolute mean change: 0.43549538
Number of non-target spots reduced to: 916
===========================================================================
Meta gene is:  ENSG00000198712+ENSG00000109220-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Absolute mean change: 0.6929002
Number of non-target spots reduced to: 887
===========================================================================
Meta gene is:  ENSG00000198712+ENSG00000109220-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 887 918 0.6929002 0.43549585
Previous Number of non-target spots 887 918 0.6929002 0.43549585
Previous Number of non-target spots 887
Current Number of non-target spots 918
Absolute mean change 0.6929002
===========================================================================
Meta gene:  ENSG00000198712+ENSG00000109220-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.809027777777779, 425.375]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.809027777777779, 135.40277777777777]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.809027777777779, 46.802083333333336]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.809027777777779, 20.333333333333332]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.645833333333334
radius= 2.9539172649383545 average number of neighbors for each spot is 12.645833333333334
 Cluster 3 has neighbors:
Dmain  6 :  1302
Dmain  5 :  716
Dmain  2 :  220
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000183036']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000197971
Absolute mean change: 0.3099796
Number of non-target spots reduced to: 1393
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000183036-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000132639
Absolute mean change: 0.4842775
Number of non-target spots reduced to: 684
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000183036-ENSG00000197971+ENSG00000197971-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 684 1130 0.4842775 0.92234564
Previous Number of non-target spots 684 1130 0.4842775 0.92234564
Previous Number of non-target spots 684
Current Number of non-target spots 1130
Absolute mean change 0.4842775
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000183036-ENSG00000197971+ENSG00000197971-ENSG00000132639
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.898876404494382, 373.09550561797755]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.898876404494382, 129.6629213483146]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.898876404494382, 46.762172284644194]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.898876404494382, 20.5187265917603]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.780898876404494
radius= 2.9539172649383545 average number of neighbors for each spot is 12.780898876404494
 Cluster 4 has neighbors:
Dmain  2 :  1225
Dmain  0 :  759
Dmain  6 :  414
SVGs for domain  4 : ['ENSG00000162545', 'ENSG00000130558', 'ENSG00000115310', 'ENSG00000128989', 'ENSG00000128656', 'ENSG00000171617', 'ENSG00000150625', 'ENSG00000020129', 'ENSG00000138814']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 2.112681
Number of non-target spots reduced to: 460
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000128989
Minus gene:  ENSG00000198938
Absolute mean change: 2.6674676
Number of non-target spots reduced to: 103
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971+ENSG00000128989-ENSG00000198938
===========================================================================
Add gene:  ENSG00000115310
Minus gene:  ENSG00000277586
Absolute mean change: 3.2911396
Number of non-target spots reduced to: 51
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971+ENSG00000128989-ENSG00000198938+ENSG00000115310-ENSG00000277586
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.701782820097245, 394.86223662884925]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.701782820097245, 128.50729335494327]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.701782820097245, 45.173419773095624]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.701782820097245, 19.84440842787682]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.413290113452188
radius= 2.9539172649383545 average number of neighbors for each spot is 12.413290113452188
 Cluster 5 has neighbors:
Dmain  1 :  1267
Dmain  3 :  716
Dmain  6 :  580
SVGs for domain  5 : ['ENSG00000067715', 'ENSG00000165023']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198899
Absolute mean change: 1.7843947
Number of non-target spots reduced to: 596
===========================================================================
Meta gene is:  ENSG00000067715+ENSG00000197971-ENSG00000198899
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 596 388 1.7843947 1.5757153
Previous Number of non-target spots 596 388 1.7843947 1.5757153
Previous Number of non-target spots 596
Current Number of non-target spots 388
Absolute mean change 1.7843947
===========================================================================
Meta gene:  ENSG00000067715+ENSG00000197971-ENSG00000198899
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.918635170603675, 412.9803149606299]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.918635170603675, 135.90944881889763]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.918635170603675, 47.44356955380577]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.918635170603675, 20.63254593175853]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.828083989501312
radius= 2.9539172649383545 average number of neighbors for each spot is 12.828083989501312
 Cluster 6 has neighbors:
Dmain  2 :  1450
Dmain  3 :  1302
Dmain  5 :  580
Dmain  4 :  414
SVGs for domain  6 : ['ENSG00000132639', 'ENSG00000111640', 'ENSG00000152583', 'ENSG00000154277', 'ENSG00000109971', 'ENSG00000143153', 'ENSG00000277586', 'ENSG00000014641', 'ENSG00000163399', 'ENSG00000104435', 'ENSG00000104722', 'ENSG00000105711']
Add gene:  ENSG00000173267
Minus gene:  ENSG00000101439
Absolute mean change: 1.6961169
Number of non-target spots reduced to: 470
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000173267-ENSG00000101439
===========================================================================
Add gene:  ENSG00000105711
Minus gene:  ENSG00000128989
Absolute mean change: 2.11875
Number of non-target spots reduced to: 188
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000173267-ENSG00000101439+ENSG00000105711-ENSG00000128989
===========================================================================
Add gene:  ENSG00000111640
Minus gene:  ENSG00000131095
Absolute mean change: 3.40343
Number of non-target spots reduced to: 142
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000173267-ENSG00000101439+ENSG00000105711-ENSG00000128989+ENSG00000111640-ENSG00000131095
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
