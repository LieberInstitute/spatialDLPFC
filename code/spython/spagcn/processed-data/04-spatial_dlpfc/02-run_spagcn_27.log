Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8667_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  442.75609716451527 768.164710575018 396.64066829452986
Var of x,y,z =  24049740.0898632 27218225.013493445 27218225.01349345
Run 1: l [0.01, 1000], p [0.0, 16.45736614830463]
Run 2: l [0.01, 500.005], p [0.0, 2.3183584213256836]
Run 3: l [250.0075, 500.005], p [0.28074002265930176, 2.3183584213256836]
Run 4: l [250.0075, 375.00625], p [0.28074002265930176, 0.9922807216644287]
Run 5: l [250.0075, 312.50687500000004], p [0.28074002265930176, 0.5699843168258667]
Run 6: l [281.2571875, 312.50687500000004], p [0.4100912809371948, 0.5699843168258667]
Run 7: l [296.88203125, 312.50687500000004], p [0.4860471487045288, 0.5699843168258667]
Run 8: l [296.88203125, 304.694453125], p [0.4860471487045288, 0.5269966125488281]
recommended l =  300.78824218750003
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
delta_label  0.0029565612917898565 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 70
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.820111731843575, 438.48715083798885]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.820111731843575, 152.5586592178771]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.820111731843575, 57.39329608938547]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.820111731843575, 24.089385474860336]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.639106145251397
radius= 3.027443051338196 average number of neighbors for each spot is 12.639106145251397
 Cluster 0 has neighbors:
Dmain  6 :  2274
Dmain  1 :  1405
Dmain  4 :  625
Dmain  5 :  30
SVGs for domain  0 : ['ENSG00000197971', 'ENSG00000123560']
Add gene:  ENSG00000212907
Minus gene:  ENSG00000197971
Absolute mean change: 0.25051296
Number of non-target spots reduced to: 527
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000212907-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000171617
Stopped! Previous Number of non-target spots 527 1521 0.25051296 1.3740151
Previous Number of non-target spots 527 1521 0.25051296 1.3740151
Previous Number of non-target spots 527
Current Number of non-target spots 1521
Absolute mean change 0.25051296
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000212907-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.905317769130999, 459.00389105058366]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.905317769130999, 158.40077821011673]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.905317769130999, 58.929961089494164]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.905317769130999, 24.50324254215305]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.809338521400779
radius= 3.027443051338196 average number of neighbors for each spot is 12.809338521400779
 Cluster 1 has neighbors:
Dmain  4 :  1649
Dmain  0 :  1405
Dmain  2 :  492
Dmain  6 :  388
SVGs for domain  1 : ['ENSG00000154146', 'ENSG00000277586', 'ENSG00000163399', 'ENSG00000104722']
Add gene:  ENSG00000104722
Minus gene:  ENSG00000154146
Absolute mean change: 0.79611546
Number of non-target spots reduced to: 427
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000104722-ENSG00000154146
===========================================================================
Add gene:  ENSG00000154146
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 427 523 0.79611546 1.4270451
Previous Number of non-target spots 427 523 0.79611546 1.4270451
Previous Number of non-target spots 427
Current Number of non-target spots 523
Absolute mean change 0.79611546
===========================================================================
Meta gene:  ENSG00000154146+ENSG00000104722-ENSG00000154146
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.902542372881356, 435.545197740113]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.902542372881356, 154.44209039548022]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.902542372881356, 58.43785310734463]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.902542372881356, 24.430790960451976]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.795197740112995
radius= 3.027443051338196 average number of neighbors for each spot is 12.795197740112995
 Cluster 2 has neighbors:
Dmain  4 :  2823
Dmain  1 :  492
Dmain  3 :  399
SVGs for domain  2 : ['ENSG00000163032', 'ENSG00000130558', 'ENSG00000171617', 'ENSG00000128656', 'ENSG00000150625', 'ENSG00000187094', 'ENSG00000162545', 'ENSG00000115310', 'ENSG00000164924', 'ENSG00000128989', 'ENSG00000020129']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 1.3260384
Number of non-target spots reduced to: 1401
===========================================================================
Meta gene is:  ENSG00000163032+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000198712
Absolute mean change: 2.2151203
Number of non-target spots reduced to: 333
===========================================================================
Meta gene is:  ENSG00000163032+ENSG00000115756-ENSG00000197971+ENSG00000171617-ENSG00000198712
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000104722
Stopped! Previous Number of non-target spots 333 192 2.2151203 1.9809425
Previous Number of non-target spots 333 192 2.2151203 1.9809425
Previous Number of non-target spots 333
Current Number of non-target spots 192
Absolute mean change 2.2151203
===========================================================================
Meta gene:  ENSG00000163032+ENSG00000115756-ENSG00000197971+ENSG00000171617-ENSG00000198712
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.341389728096678, 401.68731117824774]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.341389728096678, 133.99244712990938]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.341389728096678, 51.259818731117825]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.341389728096678, 22.12084592145015]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=11.823262839879154
radius= 3.027443051338196 average number of neighbors for each spot is 11.823262839879154
 Cluster 3 has neighbors:
Dmain  4 :  580
Dmain  2 :  399
Dmain  5 :  6
SVGs for domain  3 : ['ENSG00000131095']
Add gene:  ENSG00000188536
Minus gene:  ENSG00000132639
Absolute mean change: 3.0773597
Number of non-target spots reduced to: 341
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000188536-ENSG00000132639
===========================================================================
Add gene:  ENSG00000113140
Minus gene:  ENSG00000165943
Absolute mean change: 4.006009
Number of non-target spots reduced to: 6
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000188536-ENSG00000132639+ENSG00000113140-ENSG00000165943
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000188536-ENSG00000132639+ENSG00000113140-ENSG00000165943
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.825857519788919, 452.46569920844325]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.825857519788919, 155.87994722955145]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.825857519788919, 58.18073878627968]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.825857519788919, 24.25461741424802]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.688654353562006
radius= 3.027443051338196 average number of neighbors for each spot is 12.688654353562006
 Cluster 4 has neighbors:
Dmain  2 :  2823
Dmain  1 :  1649
Dmain  0 :  625
Dmain  3 :  580
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000212907', 'ENSG00000228253', 'ENSG00000131095']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000132639
Absolute mean change: 0.525908
Number of non-target spots reduced to: 1668
===========================================================================
Meta gene is:  ENSG00000212907+ENSG00000115756-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 1668 1001 0.525908 0.31577468
Previous Number of non-target spots 1668 1001 0.525908 0.31577468
Previous Number of non-target spots 1668
Current Number of non-target spots 1001
Absolute mean change 0.525908
===========================================================================
Meta gene:  ENSG00000212907+ENSG00000115756-ENSG00000132639
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.571428571428571, 342.0]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.571428571428571, 130.71428571428572]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.571428571428571, 52.0]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.571428571428571, 22.714285714285715]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.285714285714286
radius= 3.027443051338196 average number of neighbors for each spot is 12.285714285714286
 Cluster 5 has neighbors:
No neighbor domain found, try bigger radius or smaller ratio.
Found no neighbors for domain 5 . No SVGs will be found for this domain.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.78523489932886, 392.07214765100673]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.78523489932886, 142.5771812080537]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.78523489932886, 55.506711409395976]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.78523489932886, 23.721476510067113]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.555369127516778
radius= 3.027443051338196 average number of neighbors for each spot is 12.555369127516778
 Cluster 6 has neighbors:
Dmain  0 :  2274
Dmain  1 :  388
Dmain  5 :  36
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000197971', 'ENSG00000167552', 'ENSG00000088986', 'ENSG00000123560', 'ENSG00000067715', 'ENSG00000104888', 'ENSG00000137726', 'ENSG00000145335', 'ENSG00000145920', 'ENSG00000171246', 'ENSG00000165023', 'ENSG00000178531']
Add gene:  ENSG00000171246
Minus gene:  ENSG00000198899
Absolute mean change: 1.3330481
Number of non-target spots reduced to: 429
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000171246-ENSG00000198899
===========================================================================
Add gene:  ENSG00000034510
Minus gene:  ENSG00000079215
Absolute mean change: 2.2376065
Number of non-target spots reduced to: 223
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000171246-ENSG00000198899+ENSG00000034510-ENSG00000079215
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000198763
Absolute mean change: 2.579111
Number of non-target spots reduced to: 143
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000171246-ENSG00000198899+ENSG00000034510-ENSG00000079215+ENSG00000187094-ENSG00000198763
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
