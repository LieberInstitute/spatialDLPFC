Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
Continuing with sample Br6471_ant...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  581.4357364973109 1084.5942215435716 464.89280838566225
Var of x,y,z =  20392091.074875586 15695055.982648171 20392091.074875586
Run 1: l [0.01, 1000], p [0.0, 23.776577442981893]
Run 2: l [0.01, 500.005], p [0.0, 3.4990806579589844]
Run 3: l [250.0075, 500.005], p [0.42260730266571045, 3.4990806579589844]
Run 4: l [250.0075, 375.00625], p [0.42260730266571045, 1.5058796405792236]
Run 5: l [250.0075, 312.50687500000004], p [0.42260730266571045, 0.8638076782226562]
Run 6: l [250.0075, 281.2571875], p [0.42260730266571045, 0.6198418140411377]
Run 7: l [250.0075, 265.63234375], p [0.42260730266571045, 0.5156089067459106]
Run 8: l [257.819921875, 265.63234375], p [0.4677332639694214, 0.5156089067459106]
recommended l =  261.7261328125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
delta_label  0.004706620646375902 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 43
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  7
recommended res =  0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.81138801574707], num_nbr [1.0, 267.9813753581662]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.612800776958466], num_nbr [1.0, 96.47134670487107]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.013507157564163], num_nbr [1.0, 32.21919770773639]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.213860347867012], num_nbr [1.0, 18.84383954154728]
Calculateing adj matrix using xy only...
Run 5: radius [2.3140369430184364, 3.213860347867012], num_nbr [8.361031518624642, 18.84383954154728]
Calculateing adj matrix using xy only...
Run 6: radius [2.7639486454427242, 3.213860347867012], num_nbr [8.361031518624642, 18.84383954154728]
Calculateing adj matrix using xy only...
recommended radius =  2.988904496654868 num_nbr=11.868194842406877
radius= 2.988904496654868 average number of neighbors for each spot is 11.868194842406877
 Cluster 0 has neighbors:
Dmain  3 :  612
Dmain  6 :  102
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000131095', 'ENSG00000251562']
Add gene:  ENSG00000251562
Minus gene:  ENSG00000198938
Absolute mean change: 1.8269942
Number of non-target spots reduced to: 791
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000198938
===========================================================================
Add gene:  ENSG00000198162
Minus gene:  ENSG00000197971
Absolute mean change: 2.931826
Number of non-target spots reduced to: 131
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000198938+ENSG00000198162-ENSG00000197971
===========================================================================
Add gene:  ENSG00000171885
Minus gene:  ENSG00000132639
Absolute mean change: 4.700408
Number of non-target spots reduced to: 30
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000198938+ENSG00000198162-ENSG00000197971+ENSG00000171885-ENSG00000132639
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.81138801574707], num_nbr [1.0, 342.14505494505494]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.612800776958466], num_nbr [1.0, 112.7032967032967]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.013507157564163], num_nbr [1.0, 35.362637362637365]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.213860347867012], num_nbr [1.0, 20.27252747252747]
Calculateing adj matrix using xy only...
Run 5: radius [2.3140369430184364, 3.213860347867012], num_nbr [8.804395604395605, 20.27252747252747]
Calculateing adj matrix using xy only...
Run 6: radius [2.7639486454427242, 3.213860347867012], num_nbr [8.804395604395605, 20.27252747252747]
Calculateing adj matrix using xy only...
recommended radius =  2.988904496654868 num_nbr=12.63076923076923
radius= 2.988904496654868 average number of neighbors for each spot is 12.63076923076923
 Cluster 1 has neighbors:
Dmain  3 :  2258
Dmain  2 :  265
Dmain  4 :  208
SVGs for domain  1 : ['ENSG00000171617']
Add gene:  ENSG00000171476
Minus gene:  ENSG00000197971
Absolute mean change: 1.7793732
Number of non-target spots reduced to: 429
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000171476-ENSG00000197971
===========================================================================
Add gene:  ENSG00000154146
Minus gene:  ENSG00000123560
Absolute mean change: 2.951692
Number of non-target spots reduced to: 123
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000171476-ENSG00000197971+ENSG00000154146-ENSG00000123560
===========================================================================
Add gene:  ENSG00000221890
Minus gene:  ENSG00000165023
Absolute mean change: 3.2919111
Number of non-target spots reduced to: 79
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000171476-ENSG00000197971+ENSG00000154146-ENSG00000123560+ENSG00000221890-ENSG00000165023
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.81138801574707], num_nbr [1.0, 322.54852320675104]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.612800776958466], num_nbr [1.0, 109.88396624472574]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.013507157564163], num_nbr [1.0, 34.9451476793249]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.213860347867012], num_nbr [1.0, 20.122362869198312]
Calculateing adj matrix using xy only...
Run 5: radius [2.3140369430184364, 3.213860347867012], num_nbr [8.765822784810126, 20.122362869198312]
Calculateing adj matrix using xy only...
Run 6: radius [2.7639486454427242, 3.213860347867012], num_nbr [8.765822784810126, 20.122362869198312]
Calculateing adj matrix using xy only...
recommended radius =  2.988904496654868 num_nbr=12.556962025316455
radius= 2.988904496654868 average number of neighbors for each spot is 12.556962025316455
 Cluster 2 has neighbors:
Dmain  5 :  1737
Dmain  4 :  701
Dmain  3 :  350
Dmain  6 :  296
Dmain  1 :  265
SVGs for domain  2 : ['ENSG00000132639']
Add gene:  ENSG00000123560
Minus gene:  ENSG00000198938
Absolute mean change: 1.5945144
Number of non-target spots reduced to: 115
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000123560-ENSG00000198938
===========================================================================
Add gene:  ENSG00000139970
Minus gene:  ENSG00000123560
Stopped! Previous Number of non-target spots 115 200 1.5945144 1.8890688
Previous Number of non-target spots 115 200 1.5945144 1.8890688
Previous Number of non-target spots 115
Current Number of non-target spots 200
Absolute mean change 1.5945144
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000123560-ENSG00000198938
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.81138801574707], num_nbr [1.0, 345.0366666666667]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.612800776958466], num_nbr [1.0, 112.94]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.013507157564163], num_nbr [1.0, 35.35166666666667]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.213860347867012], num_nbr [1.0, 20.231666666666666]
Calculateing adj matrix using xy only...
Run 5: radius [2.3140369430184364, 3.213860347867012], num_nbr [8.773333333333333, 20.231666666666666]
Calculateing adj matrix using xy only...
Run 6: radius [2.7639486454427242, 3.213860347867012], num_nbr [8.773333333333333, 20.231666666666666]
Calculateing adj matrix using xy only...
recommended radius =  2.988904496654868 num_nbr=12.591666666666667
radius= 2.988904496654868 average number of neighbors for each spot is 12.591666666666667
 Cluster 3 has neighbors:
Dmain  1 :  2258
Dmain  0 :  612
Dmain  5 :  498
Dmain  4 :  425
Dmain  2 :  350
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000198899', 'ENSG00000198712', 'ENSG00000198727', 'ENSG00000198840', 'ENSG00000198938', 'ENSG00000198804']
Add gene:  ENSG00000145824
Minus gene:  ENSG00000132639
Absolute mean change: 0.47251177
Number of non-target spots reduced to: 1474
===========================================================================
Meta gene is:  ENSG00000198899+ENSG00000145824-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Absolute mean change: 0.5348191
Number of non-target spots reduced to: 643
===========================================================================
Meta gene is:  ENSG00000198899+ENSG00000145824-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 643 893 0.5348191 0.47251177
Previous Number of non-target spots 643 893 0.5348191 0.47251177
Previous Number of non-target spots 643
Current Number of non-target spots 893
Absolute mean change 0.5348191
===========================================================================
Meta gene:  ENSG00000198899+ENSG00000145824-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.81138801574707], num_nbr [1.0, 339.19011406844106]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.612800776958466], num_nbr [1.0, 113.29657794676807]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.013507157564163], num_nbr [1.0, 35.69961977186312]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.213860347867012], num_nbr [1.0, 20.456273764258555]
Calculateing adj matrix using xy only...
Run 5: radius [2.3140369430184364, 3.213860347867012], num_nbr [8.866920152091256, 20.456273764258555]
Calculateing adj matrix using xy only...
Run 6: radius [2.7639486454427242, 3.213860347867012], num_nbr [8.866920152091256, 20.456273764258555]
Calculateing adj matrix using xy only...
recommended radius =  2.988904496654868 num_nbr=12.73384030418251
radius= 2.988904496654868 average number of neighbors for each spot is 12.73384030418251
 Cluster 4 has neighbors:
Dmain  5 :  941
Dmain  2 :  701
Dmain  3 :  425
SVGs for domain  4 : ['ENSG00000132639']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000187094
Absolute mean change: 1.2155616
Number of non-target spots reduced to: 568
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000183036-ENSG00000187094
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000183036
Stopped! Previous Number of non-target spots 568 275 1.2155616 0.9323977
Previous Number of non-target spots 568 275 1.2155616 0.9323977
Previous Number of non-target spots 568
Current Number of non-target spots 275
Absolute mean change 1.2155616
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000183036-ENSG00000187094
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.81138801574707], num_nbr [1.0, 324.1322645290581]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.612800776958466], num_nbr [1.0, 110.18637274549098]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.013507157564163], num_nbr [1.0, 35.25050100200401]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.213860347867012], num_nbr [1.0, 20.296593186372746]
Calculateing adj matrix using xy only...
Run 5: radius [2.3140369430184364, 3.213860347867012], num_nbr [8.82565130260521, 20.296593186372746]
Calculateing adj matrix using xy only...
Run 6: radius [2.7639486454427242, 3.213860347867012], num_nbr [8.82565130260521, 20.296593186372746]
Calculateing adj matrix using xy only...
recommended radius =  2.988904496654868 num_nbr=12.657314629258517
radius= 2.988904496654868 average number of neighbors for each spot is 12.657314629258517
 Cluster 5 has neighbors:
Dmain  2 :  1737
Dmain  4 :  941
Dmain  3 :  498
Dmain  6 :  255
SVGs for domain  5 : ['ENSG00000197971', 'ENSG00000123560']
Add gene:  ENSG00000228253
Minus gene:  ENSG00000197971
Absolute mean change: 0.2359699
Number of non-target spots reduced to: 564
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000228253-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000228253
Stopped! Previous Number of non-target spots 564 806 0.2359699 0.8108109
Previous Number of non-target spots 564 806 0.2359699 0.8108109
Previous Number of non-target spots 564
Current Number of non-target spots 806
Absolute mean change 0.2359699
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000228253-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 15.81138801574707], num_nbr [1.0, 245.13636363636363]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.612800776958466], num_nbr [1.0, 92.84343434343434]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.013507157564163], num_nbr [1.0, 32.27272727272727]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.213860347867012], num_nbr [1.0, 19.075757575757574]
Calculateing adj matrix using xy only...
Run 5: radius [2.3140369430184364, 3.213860347867012], num_nbr [8.525252525252526, 19.075757575757574]
Calculateing adj matrix using xy only...
Run 6: radius [2.7639486454427242, 3.213860347867012], num_nbr [8.525252525252526, 19.075757575757574]
Calculateing adj matrix using xy only...
recommended radius =  2.988904496654868 num_nbr=12.05050505050505
radius= 2.988904496654868 average number of neighbors for each spot is 12.05050505050505
 Cluster 6 has neighbors:
Dmain  2 :  296
Dmain  5 :  255
SVGs for domain  6 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000173786', 'ENSG00000131095']
Add gene:  ENSG00000123560
Minus gene:  ENSG00000198938
Absolute mean change: 3.6320763
Number of non-target spots reduced to: 191
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000123560-ENSG00000198938
===========================================================================
Add gene:  ENSG00000213977
Minus gene:  ENSG00000154096
Absolute mean change: 4.0791507
Number of non-target spots reduced to: 25
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000123560-ENSG00000198938+ENSG00000213977-ENSG00000154096
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000123560-ENSG00000198938+ENSG00000213977-ENSG00000154096
