Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8325_ant...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  495.33957569684605 864.3220415259743 395.1089678605514
Var of x,y,z =  21049881.37209717 21411418.979425866 21411418.979425874
Run 1: l [0.01, 1000], p [0.0, 20.880754482648864]
Run 2: l [0.01, 500.005], p [0.0, 3.0913028717041016]
Run 3: l [250.0075, 500.005], p [0.38277769088745117, 3.0913028717041016]
Run 4: l [250.0075, 375.00625], p [0.38277769088745117, 1.3381478786468506]
Run 5: l [250.0075, 312.50687500000004], p [0.38277769088745117, 0.7724632024765015]
Run 6: l [250.0075, 281.2571875], p [0.38277769088745117, 0.5572736263275146]
Run 7: l [265.63234375, 281.2571875], p [0.4651554822921753, 0.5572736263275146]
recommended l =  273.444765625
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  8
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.95 Num of clusters =  6
Res changed to 0.95
Initializing cluster centers with louvain, resolution =  1.0
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.0 Num of clusters =  8
Step changed to 0.025
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.975 Num of clusters =  8
Step changed to 0.0125
Initializing cluster centers with louvain, resolution =  0.9624999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9624999999999999 Num of clusters =  7
recommended res =  0.9624999999999999
Initializing cluster centers with louvain, resolution =  0.9624999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.552946090698242], num_nbr [1.0, 360.2135922330097]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.983579814434052], num_nbr [1.0, 112.8890429958391]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.198896676301956], num_nbr [1.0, 40.866851595006935]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3065551072359085], num_nbr [1.0, 19.435506241331485]
Calculateing adj matrix using xy only...
Run 5: radius [2.3603843227028847, 3.3065551072359085], num_nbr [8.478502080443828, 19.435506241331485]
Calculateing adj matrix using xy only...
recommended radius =  2.8334697149693966 num_nbr=12.147018030513177
radius= 2.8334697149693966 average number of neighbors for each spot is 12.147018030513177
 Cluster 0 has neighbors:
Dmain  3 :  956
Dmain  4 :  738
Dmain  1 :  635
Dmain  6 :  404
Dmain  2 :  260
Dmain  5 :  240
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 0 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 0!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.552946090698242], num_nbr [1.0, 339.7405797101449]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.983579814434052], num_nbr [1.0, 114.49710144927536]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.198896676301956], num_nbr [1.0, 42.471014492753625]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3065551072359085], num_nbr [1.0, 20.28840579710145]
Calculateing adj matrix using xy only...
Run 5: radius [2.3603843227028847, 3.3065551072359085], num_nbr [8.840579710144928, 20.28840579710145]
Calculateing adj matrix using xy only...
recommended radius =  2.8334697149693966 num_nbr=12.669565217391304
radius= 2.8334697149693966 average number of neighbors for each spot is 12.669565217391304
 Cluster 1 has neighbors:
Dmain  3 :  1338
Dmain  5 :  993
Dmain  6 :  826
Dmain  2 :  640
Dmain  0 :  635
Dmain  4 :  572
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000131095', 'ENSG00000251562']
Add gene:  ENSG00000131711
Minus gene:  ENSG00000131095
Absolute mean change: 0.31960654
Number of non-target spots reduced to: 1413
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000131711-ENSG00000131095
===========================================================================
Add gene:  ENSG00000251562
Minus gene:  ENSG00000131711
Stopped! Previous Number of non-target spots 1413 1063 0.31960654 0.25270975
Previous Number of non-target spots 1413 1063 0.31960654 0.25270975
Previous Number of non-target spots 1413
Current Number of non-target spots 1063
Absolute mean change 0.31960654
===========================================================================
Meta gene:  ENSG00000131095+ENSG00000131711-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.552946090698242], num_nbr [1.0, 367.97527472527474]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.983579814434052], num_nbr [1.0, 118.68956043956044]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.198896676301956], num_nbr [1.0, 42.989010989010985]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3065551072359085], num_nbr [1.0, 20.425824175824175]
Calculateing adj matrix using xy only...
Run 5: radius [2.3603843227028847, 3.3065551072359085], num_nbr [8.873626373626374, 20.425824175824175]
Calculateing adj matrix using xy only...
recommended radius =  2.8334697149693966 num_nbr=12.733516483516484
radius= 2.8334697149693966 average number of neighbors for each spot is 12.733516483516484
 Cluster 2 has neighbors:
Dmain  3 :  1191
Dmain  6 :  670
Dmain  1 :  640
Dmain  5 :  174
SVGs for domain  2 : ['ENSG00000132639']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000171617
Absolute mean change: 1.1420755
Number of non-target spots reduced to: 625
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000183036-ENSG00000171617
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000183036
Stopped! Previous Number of non-target spots 625 328 1.1420755 0.7304654
Previous Number of non-target spots 625 328 1.1420755 0.7304654
Previous Number of non-target spots 625
Current Number of non-target spots 328
Absolute mean change 1.1420755
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000183036-ENSG00000171617
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.552946090698242], num_nbr [1.0, 349.55625]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.983579814434052], num_nbr [1.0, 113.9203125]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.198896676301956], num_nbr [1.0, 41.6953125]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3065551072359085], num_nbr [1.0, 19.9078125]
Calculateing adj matrix using xy only...
Run 5: radius [2.3603843227028847, 3.3065551072359085], num_nbr [8.7140625, 19.9078125]
Calculateing adj matrix using xy only...
recommended radius =  2.8334697149693966 num_nbr=12.4515625
radius= 2.8334697149693966 average number of neighbors for each spot is 12.4515625
 Cluster 3 has neighbors:
Dmain  1 :  1338
Dmain  2 :  1191
Dmain  0 :  956
Dmain  6 :  763
Dmain  5 :  589
Dmain  4 :  380
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000197971']
Add gene:  ENSG00000164494
Minus gene:  ENSG00000132639
Absolute mean change: 0.50674176
Number of non-target spots reduced to: 1113
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000164494-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 1113 738 0.50674176 0.40486932
Previous Number of non-target spots 1113 738 0.50674176 0.40486932
Previous Number of non-target spots 1113
Current Number of non-target spots 738
Absolute mean change 0.50674176
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000164494-ENSG00000132639
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.552946090698242], num_nbr [1.0, 380.7209944751381]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.983579814434052], num_nbr [1.0, 118.56353591160222]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.198896676301956], num_nbr [1.0, 42.62707182320442]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3065551072359085], num_nbr [1.0, 20.2292817679558]
Calculateing adj matrix using xy only...
Run 5: radius [2.3603843227028847, 3.3065551072359085], num_nbr [8.814917127071823, 20.2292817679558]
Calculateing adj matrix using xy only...
recommended radius =  2.8334697149693966 num_nbr=12.616022099447514
radius= 2.8334697149693966 average number of neighbors for each spot is 12.616022099447514
 Cluster 4 has neighbors:
Dmain  6 :  990
Dmain  0 :  738
Dmain  1 :  572
Dmain  3 :  380
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000198786', 'ENSG00000198763', 'ENSG00000198888', 'ENSG00000198840', 'ENSG00000198899', 'ENSG00000198804', 'ENSG00000198712', 'ENSG00000269028', 'ENSG00000101439', 'ENSG00000256618', 'ENSG00000212907', 'ENSG00000162545', 'ENSG00000110436']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 0.9340937
Number of non-target spots reduced to: 1368
===========================================================================
Meta gene is:  ENSG00000198786+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000131711
Stopped! Previous Number of non-target spots 1368 484 0.9340937 0.64816713
Previous Number of non-target spots 1368 484 0.9340937 0.64816713
Previous Number of non-target spots 1368
Current Number of non-target spots 484
Absolute mean change 0.9340937
===========================================================================
Meta gene:  ENSG00000198786+ENSG00000115756-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.552946090698242], num_nbr [1.0, 325.61290322580646]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.983579814434052], num_nbr [1.0, 112.51935483870967]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.198896676301956], num_nbr [1.0, 42.10322580645161]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3065551072359085], num_nbr [1.0, 20.216129032258063]
Calculateing adj matrix using xy only...
Run 5: radius [2.3603843227028847, 3.3065551072359085], num_nbr [8.832258064516129, 20.216129032258063]
Calculateing adj matrix using xy only...
recommended radius =  2.8334697149693966 num_nbr=12.63225806451613
radius= 2.8334697149693966 average number of neighbors for each spot is 12.63225806451613
 Cluster 5 has neighbors:
Dmain  1 :  993
Dmain  3 :  589
SVGs for domain  5 : ['ENSG00000132639']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000132639
Absolute mean change: 0.765476
Number of non-target spots reduced to: 549
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000197971-ENSG00000132639
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 549 573 0.765476 0.7942647
Previous Number of non-target spots 549 573 0.765476 0.7942647
Previous Number of non-target spots 549
Current Number of non-target spots 573
Absolute mean change 0.765476
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000197971-ENSG00000132639
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.552946090698242], num_nbr [1.0, 385.841628959276]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.983579814434052], num_nbr [1.0, 121.55203619909503]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.198896676301956], num_nbr [1.0, 43.63574660633484]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3065551072359085], num_nbr [1.0, 20.622171945701357]
Calculateing adj matrix using xy only...
Run 5: radius [2.3603843227028847, 3.3065551072359085], num_nbr [8.90950226244344, 20.622171945701357]
Calculateing adj matrix using xy only...
recommended radius =  2.8334697149693966 num_nbr=12.823529411764707
radius= 2.8334697149693966 average number of neighbors for each spot is 12.823529411764707
 Cluster 6 has neighbors:
Dmain  4 :  990
Dmain  1 :  826
Dmain  3 :  763
Dmain  2 :  670
Dmain  0 :  404
Dmain  5 :  185
SVGs for domain  6 : ['ENSG00000163032']
Add gene:  ENSG00000171617
Minus gene:  ENSG00000197971
Absolute mean change: 2.1145473
Number of non-target spots reduced to: 153
===========================================================================
Meta gene is:  ENSG00000163032+ENSG00000171617-ENSG00000197971
===========================================================================
Add gene:  ENSG00000154277
Minus gene:  ENSG00000131095
Absolute mean change: 3.278253
Number of non-target spots reduced to: 93
===========================================================================
Meta gene is:  ENSG00000163032+ENSG00000171617-ENSG00000197971+ENSG00000154277-ENSG00000131095
===========================================================================
Add gene:  ENSG00000014641
Minus gene:  ENSG00000159079
Absolute mean change: 4.178322
Number of non-target spots reduced to: 57
===========================================================================
Meta gene is:  ENSG00000163032+ENSG00000171617-ENSG00000197971+ENSG00000154277-ENSG00000131095+ENSG00000014641-ENSG00000159079
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
