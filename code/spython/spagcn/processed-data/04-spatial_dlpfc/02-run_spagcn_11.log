Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8492_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  245.13828611209445 432.85357542264114 214.93687912291185
Var of x,y,z =  25664966.186181 26209601.063802972 26209601.063802965
Run 1: l [0.01, 1000], p [0.0, 24.299597655895624]
Run 2: l [0.01, 500.005], p [0.0, 3.575868606567383]
Run 3: l [250.0075, 500.005], p [0.43134748935699463, 3.575868606567383]
Run 4: l [250.0075, 375.00625], p [0.43134748935699463, 1.5374233722686768]
Run 5: l [250.0075, 312.50687500000004], p [0.43134748935699463, 0.8816157579421997]
Run 6: l [250.0075, 281.2571875], p [0.43134748935699463, 0.6326775550842285]
Run 7: l [250.0075, 265.63234375], p [0.43134748935699463, 0.5263074636459351]
Run 8: l [257.819921875, 265.63234375], p [0.4774327278137207, 0.5263074636459351]
recommended l =  261.7261328125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.479166666666666, 412.359375]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.479166666666666, 143.24305555555554]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.479166666666666, 53.916666666666664]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.479166666666666, 22.850694444444443]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.027777777777779
radius= 3.027443051338196 average number of neighbors for each spot is 12.027777777777779
 Cluster 0 has neighbors:
Dmain  3 :  621
Dmain  1 :  545
Dmain  2 :  474
Dmain  5 :  396
Dmain  4 :  277
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000251562']
Add gene:  ENSG00000240583
Minus gene:  ENSG00000198712
Absolute mean change: 0.7176118
Number of non-target spots reduced to: 1954
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000240583-ENSG00000198712
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000102606
Absolute mean change: 0.9492605
Number of non-target spots reduced to: 635
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000240583-ENSG00000198712+ENSG00000197971-ENSG00000102606
===========================================================================
Add gene:  ENSG00000198763
Minus gene:  ENSG00000173267
Stopped! Previous Number of non-target spots 635 683 0.9492605 0.95436144
Previous Number of non-target spots 635 683 0.9492605 0.95436144
Previous Number of non-target spots 635
Current Number of non-target spots 683
Absolute mean change 0.9492605
===========================================================================
Meta gene:  ENSG00000251562+ENSG00000240583-ENSG00000198712+ENSG00000197971-ENSG00000102606
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.969655172413793, 488.5751724137931]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.969655172413793, 162.9406896551724]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.969655172413793, 59.82896551724138]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.969655172413793, 24.76137931034483]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.929655172413794
radius= 3.027443051338196 average number of neighbors for each spot is 12.929655172413794
 Cluster 1 has neighbors:
Dmain  6 :  2573
Dmain  4 :  1897
Dmain  2 :  701
Dmain  0 :  545
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000197971']
Add gene:  ENSG00000104435
Minus gene:  ENSG00000197971
Absolute mean change: 0.37733102
Number of non-target spots reduced to: 1149
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000104435-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000104435
Absolute mean change: 0.37761688
Number of non-target spots reduced to: 889
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000104435-ENSG00000197971+ENSG00000197971-ENSG00000104435
===========================================================================
Add gene:  ENSG00000104435
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 889 1149 0.37761688 0.37733102
Previous Number of non-target spots 889 1149 0.37761688 0.37733102
Previous Number of non-target spots 889
Current Number of non-target spots 1149
Absolute mean change 0.37761688
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000104435-ENSG00000197971+ENSG00000197971-ENSG00000104435
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.894656488549618, 447.3267175572519]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.894656488549618, 154.17709923664123]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.894656488549618, 58.10687022900763]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.894656488549618, 24.357251908396947]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.772519083969465
radius= 3.027443051338196 average number of neighbors for each spot is 12.772519083969465
 Cluster 2 has neighbors:
Dmain  3 :  2051
Dmain  6 :  1007
Dmain  1 :  701
Dmain  4 :  691
Dmain  0 :  474
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000171617']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000171617
Absolute mean change: 0.31434804
Number of non-target spots reduced to: 993
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000171617
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000115756
Stopped! Previous Number of non-target spots 993 1168 0.31434804 0.6403208
Previous Number of non-target spots 993 1168 0.31434804 0.6403208
Previous Number of non-target spots 993
Current Number of non-target spots 1168
Absolute mean change 0.31434804
===========================================================================
Meta gene:  ENSG00000171617+ENSG00000115756-ENSG00000171617
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.75253807106599, 398.35659898477155]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.75253807106599, 145.13071065989848]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.75253807106599, 55.97969543147208]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.75253807106599, 23.762690355329948]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.52284263959391
radius= 3.027443051338196 average number of neighbors for each spot is 12.52284263959391
 Cluster 3 has neighbors:
Dmain  2 :  2051
Dmain  0 :  621
Dmain  6 :  402
Dmain  4 :  398
SVGs for domain  3 : ['ENSG00000198763', 'ENSG00000198840', 'ENSG00000198888', 'ENSG00000198899']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000123416
Absolute mean change: 1.3285928
Number of non-target spots reduced to: 653
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000131095-ENSG00000123416
===========================================================================
Add gene:  ENSG00000198840
Minus gene:  ENSG00000197971
Absolute mean change: 2.2795873
Number of non-target spots reduced to: 311
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000131095-ENSG00000123416+ENSG00000198840-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000139970
Stopped! Previous Number of non-target spots 311 152 2.2795873 2.130083
Previous Number of non-target spots 311 152 2.2795873 2.130083
Previous Number of non-target spots 311
Current Number of non-target spots 152
Absolute mean change 2.2795873
===========================================================================
Meta gene:  ENSG00000198763+ENSG00000131095-ENSG00000123416+ENSG00000198840-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.96745027124774, 485.1464737793852]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.96745027124774, 162.65822784810126]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.96745027124774, 59.94755877034358]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.96745027124774, 24.795660036166364]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.933092224231464
radius= 3.027443051338196 average number of neighbors for each spot is 12.933092224231464
 Cluster 4 has neighbors:
Dmain  1 :  1897
Dmain  6 :  1767
Dmain  2 :  691
Dmain  3 :  398
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000269028', 'ENSG00000123560']
Add gene:  ENSG00000123560
Minus gene:  ENSG00000269028
Absolute mean change: 0.3058442
Number of non-target spots reduced to: 1465
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000123560-ENSG00000269028
===========================================================================
Add gene:  ENSG00000269028
Minus gene:  ENSG00000123560
Stopped! Previous Number of non-target spots 1465 1015 0.3058442 0.25744855
Previous Number of non-target spots 1465 1015 0.3058442 0.25744855
Previous Number of non-target spots 1465
Current Number of non-target spots 1015
Absolute mean change 0.3058442
===========================================================================
Meta gene:  ENSG00000269028+ENSG00000123560-ENSG00000269028
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.455172413793104, 339.5655172413793]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.455172413793104, 130.0735632183908]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.455172413793104, 51.786206896551725]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.455172413793104, 22.50344827586207]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=11.979310344827587
radius= 3.027443051338196 average number of neighbors for each spot is 11.979310344827587
 Cluster 5 has neighbors:
Dmain  0 :  396
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 5 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 5!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.995732574679943, 492.7425320056899]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.995732574679943, 164.77951635846372]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.995732574679943, 60.42247510668563]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.995732574679943, 24.91465149359886]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.987197724039829
radius= 3.027443051338196 average number of neighbors for each spot is 12.987197724039829
 Cluster 6 has neighbors:
Dmain  1 :  2573
Dmain  4 :  1767
Dmain  2 :  1007
Dmain  3 :  402
SVGs for domain  6 : ['ENSG00000132639']
Add gene:  ENSG00000154277
Minus gene:  ENSG00000132639
Absolute mean change: 0.8763249
Number of non-target spots reduced to: 290
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000154277-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000198888
Stopped! Previous Number of non-target spots 290 380 0.8763249 1.6058674
Previous Number of non-target spots 290 380 0.8763249 1.6058674
Previous Number of non-target spots 290
Current Number of non-target spots 380
Absolute mean change 0.8763249
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000154277-ENSG00000132639
===========================================================================
