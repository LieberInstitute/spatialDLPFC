Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151508...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  28.563328316572168 161.2834385759296 38.72560117831281
Var of x,y,z =  6612413.792811982 5377146.366203446 6612413.792811982
Run 1: l [0.01, 1000], p [0.0, 148.50972434668424]
Run 2: l [0.01, 500.005], p [0.0, 26.32495880126953]
Run 3: l [0.01, 250.0075], p [0.0, 3.9295754432678223]
Run 4: l [125.00874999999999, 250.0075], p [0.48657655715942383, 3.9295754432678223]
Run 5: l [125.00874999999999, 187.508125], p [0.48657655715942383, 1.702890157699585]
Run 6: l [125.00874999999999, 156.2584375], p [0.48657655715942383, 0.9831609725952148]
Run 7: l [125.00874999999999, 140.63359375], p [0.48657655715942383, 0.7089956998825073]
Run 8: l [125.00874999999999, 132.821171875], p [0.48657655715942383, 0.5915789604187012]
Run 9: l [125.00874999999999, 128.91496093749998], p [0.48657655715942383, 0.5375591516494751]
Run 10: l [125.00874999999999, 126.96185546874999], p [0.48657655715942383, 0.5116925239562988]
recommended l =  125.98530273437498
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  7
recommended res =  0.9999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.771844660194175, 424.11893203883494]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.771844660194175, 142.7621359223301]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.771844660194175, 56.70631067961165]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.771844660194175, 23.891990291262136]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.560679611650485
radius= 3.0240485668182373 average number of neighbors for each spot is 12.560679611650485
 Cluster 0 has neighbors:
Dmain  4 :  715
SVGs for domain  0 : ['ENSG00000131095']
Add gene:  ENSG00000182600
Minus gene:  ENSG00000034510
Absolute mean change: 1.8994629
Number of non-target spots reduced to: 414
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000182600-ENSG00000034510
===========================================================================
Add gene:  ENSG00000101439
Minus gene:  ENSG00000197971
Absolute mean change: 2.6584072
Number of non-target spots reduced to: 73
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000182600-ENSG00000034510+ENSG00000101439-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198804
Stopped! Previous Number of non-target spots 73 53 2.6584072 2.5776176
Previous Number of non-target spots 73 53 2.6584072 2.5776176
Previous Number of non-target spots 73
Current Number of non-target spots 53
Absolute mean change 2.6584072
===========================================================================
Meta gene:  ENSG00000131095+ENSG00000182600-ENSG00000034510+ENSG00000101439-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.3125, 339.05263157894734]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.3125, 122.15460526315789]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.3125, 50.85197368421053]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.3125, 22.05592105263158]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=11.74671052631579
radius= 3.0240485668182373 average number of neighbors for each spot is 11.74671052631579
 Cluster 1 has neighbors:
Dmain  6 :  499
Dmain  3 :  486
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000110484']
Add gene:  ENSG00000163191
Minus gene:  ENSG00000198899
Absolute mean change: 1.6535153
Number of non-target spots reduced to: 1093
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000163191-ENSG00000198899
===========================================================================
Add gene:  ENSG00000160014
Minus gene:  ENSG00000163191
Stopped! Previous Number of non-target spots 1093 446 1.6535153 1.26596
Previous Number of non-target spots 1093 446 1.6535153 1.26596
Previous Number of non-target spots 1093
Current Number of non-target spots 446
Absolute mean change 1.6535153
===========================================================================
Meta gene:  ENSG00000110484+ENSG00000163191-ENSG00000198899
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.751543209876543, 438.1929012345679]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.751543209876543, 144.54012345679013]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.751543209876543, 56.88117283950617]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.751543209876543, 23.878086419753085]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.532407407407407
radius= 3.0240485668182373 average number of neighbors for each spot is 12.532407407407407
 Cluster 2 has neighbors:
Dmain  4 :  1866
Dmain  5 :  495
Dmain  3 :  438
SVGs for domain  2 : ['ENSG00000162545', 'ENSG00000171617']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 1.6281631
Number of non-target spots reduced to: 475
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000130558
Minus gene:  ENSG00000211592
Absolute mean change: 2.3481708
Number of non-target spots reduced to: 184
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971+ENSG00000130558-ENSG00000211592
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000100097
Absolute mean change: 3.2307224
Number of non-target spots reduced to: 166
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971+ENSG00000130558-ENSG00000211592+ENSG00000171617-ENSG00000100097
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.95204678362573, 492.9894736842105]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.95204678362573, 157.1730994152047]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.95204678362573, 60.2187134502924]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.95204678362573, 24.789473684210527]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.909941520467836
radius= 3.0240485668182373 average number of neighbors for each spot is 12.909941520467836
 Cluster 3 has neighbors:
Dmain  5 :  3988
Dmain  4 :  682
Dmain  1 :  486
Dmain  2 :  438
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 3 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 3!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.76936936936937, 446.05405405405406]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.76936936936937, 146.45945945945945]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.76936936936937, 57.475675675675674]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.76936936936937, 24.03963963963964]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.598198198198197
radius= 3.0240485668182373 average number of neighbors for each spot is 12.598198198198197
 Cluster 4 has neighbors:
Dmain  2 :  1866
Dmain  5 :  1140
Dmain  0 :  715
Dmain  3 :  682
Dmain  1 :  213
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000079215']
Add gene:  ENSG00000173432
Minus gene:  ENSG00000079215
Absolute mean change: 0.095111534
Number of non-target spots reduced to: 1608
===========================================================================
Meta gene is:  ENSG00000079215+ENSG00000173432-ENSG00000079215
===========================================================================
Add gene:  ENSG00000256618
Minus gene:  ENSG00000173432
Absolute mean change: 0.12748253
Number of non-target spots reduced to: 771
===========================================================================
Meta gene is:  ENSG00000079215+ENSG00000173432-ENSG00000079215+ENSG00000256618-ENSG00000173432
===========================================================================
Add gene:  ENSG00000173432
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 771 2099 0.12748253 0.42322016
Previous Number of non-target spots 771 2099 0.12748253 0.42322016
Previous Number of non-target spots 771
Current Number of non-target spots 2099
Absolute mean change 0.12748253
===========================================================================
Meta gene:  ENSG00000079215+ENSG00000173432-ENSG00000079215+ENSG00000256618-ENSG00000173432
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.94683257918552, 485.60067873303166]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.94683257918552, 155.4683257918552]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.94683257918552, 59.873303167420815]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.94683257918552, 24.735294117647058]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.89819004524887
radius= 3.0240485668182373 average number of neighbors for each spot is 12.89819004524887
 Cluster 5 has neighbors:
Dmain  3 :  3988
Dmain  4 :  1140
Dmain  2 :  495
Dmain  1 :  318
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000197971']
Add gene:  ENSG00000198786
Minus gene:  ENSG00000197971
Absolute mean change: 0.21091104
Number of non-target spots reduced to: 1123
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000198786-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198786
Stopped! Previous Number of non-target spots 1123 1350 0.21091104 0.26518542
Previous Number of non-target spots 1123 1350 0.21091104 0.26518542
Previous Number of non-target spots 1123
Current Number of non-target spots 1350
Absolute mean change 0.21091104
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000198786-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.384777069091797], num_nbr [8.605095541401274, 342.96815286624206]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.192388534545898], num_nbr [8.605095541401274, 123.96496815286625]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.096194267272949], num_nbr [8.605095541401274, 52.254777070063696]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.048097133636475], num_nbr [8.605095541401274, 22.808917197452228]
Calculateing adj matrix using xy only...
recommended radius =  3.0240485668182373 num_nbr=12.21656050955414
radius= 3.0240485668182373 average number of neighbors for each spot is 12.21656050955414
 Cluster 6 has neighbors:
Dmain  1 :  499
SVGs for domain  6 : ['ENSG00000197971']
Add gene:  ENSG00000163191
Minus gene:  ENSG00000198886
Absolute mean change: 2.3712218
Number of non-target spots reduced to: 513
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000163191-ENSG00000198886
===========================================================================
Add gene:  ENSG00000143947
Minus gene:  ENSG00000198938
Absolute mean change: 3.286255
Number of non-target spots reduced to: 16
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000163191-ENSG00000198886+ENSG00000143947-ENSG00000198938
===========================================================================
Add gene:  ENSG00000173786
Minus gene:  ENSG00000136156
Absolute mean change: 4.2177505
Number of non-target spots reduced to: 8
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000163191-ENSG00000198886+ENSG00000143947-ENSG00000198938+ENSG00000173786-ENSG00000136156
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
