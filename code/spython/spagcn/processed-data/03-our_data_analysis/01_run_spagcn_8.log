Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151672...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  18.251849298436454 68.09764364817659 31.39689458195933
Var of x,y,z =  5371818.0525032375 5596853.545481531 5596853.545481531
Run 1: l [0.01, 1000], p [0.0, 127.64334023897288]
Run 2: l [0.01, 500.005], p [0.0, 19.982290267944336]
Run 3: l [0.01, 250.0075], p [0.0, 2.7337725162506104]
Run 4: l [125.00874999999999, 250.0075], p [0.31588149070739746, 2.7337725162506104]
Run 5: l [125.00874999999999, 187.508125], p [0.31588149070739746, 1.146373987197876]
Run 6: l [125.00874999999999, 156.2584375], p [0.31588149070739746, 0.6494024991989136]
Run 7: l [140.63359375, 156.2584375], p [0.46399688720703125, 0.6494024991989136]
Run 8: l [140.63359375, 148.446015625], p [0.46399688720703125, 0.551804780960083]
recommended l =  144.5398046875
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  8
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.95 Num of clusters =  6
Res changed to 0.95
Initializing cluster centers with louvain, resolution =  1.0
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.0 Num of clusters =  8
Step changed to 0.025
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.975 Num of clusters =  7
recommended res =  0.975
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.492855072021484], num_nbr [8.73532668881506, 396.4042081949059]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.746427536010742], num_nbr [8.73532668881506, 131.0409745293466]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.873213768005371], num_nbr [8.73532668881506, 53.306755260243634]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9366068840026855], num_nbr [8.73532668881506, 20.083056478405314]
Calculateing adj matrix using xy only...
recommended radius =  2.9683034420013428 num_nbr=12.521594684385382
radius= 2.9683034420013428 average number of neighbors for each spot is 12.521594684385382
 Cluster 0 has neighbors:
Dmain  5 :  2641
Dmain  2 :  1864
Dmain  6 :  562
Dmain  3 :  398
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000228253']
Add gene:  ENSG00000173432
Minus gene:  ENSG00000132639
Absolute mean change: 0.68075776
Number of non-target spots reduced to: 1624
===========================================================================
Meta gene is:  ENSG00000228253+ENSG00000173432-ENSG00000132639
===========================================================================
Add gene:  ENSG00000269028
Minus gene:  ENSG00000110484
Absolute mean change: 1.3877501
Number of non-target spots reduced to: 654
===========================================================================
Meta gene is:  ENSG00000228253+ENSG00000173432-ENSG00000132639+ENSG00000269028-ENSG00000110484
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000111640
Stopped! Previous Number of non-target spots 654 508 1.3877501 1.0532098
Previous Number of non-target spots 654 508 1.3877501 1.0532098
Previous Number of non-target spots 654
Current Number of non-target spots 508
Absolute mean change 1.3877501
===========================================================================
Meta gene:  ENSG00000228253+ENSG00000173432-ENSG00000132639+ENSG00000269028-ENSG00000110484
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.492855072021484], num_nbr [8.822843822843822, 424.44055944055947]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.746427536010742], num_nbr [8.822843822843822, 136.03729603729604]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.873213768005371], num_nbr [8.822843822843822, 54.66899766899767]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9366068840026855], num_nbr [8.822843822843822, 20.435897435897434]
Calculateing adj matrix using xy only...
recommended radius =  2.9683034420013428 num_nbr=12.696969696969697
radius= 2.9683034420013428 average number of neighbors for each spot is 12.696969696969697
 Cluster 1 has neighbors:
Dmain  6 :  1730
Dmain  3 :  515
SVGs for domain  1 : ['ENSG00000187094', 'ENSG00000154096', 'ENSG00000128989']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000173267
Absolute mean change: 1.415153
Number of non-target spots reduced to: 557
===========================================================================
Meta gene is:  ENSG00000187094+ENSG00000197971-ENSG00000173267
===========================================================================
Add gene:  ENSG00000150625
Minus gene:  ENSG00000197971
Absolute mean change: 1.4979892
Number of non-target spots reduced to: 281
===========================================================================
Meta gene is:  ENSG00000187094+ENSG00000197971-ENSG00000173267+ENSG00000150625-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000164326
Absolute mean change: 2.2341652
Number of non-target spots reduced to: 272
===========================================================================
Meta gene is:  ENSG00000187094+ENSG00000197971-ENSG00000173267+ENSG00000150625-ENSG00000197971+ENSG00000197971-ENSG00000164326
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.492855072021484], num_nbr [8.331967213114755, 325.2827868852459]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.746427536010742], num_nbr [8.331967213114755, 112.53688524590164]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.873213768005371], num_nbr [8.331967213114755, 47.64754098360656]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9366068840026855], num_nbr [8.331967213114755, 18.66188524590164]
Calculateing adj matrix using xy only...
recommended radius =  2.9683034420013428 num_nbr=11.776639344262295
radius= 2.9683034420013428 average number of neighbors for each spot is 11.776639344262295
 Cluster 2 has neighbors:
Dmain  0 :  1864
Dmain  5 :  670
SVGs for domain  2 : ['ENSG00000251562']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000198938
Absolute mean change: 0.9452629
Number of non-target spots reduced to: 836
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000115756-ENSG00000198938
===========================================================================
Add gene:  ENSG00000162545
Minus gene:  ENSG00000197971
Absolute mean change: 1.8256264
Number of non-target spots reduced to: 530
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000115756-ENSG00000198938+ENSG00000162545-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000171345
Stopped! Previous Number of non-target spots 530 244 1.8256264 1.407855
Previous Number of non-target spots 530 244 1.8256264 1.407855
Previous Number of non-target spots 530
Current Number of non-target spots 244
Absolute mean change 1.8256264
===========================================================================
Meta gene:  ENSG00000251562+ENSG00000115756-ENSG00000198938+ENSG00000162545-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.492855072021484], num_nbr [8.817343173431734, 431.3191881918819]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.746427536010742], num_nbr [8.817343173431734, 136.0258302583026]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.873213768005371], num_nbr [8.817343173431734, 54.564575645756456]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9366068840026855], num_nbr [8.817343173431734, 20.40590405904059]
Calculateing adj matrix using xy only...
recommended radius =  2.9683034420013428 num_nbr=12.686346863468634
radius= 2.9683034420013428 average number of neighbors for each spot is 12.686346863468634
 Cluster 3 has neighbors:
Dmain  6 :  2101
Dmain  1 :  515
SVGs for domain  3 : ['ENSG00000189043', 'ENSG00000132639', 'ENSG00000117632', 'ENSG00000173267']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000189043
Absolute mean change: 0.72518325
Number of non-target spots reduced to: 528
===========================================================================
Meta gene is:  ENSG00000189043+ENSG00000183036-ENSG00000189043
===========================================================================
Add gene:  ENSG00000034510
Minus gene:  ENSG00000183036
Absolute mean change: 0.97442746
Number of non-target spots reduced to: 277
===========================================================================
Meta gene is:  ENSG00000189043+ENSG00000183036-ENSG00000189043+ENSG00000034510-ENSG00000183036
===========================================================================
Add gene:  ENSG00000183036
Minus gene:  ENSG00000187094
Absolute mean change: 1.410193
Number of non-target spots reduced to: 157
===========================================================================
Meta gene is:  ENSG00000189043+ENSG00000183036-ENSG00000189043+ENSG00000034510-ENSG00000183036+ENSG00000183036-ENSG00000187094
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.492855072021484], num_nbr [8.680365296803654, 361.5433789954338]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.746427536010742], num_nbr [8.680365296803654, 123.60045662100457]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.873213768005371], num_nbr [8.680365296803654, 51.406392694063925]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9366068840026855], num_nbr [8.680365296803654, 19.753424657534246]
Calculateing adj matrix using xy only...
recommended radius =  2.9683034420013428 num_nbr=12.376712328767123
radius= 2.9683034420013428 average number of neighbors for each spot is 12.376712328767123
 Cluster 4 has neighbors:
Dmain  6 :  512
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000110484']
Add gene:  ENSG00000170421
Minus gene:  ENSG00000198804
Absolute mean change: 2.7015452
Number of non-target spots reduced to: 1238
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000170421-ENSG00000198804
===========================================================================
Add gene:  ENSG00000124942
Minus gene:  ENSG00000143933
Absolute mean change: 4.055637
Number of non-target spots reduced to: 33
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000170421-ENSG00000198804+ENSG00000124942-ENSG00000143933
===========================================================================
Add gene:  ENSG00000163191
Minus gene:  ENSG00000154146
Absolute mean change: 5.8242407
Number of non-target spots reduced to: 11
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000170421-ENSG00000198804+ENSG00000124942-ENSG00000143933+ENSG00000163191-ENSG00000154146
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.492855072021484], num_nbr [8.89098532494759, 424.769392033543]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.746427536010742], num_nbr [8.89098532494759, 137.37106918238993]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.873213768005371], num_nbr [8.89098532494759, 55.14675052410902]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9366068840026855], num_nbr [8.89098532494759, 20.61006289308176]
Calculateing adj matrix using xy only...
recommended radius =  2.9683034420013428 num_nbr=12.79874213836478
radius= 2.9683034420013428 average number of neighbors for each spot is 12.79874213836478
 Cluster 5 has neighbors:
Dmain  0 :  2641
Dmain  2 :  670
SVGs for domain  5 : ['ENSG00000111640', 'ENSG00000132639']
Add gene:  ENSG00000171476
Minus gene:  ENSG00000197971
Absolute mean change: 1.3730965
Number of non-target spots reduced to: 606
===========================================================================
Meta gene is:  ENSG00000111640+ENSG00000171476-ENSG00000197971
===========================================================================
Add gene:  ENSG00000277586
Minus gene:  ENSG00000110484
Absolute mean change: 2.7666483
Number of non-target spots reduced to: 337
===========================================================================
Meta gene is:  ENSG00000111640+ENSG00000171476-ENSG00000197971+ENSG00000277586-ENSG00000110484
===========================================================================
Add gene:  ENSG00000104722
Minus gene:  ENSG00000131095
Absolute mean change: 3.694394
Number of non-target spots reduced to: 179
===========================================================================
Meta gene is:  ENSG00000111640+ENSG00000171476-ENSG00000197971+ENSG00000277586-ENSG00000110484+ENSG00000104722-ENSG00000131095
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.492855072021484], num_nbr [8.818428184281842, 424.470189701897]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.746427536010742], num_nbr [8.818428184281842, 135.8970189701897]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.873213768005371], num_nbr [8.818428184281842, 54.6219512195122]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9366068840026855], num_nbr [8.818428184281842, 20.407859078590786]
Calculateing adj matrix using xy only...
recommended radius =  2.9683034420013428 num_nbr=12.682926829268293
radius= 2.9683034420013428 average number of neighbors for each spot is 12.682926829268293
 Cluster 6 has neighbors:
Dmain  3 :  2101
Dmain  1 :  1730
Dmain  0 :  562
Dmain  4 :  512
Dmain  5 :  255
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000110484']
Add gene:  ENSG00000171345
Minus gene:  ENSG00000132639
Absolute mean change: 0.7024379
Number of non-target spots reduced to: 858
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000171345-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000171345
Stopped! Previous Number of non-target spots 858 739 0.7024379 0.53768075
Previous Number of non-target spots 858 739 0.7024379 0.53768075
Previous Number of non-target spots 858
Current Number of non-target spots 739
Absolute mean change 0.7024379
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000171345-ENSG00000132639
===========================================================================
