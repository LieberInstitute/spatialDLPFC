Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151673...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  33.31819803619232 174.58854313771744 46.8582008698976
Var of x,y,z =  5606854.693377391 4468895.610295959 5606854.693377393
Run 1: l [0.01, 1000], p [0.0, 153.83479904280972]
Run 2: l [0.01, 500.005], p [0.0, 27.998964309692383]
Run 3: l [0.01, 250.0075], p [0.0, 4.237823009490967]
Run 4: l [0.01, 125.00874999999999], p [0.0, 0.5155187845230103]
Run 5: l [62.509375, 125.00874999999999], p [0.028717637062072754, 0.5155187845230103]
Run 6: l [93.7590625, 125.00874999999999], p [0.1877666711807251, 0.5155187845230103]
Run 7: l [109.38390625, 125.00874999999999], p [0.32803165912628174, 0.5155187845230103]
Run 8: l [117.196328125, 125.00874999999999], p [0.4155467748641968, 0.5155187845230103]
Run 9: l [121.1025390625, 125.00874999999999], p [0.463936448097229, 0.5155187845230103]
Run 10: l [123.05564453125, 125.00874999999999], p [0.4893237352371216, 0.5155187845230103]
recommended l =  124.032197265625
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
delta_label  0.00494641384995878 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 61
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
delta_label  0.00494641384995878 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 82
Res =  0.7999999999999999 Num of clusters =  7
recommended res =  0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.970561981201172], num_nbr [1.0, 412.3976897689769]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.192387759685516], num_nbr [1.0, 132.94719471947195]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.303300648927689], num_nbr [1.0, 44.34158415841584]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3587570935487747], num_nbr [1.0, 20.816831683168317]
Calculateing adj matrix using xy only...
Run 5: radius [2.386485315859318, 3.3587570935487747], num_nbr [8.962046204620462, 20.816831683168317]
Calculateing adj matrix using xy only...
recommended radius =  2.8726212047040462 num_nbr=12.917491749174918
radius= 2.8726212047040462 average number of neighbors for each spot is 12.917491749174918
 Cluster 0 has neighbors:
Dmain  6 :  1087
Dmain  5 :  622
Dmain  4 :  456
SVGs for domain  0 : ['ENSG00000034510', 'ENSG00000132639', 'ENSG00000183036']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000187094
Absolute mean change: 1.3985565
Number of non-target spots reduced to: 355
===========================================================================
Meta gene is:  ENSG00000034510+ENSG00000183036-ENSG00000187094
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000091513
Absolute mean change: 1.778791
Number of non-target spots reduced to: 120
===========================================================================
Meta gene is:  ENSG00000034510+ENSG00000183036-ENSG00000187094+ENSG00000187094-ENSG00000091513
===========================================================================
Add gene:  ENSG00000091513
Minus gene:  ENSG00000198727
Stopped! Previous Number of non-target spots 120 248 1.778791 1.2846663
Previous Number of non-target spots 120 248 1.778791 1.2846663
Previous Number of non-target spots 120
Current Number of non-target spots 248
Absolute mean change 1.778791
===========================================================================
Meta gene:  ENSG00000034510+ENSG00000183036-ENSG00000187094+ENSG00000187094-ENSG00000091513
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.970561981201172], num_nbr [1.0, 317.3501628664495]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.192387759685516], num_nbr [1.0, 116.9869706840391]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.303300648927689], num_nbr [1.0, 41.806188925081436]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3587570935487747], num_nbr [1.0, 20.04885993485342]
Calculateing adj matrix using xy only...
Run 5: radius [2.386485315859318, 3.3587570935487747], num_nbr [8.752442996742671, 20.04885993485342]
Calculateing adj matrix using xy only...
recommended radius =  2.8726212047040462 num_nbr=12.53257328990228
radius= 2.8726212047040462 average number of neighbors for each spot is 12.53257328990228
 Cluster 1 has neighbors:
Dmain  4 :  699
Dmain  5 :  583
Dmain  2 :  491
SVGs for domain  1 : ['ENSG00000162545']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 2.4817064
Number of non-target spots reduced to: 123
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000100097
Stopped! Previous Number of non-target spots 123 52 2.4817064 1.7481272
Previous Number of non-target spots 123 52 2.4817064 1.7481272
Previous Number of non-target spots 123
Current Number of non-target spots 52
Absolute mean change 2.4817064
===========================================================================
Meta gene:  ENSG00000162545+ENSG00000115756-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.970561981201172], num_nbr [1.0, 264.9106145251397]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.192387759685516], num_nbr [1.0, 95.69832402234637]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.303300648927689], num_nbr [1.0, 34.60614525139665]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3587570935487747], num_nbr [1.0, 17.156424581005588]
Calculateing adj matrix using xy only...
Run 5: radius [2.386485315859318, 3.3587570935487747], num_nbr [7.824022346368715, 17.156424581005588]
Calculateing adj matrix using xy only...
recommended radius =  2.8726212047040462 num_nbr=10.938547486033519
radius= 2.8726212047040462 average number of neighbors for each spot is 10.938547486033519
 Cluster 2 has neighbors:
Dmain  1 :  491
Dmain  4 :  428
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000131095']
Add gene:  ENSG00000101335
Minus gene:  ENSG00000197971
Absolute mean change: 1.3010273
Number of non-target spots reduced to: 1907
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000101335-ENSG00000197971
===========================================================================
Add gene:  ENSG00000171345
Minus gene:  ENSG00000198712
Absolute mean change: 2.1108782
Number of non-target spots reduced to: 139
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000101335-ENSG00000197971+ENSG00000171345-ENSG00000198712
===========================================================================
Add gene:  ENSG00000171885
Minus gene:  ENSG00000123560
Absolute mean change: 3.3048701
Number of non-target spots reduced to: 82
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000101335-ENSG00000197971+ENSG00000171345-ENSG00000198712+ENSG00000171885-ENSG00000123560
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.970561981201172], num_nbr [1.0, 352.82511923688395]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.192387759685516], num_nbr [1.0, 121.63434022257552]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.303300648927689], num_nbr [1.0, 41.992050874403816]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3587570935487747], num_nbr [1.0, 20.003179650238472]
Calculateing adj matrix using xy only...
Run 5: radius [2.386485315859318, 3.3587570935487747], num_nbr [8.723370429252782, 20.003179650238472]
Calculateing adj matrix using xy only...
recommended radius =  2.8726212047040462 num_nbr=12.488076311605724
radius= 2.8726212047040462 average number of neighbors for each spot is 12.488076311605724
 Cluster 3 has neighbors:
Dmain  6 :  652
SVGs for domain  3 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000087086', 'ENSG00000131095', 'ENSG00000109846', 'ENSG00000107317', 'ENSG00000173786', 'ENSG00000108107', 'ENSG00000156508', 'ENSG00000167552', 'ENSG00000112306', 'ENSG00000160307', 'ENSG00000156482', 'ENSG00000091513', 'ENSG00000142937', 'ENSG00000105290', 'ENSG00000177954', 'ENSG00000168314', 'ENSG00000187514', 'ENSG00000099194', 'ENSG00000046653', 'ENSG00000080822', 'ENSG00000175130', 'ENSG00000108387', 'ENSG00000189058', 'ENSG00000021300', 'ENSG00000118785', 'ENSG00000129538', 'ENSG00000167641', 'ENSG00000112531', 'ENSG00000151552', 'ENSG00000167191', 'ENSG00000149557', 'ENSG00000105695', 'ENSG00000159176', 'ENSG00000166925', 'ENSG00000160781', 'ENSG00000250722', 'ENSG00000136541', 'ENSG00000013297', 'ENSG00000107331', 'ENSG00000148180', 'ENSG00000237949', 'ENSG00000064787', 'ENSG00000068903']
Meta gene is:  ENSG00000197971
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.970561981201172], num_nbr [1.0, 368.13296398891964]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.192387759685516], num_nbr [1.0, 123.45429362880887]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.303300648927689], num_nbr [1.0, 41.59279778393352]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3587570935487747], num_nbr [1.0, 19.662049861495845]
Calculateing adj matrix using xy only...
Run 5: radius [2.386485315859318, 3.3587570935487747], num_nbr [8.570637119113574, 19.662049861495845]
Calculateing adj matrix using xy only...
recommended radius =  2.8726212047040462 num_nbr=12.274238227146814
radius= 2.8726212047040462 average number of neighbors for each spot is 12.274238227146814
 Cluster 4 has neighbors:
Dmain  5 :  926
Dmain  1 :  699
Dmain  0 :  456
Dmain  2 :  428
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000165949', 'ENSG00000170421']
Add gene:  ENSG00000228253
Minus gene:  ENSG00000165949
Absolute mean change: 0.074533224
Number of non-target spots reduced to: 1392
===========================================================================
Meta gene is:  ENSG00000165949+ENSG00000228253-ENSG00000165949
===========================================================================
Add gene:  ENSG00000211592
Minus gene:  ENSG00000167996
Stopped! Previous Number of non-target spots 1392 1440 0.074533224 0.42052937
Previous Number of non-target spots 1392 1440 0.074533224 0.42052937
Previous Number of non-target spots 1392
Current Number of non-target spots 1440
Absolute mean change 0.074533224
===========================================================================
Meta gene:  ENSG00000165949+ENSG00000228253-ENSG00000165949
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.970561981201172], num_nbr [1.0, 400.80575539568343]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.192387759685516], num_nbr [1.0, 132.46043165467626]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.303300648927689], num_nbr [1.0, 44.223021582733814]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3587570935487747], num_nbr [1.0, 20.764988009592326]
Calculateing adj matrix using xy only...
Run 5: radius [2.386485315859318, 3.3587570935487747], num_nbr [8.937649880095924, 20.764988009592326]
Calculateing adj matrix using xy only...
recommended radius =  2.8726212047040462 num_nbr=12.877697841726619
radius= 2.8726212047040462 average number of neighbors for each spot is 12.877697841726619
 Cluster 5 has neighbors:
Dmain  4 :  926
Dmain  0 :  622
Dmain  1 :  583
SVGs for domain  5 : ['ENSG00000277586', 'ENSG00000104722', 'ENSG00000100285']
Add gene:  ENSG00000104722
Minus gene:  ENSG00000150625
Absolute mean change: 1.7658031
Number of non-target spots reduced to: 241
===========================================================================
Meta gene is:  ENSG00000277586+ENSG00000104722-ENSG00000150625
===========================================================================
Add gene:  ENSG00000152583
Minus gene:  ENSG00000171345
Absolute mean change: 2.5764484
Number of non-target spots reduced to: 94
===========================================================================
Meta gene is:  ENSG00000277586+ENSG00000104722-ENSG00000150625+ENSG00000152583-ENSG00000171345
===========================================================================
Add gene:  ENSG00000100285
Minus gene:  ENSG00000165023
Absolute mean change: 3.200303
Number of non-target spots reduced to: 71
===========================================================================
Meta gene is:  ENSG00000277586+ENSG00000104722-ENSG00000150625+ENSG00000152583-ENSG00000171345+ENSG00000100285-ENSG00000165023
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.970561981201172], num_nbr [1.0, 400.3761467889908]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.192387759685516], num_nbr [1.0, 129.88073394495413]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.303300648927689], num_nbr [1.0, 43.432721712538225]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3587570935487747], num_nbr [1.0, 20.44495412844037]
Calculateing adj matrix using xy only...
Run 5: radius [2.386485315859318, 3.3587570935487747], num_nbr [8.833333333333334, 20.44495412844037]
Calculateing adj matrix using xy only...
recommended radius =  2.8726212047040462 num_nbr=12.709480122324159
radius= 2.8726212047040462 average number of neighbors for each spot is 12.709480122324159
 Cluster 6 has neighbors:
Dmain  0 :  1087
Dmain  3 :  652
Dmain  4 :  201
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000187094', 'ENSG00000110484']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198899
Absolute mean change: 0.40994477
Number of non-target spots reduced to: 1714
===========================================================================
Meta gene is:  ENSG00000187094+ENSG00000197971-ENSG00000198899
===========================================================================
Add gene:  ENSG00000165023
Minus gene:  ENSG00000167996
Absolute mean change: 0.8985779
Number of non-target spots reduced to: 957
===========================================================================
Meta gene is:  ENSG00000187094+ENSG00000197971-ENSG00000198899+ENSG00000165023-ENSG00000167996
===========================================================================
Add gene:  ENSG00000128422
Minus gene:  ENSG00000197971
Absolute mean change: 0.98435354
Number of non-target spots reduced to: 598
===========================================================================
Meta gene is:  ENSG00000187094+ENSG00000197971-ENSG00000198899+ENSG00000165023-ENSG00000167996+ENSG00000128422-ENSG00000197971
===========================================================================
