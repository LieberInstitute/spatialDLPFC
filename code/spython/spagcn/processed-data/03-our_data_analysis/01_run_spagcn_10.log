Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151674...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  40.681046040103304 347.135761167226 56.51373885742774
Var of x,y,z =  5859233.072499307 4365933.508478031 5859233.07249931
Run 1: l [0.01, 1000], p [0.0, 167.4978655514517]
Run 2: l [0.01, 500.005], p [0.0, 33.76897430419922]
Run 3: l [0.01, 250.0075], p [0.0, 5.615881443023682]
Run 4: l [0.01, 125.00874999999999], p [0.0, 0.7448840141296387]
Run 5: l [62.509375, 125.00874999999999], p [0.04295814037322998, 0.7448840141296387]
Run 6: l [93.7590625, 125.00874999999999], p [0.2786492109298706, 0.7448840141296387]
Run 7: l [109.38390625, 125.00874999999999], p [0.48074114322662354, 0.7448840141296387]
Run 8: l [109.38390625, 117.196328125], p [0.48074114322662354, 0.6047447919845581]
Run 9: l [109.38390625, 113.29011718749999], p [0.48074114322662354, 0.5407649278640747]
Run 10: l [109.38390625, 111.33701171874999], p [0.48074114322662354, 0.5102633237838745]
recommended l =  110.36045898437499
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  7
recommended res =  0.7
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 364.81607142857143]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 121.77857142857142]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 42.05357142857143]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.998214285714287]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.70357142857143, 19.998214285714287]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.469642857142857
radius= 2.8781360052525997 average number of neighbors for each spot is 12.469642857142857
 Cluster 0 has neighbors:
Dmain  2 :  581
SVGs for domain  0 : ['ENSG00000123560', 'ENSG00000167552', 'ENSG00000197971', 'ENSG00000156508', 'ENSG00000087086', 'ENSG00000197756', 'ENSG00000108107', 'ENSG00000137818', 'ENSG00000167996', 'ENSG00000112306', 'ENSG00000229117', 'ENSG00000144713', 'ENSG00000173786', 'ENSG00000131095', 'ENSG00000109846', 'ENSG00000205542', 'ENSG00000156482', 'ENSG00000109475', 'ENSG00000142937', 'ENSG00000136156', 'ENSG00000107317', 'ENSG00000177954', 'ENSG00000099194', 'ENSG00000186468', 'ENSG00000142541', 'ENSG00000147403', 'ENSG00000233927', 'ENSG00000145592', 'ENSG00000168314', 'ENSG00000160307', 'ENSG00000187514', 'ENSG00000091513', 'ENSG00000213741', 'ENSG00000105290', 'ENSG00000122026', 'ENSG00000046653', 'ENSG00000180354', 'ENSG00000080822', 'ENSG00000169020', 'ENSG00000189058', 'ENSG00000175130', 'ENSG00000108387', 'ENSG00000112531', 'ENSG00000021300', 'ENSG00000159176', 'ENSG00000129538', 'ENSG00000167191', 'ENSG00000151552', 'ENSG00000118785', 'ENSG00000167641', 'ENSG00000149557', 'ENSG00000013297', 'ENSG00000105695', 'ENSG00000166925', 'ENSG00000250722', 'ENSG00000125534', 'ENSG00000160781', 'ENSG00000148180', 'ENSG00000064787', 'ENSG00000164176', 'ENSG00000136541', 'ENSG00000107331', 'ENSG00000172005', 'ENSG00000136960', 'ENSG00000172508', 'ENSG00000109099', 'ENSG00000068903', 'ENSG00000164402', 'ENSG00000237949', 'ENSG00000070214', 'ENSG00000184221', 'ENSG00000005893', 'ENSG00000104419', 'ENSG00000115468', 'ENSG00000126803']
Meta gene is:  ENSG00000123560
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 340.66785714285714]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 114.7625]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 40.051785714285714]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.26607142857143]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.480357142857143, 19.26607142857143]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.07857142857143
radius= 2.8781360052525997 average number of neighbors for each spot is 12.07857142857143
 Cluster 1 has neighbors:
Dmain  4 :  602
Dmain  6 :  538
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000165949']
Add gene:  ENSG00000164326
Minus gene:  ENSG00000110484
Absolute mean change: 1.8645971
Number of non-target spots reduced to: 2018
===========================================================================
Meta gene is:  ENSG00000165949+ENSG00000164326-ENSG00000110484
===========================================================================
Add gene:  ENSG00000111341
Minus gene:  ENSG00000197971
Absolute mean change: 2.9068446
Number of non-target spots reduced to: 363
===========================================================================
Meta gene is:  ENSG00000165949+ENSG00000164326-ENSG00000110484+ENSG00000111341-ENSG00000197971
===========================================================================
Add gene:  ENSG00000173372
Minus gene:  ENSG00000198938
Absolute mean change: 3.3002052
Number of non-target spots reduced to: 164
===========================================================================
Meta gene is:  ENSG00000165949+ENSG00000164326-ENSG00000110484+ENSG00000111341-ENSG00000197971+ENSG00000173372-ENSG00000198938
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 397.22727272727275]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 124.17272727272727]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 41.86590909090909]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.827272727272728]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.636363636363637, 19.827272727272728]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.361363636363636
radius= 2.8781360052525997 average number of neighbors for each spot is 12.361363636363636
 Cluster 2 has neighbors:
Dmain  5 :  617
Dmain  0 :  581
Dmain  3 :  520
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000153002']
Add gene:  ENSG00000124935
Minus gene:  ENSG00000198899
Absolute mean change: 1.1051908
Number of non-target spots reduced to: 540
===========================================================================
Meta gene is:  ENSG00000153002+ENSG00000124935-ENSG00000198899
===========================================================================
Add gene:  ENSG00000170381
Minus gene:  ENSG00000198886
Absolute mean change: 1.8291569
Number of non-target spots reduced to: 508
===========================================================================
Meta gene is:  ENSG00000153002+ENSG00000124935-ENSG00000198899+ENSG00000170381-ENSG00000198886
===========================================================================
Add gene:  ENSG00000244734
Minus gene:  ENSG00000124935
Stopped! Previous Number of non-target spots 508 206 1.8291569 1.6702492
Previous Number of non-target spots 508 206 1.8291569 1.6702492
Previous Number of non-target spots 508
Current Number of non-target spots 206
Absolute mean change 1.8291569
===========================================================================
Meta gene:  ENSG00000153002+ENSG00000124935-ENSG00000198899+ENSG00000170381-ENSG00000198886
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 384.50485436893206]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 123.94174757281553]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 42.349514563106794]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.089320388349513]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.728155339805825, 20.089320388349513]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.537864077669903
radius= 2.8781360052525997 average number of neighbors for each spot is 12.537864077669903
 Cluster 3 has neighbors:
Dmain  2 :  520
Dmain  6 :  474
Dmain  4 :  372
Dmain  5 :  317
SVGs for domain  3 : ['ENSG00000110484', 'ENSG00000124935', 'ENSG00000185499']
Add gene:  ENSG00000165023
Minus gene:  ENSG00000115756
Absolute mean change: 2.2647972
Number of non-target spots reduced to: 344
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000165023-ENSG00000115756
===========================================================================
Add gene:  ENSG00000137267
Minus gene:  ENSG00000115461
Absolute mean change: 2.9069862
Number of non-target spots reduced to: 163
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000165023-ENSG00000115756+ENSG00000137267-ENSG00000115461
===========================================================================
Add gene:  ENSG00000211677
Minus gene:  ENSG00000165023
Stopped! Previous Number of non-target spots 163 107 2.9069862 2.7131796
Previous Number of non-target spots 163 107 2.9069862 2.7131796
Previous Number of non-target spots 163
Current Number of non-target spots 107
Absolute mean change 2.9069862
===========================================================================
Meta gene:  ENSG00000110484+ENSG00000165023-ENSG00000115756+ENSG00000137267-ENSG00000115461
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 446.902752293578]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 136.16880733944953]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 44.83302752293578]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.94862385321101]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.987155963302753, 20.94862385321101]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.972477064220184
radius= 2.8781360052525997 average number of neighbors for each spot is 12.972477064220184
 Cluster 4 has neighbors:
Dmain  1 :  602
Dmain  5 :  403
Dmain  3 :  372
SVGs for domain  4 : ['ENSG00000277586']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000110484
Absolute mean change: 2.7669713
Number of non-target spots reduced to: 772
===========================================================================
Meta gene is:  ENSG00000277586+ENSG00000183036-ENSG00000110484
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000171617
Stopped! Previous Number of non-target spots 772 105 2.7669713 2.3223743
Previous Number of non-target spots 772 105 2.7669713 2.3223743
Previous Number of non-target spots 772
Current Number of non-target spots 105
Absolute mean change 2.7669713
===========================================================================
Meta gene:  ENSG00000277586+ENSG00000183036-ENSG00000110484
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 444.4553846153846]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 135.90153846153845]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 44.82769230769231]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.950769230769232]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.987692307692308, 20.950769230769232]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.972307692307693
radius= 2.8781360052525997 average number of neighbors for each spot is 12.972307692307693
 Cluster 5 has neighbors:
Dmain  2 :  617
Dmain  4 :  403
Dmain  3 :  317
SVGs for domain  5 : ['ENSG00000164919', 'ENSG00000171345', 'ENSG00000166710', 'ENSG00000165949']
Add gene:  ENSG00000153002
Minus gene:  ENSG00000111341
Absolute mean change: 1.7939122
Number of non-target spots reduced to: 404
===========================================================================
Meta gene is:  ENSG00000164919+ENSG00000153002-ENSG00000111341
===========================================================================
Add gene:  ENSG00000123416
Minus gene:  ENSG00000005893
Absolute mean change: 2.1759877
Number of non-target spots reduced to: 106
===========================================================================
Meta gene is:  ENSG00000164919+ENSG00000153002-ENSG00000111341+ENSG00000123416-ENSG00000005893
===========================================================================
Add gene:  ENSG00000171345
Minus gene:  ENSG00000198668
Stopped! Previous Number of non-target spots 106 126 2.1759877 2.7048292
Previous Number of non-target spots 106 126 2.1759877 2.7048292
Previous Number of non-target spots 106
Current Number of non-target spots 126
Absolute mean change 2.1759877
===========================================================================
Meta gene:  ENSG00000164919+ENSG00000153002-ENSG00000111341+ENSG00000123416-ENSG00000005893
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 321.0054945054945]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 112.06593406593407]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 39.80769230769231]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.188186813186814]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.461538461538462, 19.188186813186814]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.054945054945055
radius= 2.8781360052525997 average number of neighbors for each spot is 12.054945054945055
 Cluster 6 has neighbors:
Dmain  1 :  538
Dmain  3 :  474
Dmain  4 :  283
SVGs for domain  6 : ['ENSG00000162545']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 1.868578
Number of non-target spots reduced to: 223
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000121552
Absolute mean change: 3.0341158
Number of non-target spots reduced to: 197
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000197971+ENSG00000110484-ENSG00000121552
===========================================================================
Add gene:  ENSG00000171476
Minus gene:  ENSG00000110484
Stopped! Previous Number of non-target spots 197 72 3.0341158 2.6109972
Previous Number of non-target spots 197 72 3.0341158 2.6109972
Previous Number of non-target spots 197
Current Number of non-target spots 72
Absolute mean change 3.0341158
===========================================================================
Meta gene:  ENSG00000162545+ENSG00000115756-ENSG00000197971+ENSG00000110484-ENSG00000121552
===========================================================================
