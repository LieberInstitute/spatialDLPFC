Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151669...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  21.44676202738622 94.5002476637035 38.630901781774824
Var of x,y,z =  4878438.413107859 5112655.999443702 5112655.999443702
Run 1: l [0.01, 1000], p [0.0, 137.29717262150592]
Run 2: l [0.01, 500.005], p [0.0, 22.11189079284668]
Run 3: l [0.01, 250.0075], p [0.0, 3.096710205078125]
Run 4: l [125.00874999999999, 250.0075], p [0.36792004108428955, 3.096710205078125]
Run 5: l [125.00874999999999, 187.508125], p [0.36792004108428955, 1.3190529346466064]
Run 6: l [125.00874999999999, 156.2584375], p [0.36792004108428955, 0.7540007829666138]
Run 7: l [125.00874999999999, 140.63359375], p [0.36792004108428955, 0.5403456687927246]
Run 8: l [132.821171875, 140.63359375], p [0.44919824600219727, 0.5403456687927246]
recommended l =  136.7273828125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  4
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 391.924794359577]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 128.35135135135135]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 43.62279670975323]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.594594594594593]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.893066980023502, 20.594594594594593]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.796709753231493
radius= 2.8781360052525997 average number of neighbors for each spot is 12.796709753231493
 Cluster 0 has neighbors:
Dmain  1 :  1596
Dmain  5 :  549
Dmain  2 :  546
SVGs for domain  0 : ['ENSG00000132639', 'ENSG00000067715', 'ENSG00000117632']
Add gene:  ENSG00000034510
Minus gene:  ENSG00000171476
Absolute mean change: 2.1274436
Number of non-target spots reduced to: 106
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000034510-ENSG00000171476
===========================================================================
Add gene:  ENSG00000171476
Minus gene:  ENSG00000153002
Absolute mean change: 2.1998262
Number of non-target spots reduced to: 57
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000034510-ENSG00000171476+ENSG00000171476-ENSG00000153002
===========================================================================
Add gene:  ENSG00000123560
Minus gene:  ENSG00000171476
Absolute mean change: 2.9689813
Number of non-target spots reduced to: 31
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000034510-ENSG00000171476+ENSG00000171476-ENSG00000153002+ENSG00000123560-ENSG00000171476
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 329.6975308641975]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 113.49691358024691]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 40.614197530864196]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.62037037037037]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.651234567901234, 19.62037037037037]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.311728395061728
radius= 2.8781360052525997 average number of neighbors for each spot is 12.311728395061728
 Cluster 1 has neighbors:
Dmain  0 :  1596
Dmain  5 :  103
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000131095']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000130558
Absolute mean change: 1.8602254
Number of non-target spots reduced to: 810
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000197971-ENSG00000130558
===========================================================================
Add gene:  ENSG00000130558
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 810 130 1.8602254 0.96412003
Previous Number of non-target spots 810 130 1.8602254 0.96412003
Previous Number of non-target spots 810
Current Number of non-target spots 130
Absolute mean change 1.8602254
===========================================================================
Meta gene:  ENSG00000131095+ENSG00000197971-ENSG00000130558
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 417.64504504504504]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 129.3189189189189]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 43.2]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.320720720720722]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.792792792792794, 20.320720720720722]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.63063063063063
radius= 2.8781360052525997 average number of neighbors for each spot is 12.63063063063063
 Cluster 2 has neighbors:
Dmain  4 :  1719
Dmain  3 :  936
Dmain  0 :  546
Dmain  6 :  424
Dmain  5 :  259
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000154146', 'ENSG00000187094', 'ENSG00000277586', 'ENSG00000171476']
Add gene:  ENSG00000164326
Minus gene:  ENSG00000197971
Absolute mean change: 0.74950886
Number of non-target spots reduced to: 767
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000164326-ENSG00000197971
===========================================================================
Add gene:  ENSG00000111640
Minus gene:  ENSG00000164326
Absolute mean change: 0.9787674
Number of non-target spots reduced to: 623
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000164326-ENSG00000197971+ENSG00000111640-ENSG00000164326
===========================================================================
Add gene:  ENSG00000171476
Minus gene:  ENSG00000104888
Absolute mean change: 1.2078433
Number of non-target spots reduced to: 538
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000164326-ENSG00000197971+ENSG00000111640-ENSG00000164326+ENSG00000171476-ENSG00000104888
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 393.1483333333333]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 127.03333333333333]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 43.07833333333333]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.345]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.8, 20.345]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.646666666666667
radius= 2.8781360052525997 average number of neighbors for each spot is 12.646666666666667
 Cluster 3 has neighbors:
Dmain  6 :  1738
Dmain  4 :  1444
Dmain  2 :  936
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000115756']
Add gene:  ENSG00000164326
Minus gene:  ENSG00000067715
Absolute mean change: 0.7759576
Number of non-target spots reduced to: 1301
===========================================================================
Meta gene is:  ENSG00000115756+ENSG00000164326-ENSG00000067715
===========================================================================
Add gene:  ENSG00000067715
Minus gene:  ENSG00000110484
Absolute mean change: 1.1469796
Number of non-target spots reduced to: 808
===========================================================================
Meta gene is:  ENSG00000115756+ENSG00000164326-ENSG00000067715+ENSG00000067715-ENSG00000110484
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000115756
Stopped! Previous Number of non-target spots 808 572 1.1469796 0.11366171
Previous Number of non-target spots 808 572 1.1469796 0.11366171
Previous Number of non-target spots 808
Current Number of non-target spots 572
Absolute mean change 1.1469796
===========================================================================
Meta gene:  ENSG00000115756+ENSG00000164326-ENSG00000067715+ENSG00000067715-ENSG00000110484
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 381.10149750415974]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 119.97337770382696]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 40.750415973377706]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.402662229617306]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.50748752079867, 19.402662229617306]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.136439267886855
radius= 2.8781360052525997 average number of neighbors for each spot is 12.136439267886855
 Cluster 4 has neighbors:
Dmain  2 :  1719
Dmain  3 :  1444
Dmain  6 :  814
Dmain  5 :  210
Can't find any genes such that more spots in domain 4 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 345.51612903225805]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 113.0]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 39.54838709677419]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.04032258064516]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.459677419354838, 19.04032258064516]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=11.935483870967742
radius= 2.8781360052525997 average number of neighbors for each spot is 11.935483870967742
 Cluster 5 has neighbors:
Dmain  0 :  549
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000105894', 'ENSG00000165949', 'ENSG00000211592']
Add gene:  ENSG00000269028
Minus gene:  ENSG00000105894
Absolute mean change: 0.33358133
Number of non-target spots reduced to: 1701
===========================================================================
Meta gene is:  ENSG00000105894+ENSG00000269028-ENSG00000105894
===========================================================================
Add gene:  ENSG00000108424
Minus gene:  ENSG00000269028
Stopped! Previous Number of non-target spots 1701 1086 0.33358133 0.1648352
Previous Number of non-target spots 1701 1086 0.33358133 0.1648352
Previous Number of non-target spots 1701
Current Number of non-target spots 1086
Absolute mean change 0.33358133
===========================================================================
Meta gene:  ENSG00000105894+ENSG00000269028-ENSG00000105894
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 319.68151815181517]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 110.55280528052805]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 39.21617161716171]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 18.932343234323433]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.366336633663366, 18.932343234323433]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=11.894389438943895
radius= 2.8781360052525997 average number of neighbors for each spot is 11.894389438943895
 Cluster 6 has neighbors:
Dmain  3 :  1738
Dmain  4 :  814
Dmain  2 :  424
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 6 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 6!
