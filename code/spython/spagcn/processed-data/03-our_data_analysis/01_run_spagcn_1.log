Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151507...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  29.491026128375946 134.2952645407559 40.147192329431
Var of x,y,z =  6252707.229989054 5320962.767835974 6252707.229989053
Run 1: l [0.01, 1000], p [0.0, 148.17622003674612]
Run 2: l [0.01, 500.005], p [0.0, 25.914703369140625]
Run 3: l [0.01, 250.0075], p [0.0, 3.802572727203369]
Run 4: l [125.00874999999999, 250.0075], p [0.45451271533966064, 3.802572727203369]
Run 5: l [125.00874999999999, 187.508125], p [0.45451271533966064, 1.630110263824463]
Run 6: l [125.00874999999999, 156.2584375], p [0.45451271533966064, 0.9327691793441772]
Run 7: l [125.00874999999999, 140.63359375], p [0.45451271533966064, 0.6682571172714233]
Run 8: l [125.00874999999999, 132.821171875], p [0.45451271533966064, 0.5552898645401001]
recommended l =  128.91496093749998
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  7
recommended res =  0.9999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.0], num_nbr [8.910685805422647, 464.4194577352472]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.0], num_nbr [8.910685805422647, 153.90271132376395]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.0], num_nbr [8.910685805422647, 59.33652312599681]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.0], num_nbr [8.910685805422647, 24.57097288676236]
Calculateing adj matrix using xy only...
recommended radius =  3.0 num_nbr=12.838915470494419
radius= 3.0 average number of neighbors for each spot is 12.838915470494419
 Cluster 0 has neighbors:
Dmain  3 :  2361
Dmain  4 :  930
Dmain  2 :  848
Dmain  6 :  440
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000171345', 'ENSG00000234745', 'ENSG00000165949', 'ENSG00000142089']
Add gene:  ENSG00000153002
Minus gene:  ENSG00000171345
Absolute mean change: 0.10138551
Number of non-target spots reduced to: 1907
===========================================================================
Meta gene is:  ENSG00000171345+ENSG00000153002-ENSG00000171345
===========================================================================
Add gene:  ENSG00000211592
Minus gene:  ENSG00000153002
Stopped! Previous Number of non-target spots 1907 254 0.10138551 -0.012954891
Previous Number of non-target spots 1907 254 0.10138551 -0.012954891
Previous Number of non-target spots 1907
Current Number of non-target spots 254
Absolute mean change 0.10138551
===========================================================================
Meta gene:  ENSG00000171345+ENSG00000153002-ENSG00000171345
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.0], num_nbr [8.735483870967743, 401.6077419354839]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.0], num_nbr [8.735483870967743, 141.08774193548388]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.0], num_nbr [8.735483870967743, 56.21290322580645]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.0], num_nbr [8.735483870967743, 23.745806451612903]
Calculateing adj matrix using xy only...
recommended radius =  3.0 num_nbr=12.491612903225807
radius= 3.0 average number of neighbors for each spot is 12.491612903225807
 Cluster 1 has neighbors:
Dmain  6 :  757
SVGs for domain  1 : ['ENSG00000131095']
Add gene:  ENSG00000101439
Minus gene:  ENSG00000197971
Absolute mean change: 1.6301596
Number of non-target spots reduced to: 289
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000101439-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198712
Stopped! Previous Number of non-target spots 289 180 1.6301596 1.4378471
Previous Number of non-target spots 289 180 1.6301596 1.4378471
Previous Number of non-target spots 289
Current Number of non-target spots 180
Absolute mean change 1.6301596
===========================================================================
Meta gene:  ENSG00000131095+ENSG00000101439-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.0], num_nbr [8.704204204204204, 408.64414414414415]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.0], num_nbr [8.704204204204204, 141.62462462462463]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.0], num_nbr [8.704204204204204, 56.15765765765766]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.0], num_nbr [8.704204204204204, 23.693693693693692]
Calculateing adj matrix using xy only...
recommended radius =  3.0 num_nbr=12.463963963963964
radius= 3.0 average number of neighbors for each spot is 12.463963963963964
 Cluster 2 has neighbors:
Dmain  3 :  2681
Dmain  0 :  848
Dmain  5 :  393
Dmain  6 :  232
SVGs for domain  2 : ['ENSG00000110484']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198712
Absolute mean change: 1.591038
Number of non-target spots reduced to: 899
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000197971-ENSG00000198712
===========================================================================
Add gene:  ENSG00000256618
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 899 591 1.591038 0.9596417
Previous Number of non-target spots 899 591 1.591038 0.9596417
Previous Number of non-target spots 899
Current Number of non-target spots 591
Absolute mean change 1.591038
===========================================================================
Meta gene:  ENSG00000110484+ENSG00000197971-ENSG00000198712
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.0], num_nbr [8.91313789359392, 469.85342019543975]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.0], num_nbr [8.91313789359392, 155.69598262757873]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.0], num_nbr [8.91313789359392, 59.77415852334419]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.0], num_nbr [8.91313789359392, 24.647122692725297]
Calculateing adj matrix using xy only...
recommended radius =  3.0 num_nbr=12.845819761129208
radius= 3.0 average number of neighbors for each spot is 12.845819761129208
 Cluster 3 has neighbors:
Dmain  2 :  2681
Dmain  0 :  2361
Dmain  4 :  561
Dmain  6 :  282
SVGs for domain  3 : ['ENSG00000123416']
Add gene:  ENSG00000154277
Minus gene:  ENSG00000123416
Absolute mean change: 0.83022606
Number of non-target spots reduced to: 232
===========================================================================
Meta gene is:  ENSG00000123416+ENSG00000154277-ENSG00000123416
===========================================================================
Add gene:  ENSG00000123416
Minus gene:  ENSG00000115756
Stopped! Previous Number of non-target spots 232 248 0.83022606 1.7923744
Previous Number of non-target spots 232 248 0.83022606 1.7923744
Previous Number of non-target spots 232
Current Number of non-target spots 248
Absolute mean change 0.83022606
===========================================================================
Meta gene:  ENSG00000123416+ENSG00000154277-ENSG00000123416
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.0], num_nbr [8.79454253611557, 425.19903691813806]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.0], num_nbr [8.79454253611557, 145.39967897271268]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.0], num_nbr [8.79454253611557, 57.21829855537721]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.0], num_nbr [8.79454253611557, 24.003210272873194]
Calculateing adj matrix using xy only...
recommended radius =  3.0 num_nbr=12.60032102728732
radius= 3.0 average number of neighbors for each spot is 12.60032102728732
 Cluster 4 has neighbors:
Dmain  6 :  1376
Dmain  0 :  930
Dmain  3 :  561
SVGs for domain  4 : ['ENSG00000130558', 'ENSG00000162545', 'ENSG00000171617', 'ENSG00000171476', 'ENSG00000115756']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000123416
Absolute mean change: 1.1620619
Number of non-target spots reduced to: 484
===========================================================================
Meta gene is:  ENSG00000130558+ENSG00000115756-ENSG00000123416
===========================================================================
Add gene:  ENSG00000198712
Minus gene:  ENSG00000131095
Absolute mean change: 1.8625286
Number of non-target spots reduced to: 277
===========================================================================
Meta gene is:  ENSG00000130558+ENSG00000115756-ENSG00000123416+ENSG00000198712-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000123560
Absolute mean change: 2.0206742
Number of non-target spots reduced to: 241
===========================================================================
Meta gene is:  ENSG00000130558+ENSG00000115756-ENSG00000123416+ENSG00000198712-ENSG00000131095+ENSG00000131095-ENSG00000123560
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.0], num_nbr [8.619433198380566, 336.5344129554656]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.0], num_nbr [8.619433198380566, 126.90283400809717]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.0], num_nbr [8.619433198380566, 53.659919028340084]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.0], num_nbr [8.619433198380566, 23.141700404858298]
Calculateing adj matrix using xy only...
recommended radius =  3.0 num_nbr=12.331983805668017
radius= 3.0 average number of neighbors for each spot is 12.331983805668017
 Cluster 5 has neighbors:
Dmain  2 :  393
SVGs for domain  5 : ['ENSG00000123560', 'ENSG00000131095']
Add gene:  ENSG00000170421
Minus gene:  ENSG00000198804
Absolute mean change: 2.689955
Number of non-target spots reduced to: 204
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000170421-ENSG00000198804
===========================================================================
Add gene:  ENSG00000159713
Minus gene:  ENSG00000160014
Absolute mean change: 3.6621447
Number of non-target spots reduced to: 18
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000170421-ENSG00000198804+ENSG00000159713-ENSG00000160014
===========================================================================
Add gene:  ENSG00000142541
Minus gene:  ENSG00000175866
Absolute mean change: 3.802391
Number of non-target spots reduced to: 8
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000170421-ENSG00000198804+ENSG00000159713-ENSG00000160014+ENSG00000142541-ENSG00000175866
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.0], num_nbr [8.705722070844686, 399.02452316076295]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.0], num_nbr [8.705722070844686, 139.17438692098094]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.0], num_nbr [8.705722070844686, 55.6267029972752]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.0], num_nbr [8.705722070844686, 23.583106267029972]
Calculateing adj matrix using xy only...
recommended radius =  3.0 num_nbr=12.444141689373296
radius= 3.0 average number of neighbors for each spot is 12.444141689373296
 Cluster 6 has neighbors:
Dmain  4 :  1376
Dmain  1 :  757
Dmain  0 :  440
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000122026', 'ENSG00000177954']
Add gene:  ENSG00000145824
Minus gene:  ENSG00000131711
Absolute mean change: 0.58001256
Number of non-target spots reduced to: 2409
===========================================================================
Meta gene is:  ENSG00000122026+ENSG00000145824-ENSG00000131711
===========================================================================
Add gene:  ENSG00000131711
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 2409 870 0.58001256 0.35774708
Previous Number of non-target spots 2409 870 0.58001256 0.35774708
Previous Number of non-target spots 2409
Current Number of non-target spots 870
Absolute mean change 0.58001256
===========================================================================
Meta gene:  ENSG00000122026+ENSG00000145824-ENSG00000131711
===========================================================================
