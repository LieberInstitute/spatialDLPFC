Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151670...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  21.701046991708278 108.22792794853032 35.67634797576691
Var of x,y,z =  4277613.427633155 5217771.884010907 5217771.884010908
Run 1: l [0.01, 1000], p [0.0, 143.9004194577002]
Run 2: l [0.01, 500.005], p [0.0, 23.998523712158203]
Run 3: l [0.01, 250.0075], p [0.0, 3.4164390563964844]
Run 4: l [125.00874999999999, 250.0075], p [0.4061927795410156, 3.4164390563964844]
Run 5: l [125.00874999999999, 187.508125], p [0.4061927795410156, 1.4568939208984375]
Run 6: l [125.00874999999999, 156.2584375], p [0.4061927795410156, 0.8322457075119019]
Run 7: l [125.00874999999999, 140.63359375], p [0.4061927795410156, 0.5963056087493896]
recommended l =  132.821171875
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  4
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  7
recommended res =  0.9999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 389.203125]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 124.14930555555556]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 43.947916666666664]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.635416666666668]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.88888888888889, 20.635416666666668]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.88888888888889, 20.635416666666668]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.807291666666666
radius= 3.063392600044608 average number of neighbors for each spot is 12.807291666666666
 Cluster 0 has neighbors:
Dmain  2 :  1383
Dmain  5 :  1203
Dmain  4 :  642
Dmain  1 :  459
Dmain  6 :  361
Dmain  3 :  257
Can't find any genes such that more spots in domain 0 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 355.9060205580029]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 119.77386196769457]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 43.38179148311307]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.525697503671072]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.888399412628488, 20.525697503671072]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.888399412628488, 20.525697503671072]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.775330396475772
radius= 3.063392600044608 average number of neighbors for each spot is 12.775330396475772
 Cluster 1 has neighbors:
Dmain  3 :  2227
Dmain  0 :  459
Dmain  4 :  246
SVGs for domain  1 : ['ENSG00000132639', 'ENSG00000034510', 'ENSG00000067715']
Add gene:  ENSG00000034510
Minus gene:  ENSG00000164326
Absolute mean change: 2.5249944
Number of non-target spots reduced to: 55
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000034510-ENSG00000164326
===========================================================================
Add gene:  ENSG00000165023
Minus gene:  ENSG00000025772
Absolute mean change: 3.120789
Number of non-target spots reduced to: 16
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000034510-ENSG00000164326+ENSG00000165023-ENSG00000025772
===========================================================================
Add gene:  ENSG00000143153
Minus gene:  ENSG00000165023
Stopped! Previous Number of non-target spots 16 32 3.120789 3.2921348
Previous Number of non-target spots 16 32 3.120789 3.2921348
Previous Number of non-target spots 16
Current Number of non-target spots 32
Absolute mean change 3.120789
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000034510-ENSG00000164326+ENSG00000165023-ENSG00000025772
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 376.4901960784314]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 122.72192513368984]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 43.75579322638146]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.57397504456328]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.875222816399287, 20.57397504456328]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.875222816399287, 20.57397504456328]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.775401069518717
radius= 3.063392600044608 average number of neighbors for each spot is 12.775401069518717
 Cluster 2 has neighbors:
Dmain  0 :  1383
Dmain  6 :  857
Dmain  5 :  849
Dmain  4 :  529
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000255823', 'ENSG00000101439', 'ENSG00000107317', 'ENSG00000130203', 'ENSG00000123560']
Add gene:  ENSG00000164326
Minus gene:  ENSG00000132639
Absolute mean change: 0.45745516
Number of non-target spots reduced to: 1829
===========================================================================
Meta gene is:  ENSG00000255823+ENSG00000164326-ENSG00000132639
===========================================================================
Add gene:  ENSG00000019582
Minus gene:  ENSG00000251562
Absolute mean change: 0.9332142
Number of non-target spots reduced to: 721
===========================================================================
Meta gene is:  ENSG00000255823+ENSG00000164326-ENSG00000132639+ENSG00000019582-ENSG00000251562
===========================================================================
Add gene:  ENSG00000251562
Minus gene:  ENSG00000136156
Absolute mean change: 0.9917774
Number of non-target spots reduced to: 573
===========================================================================
Meta gene is:  ENSG00000255823+ENSG00000164326-ENSG00000132639+ENSG00000019582-ENSG00000251562+ENSG00000251562-ENSG00000136156
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 320.08564814814815]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 108.58796296296296]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 40.27777777777778]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 19.34490740740741]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.506944444444445, 19.34490740740741]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.506944444444445, 19.34490740740741]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.11574074074074
radius= 3.063392600044608 average number of neighbors for each spot is 12.11574074074074
 Cluster 3 has neighbors:
Dmain  1 :  2227
Dmain  4 :  247
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000197971', 'ENSG00000131095', 'ENSG00000026025']
Add gene:  ENSG00000026025
Minus gene:  ENSG00000197971
Absolute mean change: 0.10319489
Number of non-target spots reduced to: 559
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000026025-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000026025
Stopped! Previous Number of non-target spots 559 1248 0.10319489 0.77602494
Previous Number of non-target spots 559 1248 0.10319489 0.77602494
Previous Number of non-target spots 559
Current Number of non-target spots 1248
Absolute mean change 0.10319489
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000026025-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 370.68947368421055]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 118.02631578947368]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 42.21052631578947]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.073684210526316]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.75263157894737, 20.073684210526316]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.75263157894737, 20.073684210526316]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.521052631578947
radius= 3.063392600044608 average number of neighbors for each spot is 12.521052631578947
 Cluster 4 has neighbors:
Dmain  0 :  642
Dmain  2 :  529
Dmain  3 :  247
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000171345']
Add gene:  ENSG00000101439
Minus gene:  ENSG00000171345
Absolute mean change: 0.2151041
Number of non-target spots reduced to: 1277
===========================================================================
Meta gene is:  ENSG00000171345+ENSG00000101439-ENSG00000171345
===========================================================================
Add gene:  ENSG00000171345
Minus gene:  ENSG00000163032
Absolute mean change: 0.5325463
Number of non-target spots reduced to: 1116
===========================================================================
Meta gene is:  ENSG00000171345+ENSG00000101439-ENSG00000171345+ENSG00000171345-ENSG00000163032
===========================================================================
Add gene:  ENSG00000163032
Minus gene:  ENSG00000171345
Stopped! Previous Number of non-target spots 1116 814 0.5325463 0.2151041
Previous Number of non-target spots 1116 814 0.5325463 0.2151041
Previous Number of non-target spots 1116
Current Number of non-target spots 814
Absolute mean change 0.5325463
===========================================================================
Meta gene:  ENSG00000171345+ENSG00000101439-ENSG00000171345+ENSG00000171345-ENSG00000163032
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 347.7991886409736]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 115.8762677484787]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 42.45841784989858]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 20.212981744421906]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.784989858012171, 20.212981744421906]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.784989858012171, 20.212981744421906]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=12.602434077079108
radius= 3.063392600044608 average number of neighbors for each spot is 12.602434077079108
 Cluster 5 has neighbors:
Dmain  0 :  1203
Dmain  6 :  1049
Dmain  2 :  849
Dmain  4 :  124
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000162545', 'ENSG00000171617', 'ENSG00000128989', 'ENSG00000251562']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000198938
Absolute mean change: 0.5755558
Number of non-target spots reduced to: 1418
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000198938
===========================================================================
Add gene:  ENSG00000173432
Minus gene:  ENSG00000197971
Absolute mean change: 1.3809984
Number of non-target spots reduced to: 673
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000198938+ENSG00000173432-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 673 463 1.3809984 1.0738716
Previous Number of non-target spots 673 463 1.3809984 1.0738716
Previous Number of non-target spots 673
Current Number of non-target spots 463
Absolute mean change 1.3809984
===========================================================================
Meta gene:  ENSG00000162545+ENSG00000115756-ENSG00000198938+ENSG00000173432-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 16.492422103881836], num_nbr [1.0, 288.4796460176991]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 8.953317821025848], num_nbr [1.0, 100.70619469026549]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.183765679597855], num_nbr [1.0, 38.30442477876106]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.2989896088838577], num_nbr [1.0, 18.690265486725664]
Calculateing adj matrix using xy only...
Run 5: radius [2.3566015735268593, 3.2989896088838577], num_nbr [8.341592920353982, 18.690265486725664]
Calculateing adj matrix using xy only...
Run 6: radius [2.8277955912053585, 3.2989896088838577], num_nbr [8.341592920353982, 18.690265486725664]
Calculateing adj matrix using xy only...
recommended radius =  3.063392600044608 num_nbr=11.801769911504424
radius= 3.063392600044608 average number of neighbors for each spot is 11.801769911504424
 Cluster 6 has neighbors:
Dmain  5 :  1049
Dmain  2 :  857
Dmain  0 :  361
Dmain  4 :  107
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000131095']
Add gene:  ENSG00000170323
Minus gene:  ENSG00000198804
Absolute mean change: 1.0251781
Number of non-target spots reduced to: 1167
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000170323-ENSG00000198804
===========================================================================
Add gene:  ENSG00000054179
Minus gene:  ENSG00000198938
Absolute mean change: 2.0247686
Number of non-target spots reduced to: 214
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000170323-ENSG00000198804+ENSG00000054179-ENSG00000198938
===========================================================================
Add gene:  ENSG00000171766
Minus gene:  ENSG00000143933
Absolute mean change: 3.0183988
Number of non-target spots reduced to: 53
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000170323-ENSG00000198804+ENSG00000054179-ENSG00000198938+ENSG00000171766-ENSG00000143933
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
