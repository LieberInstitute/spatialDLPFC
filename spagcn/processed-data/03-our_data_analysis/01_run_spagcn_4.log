Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151510...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  28.801136751576607 107.56204199841035 38.77426853893833
Var of x,y,z =  6511814.021962465 6135377.564701353 6511814.021962464
Run 1: l [0.01, 1000], p [0.0, 130.45490339461523]
Run 2: l [0.01, 500.005], p [0.0, 22.43998146057129]
Run 3: l [0.01, 250.0075], p [0.0, 3.25473690032959]
Run 4: l [125.00874999999999, 250.0075], p [0.3899942636489868, 3.25473690032959]
Run 5: l [125.00874999999999, 187.508125], p [0.3899942636489868, 1.392350673675537]
Run 6: l [125.00874999999999, 156.2584375], p [0.3899942636489868, 0.796932578086853]
Run 7: l [125.00874999999999, 140.63359375], p [0.3899942636489868, 0.5717149972915649]
Run 8: l [132.821171875, 140.63359375], p [0.4756510257720947, 0.5717149972915649]
Run 9: l [132.821171875, 136.7273828125], p [0.4756510257720947, 0.5223525762557983]
recommended l =  134.77427734375
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  7
recommended res =  0.9999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.895993179880648, 491.3546462063086]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.895993179880648, 166.6760443307758]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.895993179880648, 59.01960784313726]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.895993179880648, 24.494458653026427]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.797101449275363
radius= 3.0542476177215576 average number of neighbors for each spot is 12.797101449275363
 Cluster 0 has neighbors:
Dmain  5 :  785
Dmain  1 :  464
Dmain  3 :  311
Dmain  6 :  149
SVGs for domain  0 : ['ENSG00000131095']
Add gene:  ENSG00000145824
Minus gene:  ENSG00000167996
Absolute mean change: 1.3508809
Number of non-target spots reduced to: 512
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000145824-ENSG00000167996
===========================================================================
Add gene:  ENSG00000026025
Minus gene:  ENSG00000143933
Absolute mean change: 2.444879
Number of non-target spots reduced to: 191
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000145824-ENSG00000167996+ENSG00000026025-ENSG00000143933
===========================================================================
Add gene:  ENSG00000111341
Minus gene:  ENSG00000197971
Absolute mean change: 3.078619
Number of non-target spots reduced to: 69
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000145824-ENSG00000167996+ENSG00000026025-ENSG00000143933+ENSG00000111341-ENSG00000197971
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.83215796897038, 476.8095909732017]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.83215796897038, 164.29478138222848]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.83215796897038, 58.33286318758815]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.83215796897038, 24.24682651622003]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.68265162200282
radius= 3.0542476177215576 average number of neighbors for each spot is 12.68265162200282
 Cluster 1 has neighbors:
Dmain  5 :  1916
Dmain  2 :  981
Dmain  4 :  849
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000162545', 'ENSG00000171617', 'ENSG00000128989', 'ENSG00000115756']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000110484
Absolute mean change: 1.5346098
Number of non-target spots reduced to: 592
===========================================================================
Meta gene is:  ENSG00000162545+ENSG00000115756-ENSG00000110484
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 592 352 1.5346098 1.3515084
Previous Number of non-target spots 592 352 1.5346098 1.3515084
Previous Number of non-target spots 592
Current Number of non-target spots 352
Absolute mean change 1.5346098
===========================================================================
Meta gene:  ENSG00000162545+ENSG00000115756-ENSG00000110484
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.894321766561514, 476.98580441640377]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.894321766561514, 164.48422712933754]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.894321766561514, 58.75709779179811]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.894321766561514, 24.468454258675077]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.796529968454259
radius= 3.0542476177215576 average number of neighbors for each spot is 12.796529968454259
 Cluster 2 has neighbors:
Dmain  4 :  2509
Dmain  1 :  981
Dmain  3 :  534
Dmain  5 :  459
SVGs for domain  2 : ['ENSG00000110484']
Add gene:  ENSG00000171345
Minus gene:  ENSG00000110484
Absolute mean change: 0.20001483
Number of non-target spots reduced to: 993
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000171345-ENSG00000110484
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000171345
Stopped! Previous Number of non-target spots 993 1722 0.20001483 0.871356
Previous Number of non-target spots 993 1722 0.20001483 0.871356
Previous Number of non-target spots 993
Current Number of non-target spots 1722
Absolute mean change 0.20001483
===========================================================================
Meta gene:  ENSG00000110484+ENSG00000171345-ENSG00000110484
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.717073170731707, 444.8016260162602]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.717073170731707, 156.4048780487805]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.717073170731707, 56.46341463414634]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.717073170731707, 23.72032520325203]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.46829268292683
radius= 3.0542476177215576 average number of neighbors for each spot is 12.46829268292683
 Cluster 3 has neighbors:
Dmain  4 :  2214
Dmain  2 :  534
SVGs for domain  3 : ['ENSG00000197971', 'ENSG00000123560']
Add gene:  ENSG00000110484
Minus gene:  ENSG00000197971
Absolute mean change: 0.27631187
Number of non-target spots reduced to: 460
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000110484-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000110484
Stopped! Previous Number of non-target spots 460 1752 0.27631187 0.6591045
Previous Number of non-target spots 460 1752 0.27631187 0.6591045
Previous Number of non-target spots 460
Current Number of non-target spots 1752
Absolute mean change 0.27631187
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000110484-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.73469387755102, 438.56390977443607]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.73469387755102, 154.2749731471536]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.73469387755102, 56.12137486573577]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.73469387755102, 23.73469387755102]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.480128893662728
radius= 3.0542476177215576 average number of neighbors for each spot is 12.480128893662728
 Cluster 4 has neighbors:
Dmain  2 :  2509
Dmain  3 :  2214
Dmain  1 :  849
Dmain  5 :  328
SVGs for domain  4 : ['ENSG00000123416']
Add gene:  ENSG00000277586
Minus gene:  ENSG00000123416
Absolute mean change: 0.87298906
Number of non-target spots reduced to: 319
===========================================================================
Meta gene is:  ENSG00000123416+ENSG00000277586-ENSG00000123416
===========================================================================
Add gene:  ENSG00000123416
Minus gene:  ENSG00000277586
Stopped! Previous Number of non-target spots 319 322 0.87298906 0.8778995
Previous Number of non-target spots 319 322 0.87298906 0.8778995
Previous Number of non-target spots 319
Current Number of non-target spots 322
Absolute mean change 0.87298906
===========================================================================
Meta gene:  ENSG00000123416+ENSG00000277586-ENSG00000123416
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.871495327102803, 476.45327102803736]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.871495327102803, 163.32476635514018]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.871495327102803, 58.242990654205606]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.871495327102803, 24.32943925233645]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=12.759345794392523
radius= 3.0542476177215576 average number of neighbors for each spot is 12.759345794392523
 Cluster 5 has neighbors:
Dmain  1 :  1916
Dmain  0 :  785
Dmain  2 :  459
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000132639', 'ENSG00000162545', 'ENSG00000163032', 'ENSG00000130558', 'ENSG00000102109', 'ENSG00000156298', 'ENSG00000020129', 'ENSG00000078018', 'ENSG00000115756']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000132639
Absolute mean change: 0.23528716
Number of non-target spots reduced to: 2375
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000115756-ENSG00000132639
===========================================================================
Add gene:  ENSG00000181195
Minus gene:  ENSG00000110484
Absolute mean change: 1.0505116
Number of non-target spots reduced to: 1953
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000115756-ENSG00000132639+ENSG00000181195-ENSG00000110484
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000115756
Stopped! Previous Number of non-target spots 1953 648 1.0505116 0.052678715
Previous Number of non-target spots 1953 648 1.0505116 0.052678715
Previous Number of non-target spots 1953
Current Number of non-target spots 648
Absolute mean change 1.0505116
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000115756-ENSG00000132639+ENSG00000181195-ENSG00000110484
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.867961883544922], num_nbr [8.23611111111111, 306.34722222222223]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.433980941772461], num_nbr [8.23611111111111, 118.9375]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.2169904708862305], num_nbr [8.23611111111111, 48.013888888888886]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.108495235443115], num_nbr [8.23611111111111, 21.5]
Calculateing adj matrix using xy only...
recommended radius =  3.0542476177215576 num_nbr=11.597222222222221
radius= 3.0542476177215576 average number of neighbors for each spot is 11.597222222222221
 Cluster 6 has neighbors:
No neighbor domain found, try bigger radius or smaller ratio.
Found no neighbors for domain 6 . No SVGs will be found for this domain.
