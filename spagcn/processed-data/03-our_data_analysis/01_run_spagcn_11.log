Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151675...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  49.70885395946546 213.87120527421098 65.8303520950607
Var of x,y,z =  5442229.3100220235 4853670.919133509 5442229.3100220235
Run 1: l [0.01, 1000], p [0.0, 158.73596419801265]
Run 2: l [0.01, 500.005], p [0.0, 30.912263870239258]
Run 3: l [0.01, 250.0075], p [0.0, 4.8869404792785645]
Run 4: l [0.01, 125.00874999999999], p [0.0, 0.6088725328445435]
Run 5: l [62.509375, 125.00874999999999], p [0.03325080871582031, 0.6088725328445435]
Run 6: l [93.7590625, 125.00874999999999], p [0.22109436988830566, 0.6088725328445435]
Run 7: l [109.38390625, 125.00874999999999], p [0.38747525215148926, 0.6088725328445435]
recommended l =  117.196328125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 409.3126142595978]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 129.45155393053017]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 43.47897623400365]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.453382084095065]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.835466179159049, 20.453382084095065]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.707495429616088
radius= 2.8781360052525997 average number of neighbors for each spot is 12.707495429616088
 Cluster 0 has neighbors:
Dmain  3 :  1535
Dmain  4 :  1092
Dmain  2 :  715
Dmain  5 :  626
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000110484']
Add gene:  ENSG00000153002
Minus gene:  ENSG00000110484
Absolute mean change: 0.0951569
Number of non-target spots reduced to: 1314
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000153002-ENSG00000110484
===========================================================================
Add gene:  ENSG00000124935
Minus gene:  ENSG00000153002
Absolute mean change: 0.13006479
Number of non-target spots reduced to: 253
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000153002-ENSG00000110484+ENSG00000124935-ENSG00000153002
===========================================================================
Add gene:  ENSG00000153002
Minus gene:  ENSG00000124935
Stopped! Previous Number of non-target spots 253 985 0.13006479 0.0951569
Previous Number of non-target spots 253 985 0.13006479 0.0951569
Previous Number of non-target spots 253
Current Number of non-target spots 985
Absolute mean change 0.13006479
===========================================================================
Meta gene:  ENSG00000110484+ENSG00000153002-ENSG00000110484+ENSG00000124935-ENSG00000153002
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 364.29794520547944]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 121.25171232876713]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 41.91438356164384]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.96917808219178]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.707191780821917, 19.96917808219178]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.457191780821917
radius= 2.8781360052525997 average number of neighbors for each spot is 12.457191780821917
 Cluster 1 has neighbors:
Dmain  4 :  363
Dmain  5 :  271
SVGs for domain  1 : ['ENSG00000197971', 'ENSG00000167996', 'ENSG00000131095', 'ENSG00000123560', 'ENSG00000205542', 'ENSG00000087086', 'ENSG00000156508', 'ENSG00000137818', 'ENSG00000109846', 'ENSG00000173786', 'ENSG00000107317', 'ENSG00000145592', 'ENSG00000112306', 'ENSG00000144713', 'ENSG00000167526', 'ENSG00000197756', 'ENSG00000167552', 'ENSG00000160307', 'ENSG00000108107', 'ENSG00000109475', 'ENSG00000156482', 'ENSG00000091513', 'ENSG00000213741', 'ENSG00000168314', 'ENSG00000177954', 'ENSG00000142937', 'ENSG00000122026', 'ENSG00000099194', 'ENSG00000105290', 'ENSG00000186468', 'ENSG00000187514', 'ENSG00000046653', 'ENSG00000092964', 'ENSG00000110700', 'ENSG00000080822', 'ENSG00000180354', 'ENSG00000175130', 'ENSG00000189058', 'ENSG00000112531', 'ENSG00000021300', 'ENSG00000167641', 'ENSG00000118785', 'ENSG00000108387', 'ENSG00000159176', 'ENSG00000105695', 'ENSG00000151552', 'ENSG00000129538', 'ENSG00000160781', 'ENSG00000167191', 'ENSG00000149557']
Add gene:  ENSG00000136960
Minus gene:  ENSG00000139970
Absolute mean change: 3.5668294
Number of non-target spots reduced to: 12
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000136960-ENSG00000139970
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000136960-ENSG00000139970
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 349.23333333333335]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 119.47777777777777]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 41.72592592592593]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.933333333333334]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.692592592592593, 19.933333333333334]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.45
radius= 2.8781360052525997 average number of neighbors for each spot is 12.45
 Cluster 2 has neighbors:
Dmain  6 :  1494
Dmain  3 :  1021
Dmain  0 :  715
Dmain  5 :  507
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000111341']
Add gene:  ENSG00000228253
Minus gene:  ENSG00000197971
Absolute mean change: 1.1771586
Number of non-target spots reduced to: 1249
===========================================================================
Meta gene is:  ENSG00000111341+ENSG00000228253-ENSG00000197971
===========================================================================
Add gene:  ENSG00000236609
Minus gene:  ENSG00000111341
Stopped! Previous Number of non-target spots 1249 669 1.1771586 1.0537426
Previous Number of non-target spots 1249 669 1.1771586 1.0537426
Previous Number of non-target spots 1249
Current Number of non-target spots 669
Absolute mean change 1.1771586
===========================================================================
Meta gene:  ENSG00000111341+ENSG00000228253-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 425.0196671709531]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 132.90317700453858]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 44.33131618759455]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.80786686838124]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.956127080181544, 20.80786686838124]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.909228441754916
radius= 2.8781360052525997 average number of neighbors for each spot is 12.909228441754916
 Cluster 3 has neighbors:
Dmain  0 :  1535
Dmain  2 :  1021
Dmain  4 :  699
Dmain  6 :  290
SVGs for domain  3 : ['ENSG00000132639', 'ENSG00000154277']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000171617
Absolute mean change: 1.0827091
Number of non-target spots reduced to: 344
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000183036-ENSG00000171617
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000110484
Absolute mean change: 1.6955097
Number of non-target spots reduced to: 287
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000183036-ENSG00000171617+ENSG00000171617-ENSG00000110484
===========================================================================
Add gene:  ENSG00000123416
Minus gene:  ENSG00000115756
Absolute mean change: 2.6055055
Number of non-target spots reduced to: 279
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000183036-ENSG00000171617+ENSG00000171617-ENSG00000110484+ENSG00000123416-ENSG00000115756
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 421.93195266272187]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 131.24260355029585]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 43.9585798816568]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.707100591715978]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.920118343195266, 20.707100591715978]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.86094674556213
radius= 2.8781360052525997 average number of neighbors for each spot is 12.86094674556213
 Cluster 4 has neighbors:
Dmain  0 :  1092
Dmain  3 :  699
Dmain  5 :  372
Dmain  1 :  363
SVGs for domain  4 : ['ENSG00000197971', 'ENSG00000123560']
Add gene:  ENSG00000187094
Minus gene:  ENSG00000197971
Absolute mean change: 0.38820374
Number of non-target spots reduced to: 1054
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000187094-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198899
Absolute mean change: 0.6095011
Number of non-target spots reduced to: 1051
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000187094-ENSG00000197971+ENSG00000197971-ENSG00000198899
===========================================================================
Add gene:  ENSG00000067715
Minus gene:  ENSG00000197971
Absolute mean change: 0.8657048
Number of non-target spots reduced to: 893
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000187094-ENSG00000197971+ENSG00000197971-ENSG00000198899+ENSG00000067715-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 299.92364990689015]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 101.06145251396649]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 35.998137802607076]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 17.564245810055866]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [7.9031657355679705, 17.564245810055866]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=11.128491620111731
radius= 2.8781360052525997 average number of neighbors for each spot is 11.128491620111731
 Cluster 5 has neighbors:
Dmain  0 :  626
Dmain  2 :  507
Dmain  4 :  372
Dmain  6 :  212
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000131095']
Add gene:  ENSG00000111341
Minus gene:  ENSG00000167996
Absolute mean change: 0.78310776
Number of non-target spots reduced to: 1656
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000111341-ENSG00000167996
===========================================================================
Add gene:  ENSG00000156675
Minus gene:  ENSG00000197971
Absolute mean change: 1.8441832
Number of non-target spots reduced to: 601
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000111341-ENSG00000167996+ENSG00000156675-ENSG00000197971
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000198712
Absolute mean change: 2.7686377
Number of non-target spots reduced to: 140
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000111341-ENSG00000167996+ENSG00000156675-ENSG00000197971+ENSG00000110484-ENSG00000198712
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 318.6805194805195]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 116.16103896103895]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 42.1012987012987]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.288311688311687]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.833766233766234, 20.288311688311687]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.672727272727272
radius= 2.8781360052525997 average number of neighbors for each spot is 12.672727272727272
 Cluster 6 has neighbors:
Dmain  2 :  1494
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 6 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 6!
