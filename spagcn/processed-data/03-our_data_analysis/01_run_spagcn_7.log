Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151671...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  19.80996679620155 84.22599777651943 35.574250233396654
Var of x,y,z =  5523253.443311133 5694715.139829624 5694715.1398296235
Run 1: l [0.01, 1000], p [0.0, 140.45541879813572]
Run 2: l [0.01, 500.005], p [0.0, 22.127445220947266]
Run 3: l [0.01, 250.0075], p [0.0, 3.050379753112793]
Run 4: l [125.00874999999999, 250.0075], p [0.3677389621734619, 3.050379753112793]
Run 5: l [125.00874999999999, 187.508125], p [0.3677389621734619, 1.2990868091583252]
Run 6: l [125.00874999999999, 156.2584375], p [0.3677389621734619, 0.7455706596374512]
Run 7: l [125.00874999999999, 140.63359375], p [0.3677389621734619, 0.5365833044052124]
Run 8: l [132.821171875, 140.63359375], p [0.4473799467086792, 0.5365833044052124]
recommended l =  136.7273828125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  8
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  0.85
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.85 Num of clusters =  7
recommended res =  0.85
Initializing cluster centers with louvain, resolution =  0.85
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.827642276422765, 400.6650406504065]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.827642276422765, 131.4227642276423]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.827642276422765, 53.78373983739837]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.827642276422765, 20.334959349593497]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.671544715447155
radius= 2.982502818107605 average number of neighbors for each spot is 12.671544715447155
 Cluster 0 has neighbors:
Dmain  3 :  1938
Dmain  5 :  711
Dmain  6 :  555
Dmain  1 :  543
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 0 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 0!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.815028901734104, 423.58766859344894]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.815028901734104, 134.39691714836223]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.815028901734104, 54.17148362235067]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.815028901734104, 20.341040462427745]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.66859344894027
radius= 2.982502818107605 average number of neighbors for each spot is 12.66859344894027
 Cluster 1 has neighbors:
Dmain  6 :  2159
Dmain  3 :  623
Dmain  0 :  543
Dmain  4 :  443
Dmain  5 :  377
SVGs for domain  1 : ['ENSG00000110484']
Add gene:  ENSG00000101439
Minus gene:  ENSG00000110484
Absolute mean change: 0.29783034
Number of non-target spots reduced to: 1507
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000101439-ENSG00000110484
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000171617
Absolute mean change: 0.8447013
Number of non-target spots reduced to: 1420
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000101439-ENSG00000110484+ENSG00000110484-ENSG00000171617
===========================================================================
Add gene:  ENSG00000255823
Minus gene:  ENSG00000110484
Absolute mean change: 0.86644936
Number of non-target spots reduced to: 1026
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000101439-ENSG00000110484+ENSG00000110484-ENSG00000171617+ENSG00000255823-ENSG00000110484
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.58021978021978, 348.0087912087912]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.58021978021978, 118.93406593406593]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.58021978021978, 50.02857142857143]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.58021978021978, 19.41978021978022]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.19120879120879
radius= 2.982502818107605 average number of neighbors for each spot is 12.19120879120879
 Cluster 2 has neighbors:
Dmain  5 :  450
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000110484']
Add gene:  ENSG00000163191
Minus gene:  ENSG00000198804
Absolute mean change: 2.660728
Number of non-target spots reduced to: 1392
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000163191-ENSG00000198804
===========================================================================
Add gene:  ENSG00000165949
Minus gene:  ENSG00000198938
Absolute mean change: 4.296815
Number of non-target spots reduced to: 47
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000163191-ENSG00000198804+ENSG00000165949-ENSG00000198938
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000163191-ENSG00000198804+ENSG00000165949-ENSG00000198938
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.897247706422018, 435.5669724770642]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.897247706422018, 137.84220183486238]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.897247706422018, 55.3394495412844]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.897247706422018, 20.623853211009173]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.812844036697248
radius= 2.982502818107605 average number of neighbors for each spot is 12.812844036697248
 Cluster 3 has neighbors:
Dmain  0 :  1938
Dmain  5 :  1018
Dmain  1 :  623
Dmain  6 :  599
SVGs for domain  3 : ['ENSG00000154146', 'ENSG00000187094', 'ENSG00000132639', 'ENSG00000111640', 'ENSG00000128245']
Add gene:  ENSG00000164326
Minus gene:  ENSG00000197971
Absolute mean change: 1.036571
Number of non-target spots reduced to: 812
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000164326-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000110484
Absolute mean change: 1.6446109
Number of non-target spots reduced to: 429
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000164326-ENSG00000197971+ENSG00000197971-ENSG00000110484
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 429 405 1.6446109 1.0952299
Previous Number of non-target spots 429 405 1.6446109 1.0952299
Previous Number of non-target spots 429
Current Number of non-target spots 405
Absolute mean change 1.6446109
===========================================================================
Meta gene:  ENSG00000154146+ENSG00000164326-ENSG00000197971+ENSG00000197971-ENSG00000110484
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.84870848708487, 427.75830258302585]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.84870848708487, 135.71217712177122]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.84870848708487, 54.65313653136531]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.84870848708487, 20.487084870848708]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.728782287822877
radius= 2.982502818107605 average number of neighbors for each spot is 12.728782287822877
 Cluster 4 has neighbors:
Dmain  6 :  1133
Dmain  5 :  562
Dmain  1 :  443
SVGs for domain  4 : ['ENSG00000197971', 'ENSG00000123560']
Add gene:  ENSG00000211592
Minus gene:  ENSG00000198712
Absolute mean change: 0.78190804
Number of non-target spots reduced to: 511
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000211592-ENSG00000198712
===========================================================================
Add gene:  ENSG00000150625
Minus gene:  ENSG00000211592
Stopped! Previous Number of non-target spots 511 713 0.78190804 0.9199655
Previous Number of non-target spots 511 713 0.78190804 0.9199655
Previous Number of non-target spots 511
Current Number of non-target spots 713
Absolute mean change 0.78190804
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000211592-ENSG00000198712
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.489270386266094, 354.3705293276109]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.489270386266094, 119.52789699570816]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.489270386266094, 49.814020028612305]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.489270386266094, 19.2274678111588]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.070100143061516
radius= 2.982502818107605 average number of neighbors for each spot is 12.070100143061516
 Cluster 5 has neighbors:
Dmain  3 :  1018
Dmain  0 :  711
Dmain  4 :  562
Dmain  2 :  450
Dmain  1 :  377
SVGs for domain  5 : ['ENSG00000110484']
Add gene:  ENSG00000173432
Minus gene:  ENSG00000197971
Absolute mean change: 1.0198011
Number of non-target spots reduced to: 1589
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000173432-ENSG00000197971
===========================================================================
Add gene:  ENSG00000251562
Minus gene:  ENSG00000110484
Absolute mean change: 1.1131616
Number of non-target spots reduced to: 710
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000173432-ENSG00000197971+ENSG00000251562-ENSG00000110484
===========================================================================
Add gene:  ENSG00000124935
Minus gene:  ENSG00000123416
Absolute mean change: 1.7698166
Number of non-target spots reduced to: 461
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000173432-ENSG00000197971+ENSG00000251562-ENSG00000110484+ENSG00000124935-ENSG00000123416
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.94013605442177, 458.6054421768707]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.94013605442177, 140.85714285714286]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.94013605442177, 56.053061224489795]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.94013605442177, 20.79047619047619]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.892517006802722
radius= 2.982502818107605 average number of neighbors for each spot is 12.892517006802722
 Cluster 6 has neighbors:
Dmain  1 :  2159
Dmain  4 :  1133
Dmain  3 :  599
Dmain  0 :  555
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 6 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 6!
