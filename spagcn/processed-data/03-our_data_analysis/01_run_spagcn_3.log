Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample 151509...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  29.979340261095345 159.8451726574893 35.67123481866658
Var of x,y,z =  6954870.5212026015 6219744.37651678 6954870.5212026015
Run 1: l [0.01, 1000], p [0.0, 139.1136598729144]
Run 2: l [0.01, 500.005], p [0.0, 24.98978614807129]
Run 3: l [0.01, 250.0075], p [0.0, 3.759335517883301]
Run 4: l [125.00874999999999, 250.0075], p [0.45461976528167725, 3.759335517883301]
Run 5: l [125.00874999999999, 187.508125], p [0.45461976528167725, 1.6239607334136963]
Run 6: l [125.00874999999999, 156.2584375], p [0.45461976528167725, 0.9312796592712402]
Run 7: l [125.00874999999999, 140.63359375], p [0.45461976528167725, 0.6676981449127197]
Run 8: l [125.00874999999999, 132.821171875], p [0.45461976528167725, 0.5550795793533325]
recommended l =  128.91496093749998
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  7
recommended res =  0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.921108742004265, 529.8230277185501]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.921108742004265, 169.53518123667376]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.921108742004265, 59.492537313432834]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.921108742004265, 24.609808102345415]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.840085287846481
radius= 3.064143657684326 average number of neighbors for each spot is 12.840085287846481
 Cluster 0 has neighbors:
Dmain  5 :  2268
Dmain  2 :  823
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000101439', 'ENSG00000145824']
Add gene:  ENSG00000145824
Minus gene:  ENSG00000131711
Absolute mean change: 1.3648813
Number of non-target spots reduced to: 1415
===========================================================================
Meta gene is:  ENSG00000101439+ENSG00000145824-ENSG00000131711
===========================================================================
Add gene:  ENSG00000131711
Minus gene:  ENSG00000177954
Stopped! Previous Number of non-target spots 1415 396 1.3648813 0.91813755
Previous Number of non-target spots 1415 396 1.3648813 0.91813755
Previous Number of non-target spots 1415
Current Number of non-target spots 396
Absolute mean change 1.3648813
===========================================================================
Meta gene:  ENSG00000101439+ENSG00000145824-ENSG00000131711
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.821218074656189, 481.8212180746562]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.821218074656189, 160.55697445972496]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.821218074656189, 57.642436149312374]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.821218074656189, 24.13555992141454]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.658153241650295
radius= 3.064143657684326 average number of neighbors for each spot is 12.658153241650295
 Cluster 1 has neighbors:
Dmain  3 :  3738
Dmain  4 :  1657
Dmain  2 :  1097
SVGs for domain  1 : ['ENSG00000110484']
Add gene:  ENSG00000277586
Minus gene:  ENSG00000110484
Absolute mean change: 0.37702894
Number of non-target spots reduced to: 1131
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000277586-ENSG00000110484
===========================================================================
Add gene:  ENSG00000110484
Minus gene:  ENSG00000277586
Absolute mean change: 0.70565474
Number of non-target spots reduced to: 975
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000277586-ENSG00000110484+ENSG00000110484-ENSG00000277586
===========================================================================
Add gene:  ENSG00000277586
Minus gene:  ENSG00000110484
Stopped! Previous Number of non-target spots 975 1131 0.70565474 0.37702894
Previous Number of non-target spots 975 1131 0.70565474 0.37702894
Previous Number of non-target spots 975
Current Number of non-target spots 1131
Absolute mean change 0.70565474
===========================================================================
Meta gene:  ENSG00000110484+ENSG00000277586-ENSG00000110484+ENSG00000110484-ENSG00000277586
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.908151549942595, 500.5740528128588]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.908151549942595, 165.0918484500574]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.908151549942595, 58.799081515499424]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.908151549942595, 24.495981630309988]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.808266360505167
radius= 3.064143657684326 average number of neighbors for each spot is 12.808266360505167
 Cluster 2 has neighbors:
Dmain  3 :  1118
Dmain  1 :  1097
Dmain  0 :  823
Dmain  4 :  604
SVGs for domain  2 : ['ENSG00000171617', 'ENSG00000115756']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000123416
Absolute mean change: 1.3060067
Number of non-target spots reduced to: 638
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000123416
===========================================================================
Add gene:  ENSG00000123416
Minus gene:  ENSG00000124935
Absolute mean change: 1.7842886
Number of non-target spots reduced to: 340
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000123416+ENSG00000123416-ENSG00000124935
===========================================================================
Add gene:  ENSG00000111341
Minus gene:  ENSG00000104435
Absolute mean change: 1.845104
Number of non-target spots reduced to: 255
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000123416+ENSG00000123416-ENSG00000124935+ENSG00000111341-ENSG00000104435
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.773381294964029, 478.0239808153477]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.773381294964029, 158.96762589928056]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.773381294964029, 57.068345323741006]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.773381294964029, 23.94484412470024]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.559952038369305
radius= 3.064143657684326 average number of neighbors for each spot is 12.559952038369305
 Cluster 3 has neighbors:
Dmain  1 :  3738
Dmain  2 :  1118
Dmain  4 :  890
SVGs for domain  3 : ['ENSG00000128245', 'ENSG00000154146']
Add gene:  ENSG00000104435
Minus gene:  ENSG00000128245
Absolute mean change: 0.7791516
Number of non-target spots reduced to: 357
===========================================================================
Meta gene is:  ENSG00000128245+ENSG00000104435-ENSG00000128245
===========================================================================
Add gene:  ENSG00000154146
Minus gene:  ENSG00000104435
Stopped! Previous Number of non-target spots 357 541 0.7791516 0.96001136
Previous Number of non-target spots 357 541 0.7791516 0.96001136
Previous Number of non-target spots 357
Current Number of non-target spots 541
Absolute mean change 0.7791516
===========================================================================
Meta gene:  ENSG00000128245+ENSG00000104435-ENSG00000128245
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.753424657534246, 458.7866927592955]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.753424657534246, 155.29941291585126]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.753424657534246, 56.41095890410959]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.753424657534246, 23.82191780821918]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.526418786692759
radius= 3.064143657684326 average number of neighbors for each spot is 12.526418786692759
 Cluster 4 has neighbors:
Dmain  1 :  1657
Dmain  3 :  890
Dmain  5 :  757
Dmain  2 :  604
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000110484']
Add gene:  ENSG00000163191
Minus gene:  ENSG00000198938
Absolute mean change: 0.9969709
Number of non-target spots reduced to: 1616
===========================================================================
Meta gene is:  ENSG00000110484+ENSG00000163191-ENSG00000198938
===========================================================================
Add gene:  ENSG00000123560
Minus gene:  ENSG00000110484
Stopped! Previous Number of non-target spots 1616 987 0.9969709 0.5943234
Previous Number of non-target spots 1616 987 0.9969709 0.5943234
Previous Number of non-target spots 1616
Current Number of non-target spots 987
Absolute mean change 0.9969709
===========================================================================
Meta gene:  ENSG00000110484+ENSG00000163191-ENSG00000198938
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.883103081827842, 494.154091392136]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.883103081827842, 164.48990435706696]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.883103081827842, 58.675876726886294]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.883103081827842, 24.419766206163654]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=12.769394261424017
radius= 3.064143657684326 average number of neighbors for each spot is 12.769394261424017
 Cluster 5 has neighbors:
Dmain  0 :  2268
Dmain  4 :  757
Dmain  6 :  164
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000131095']
Add gene:  ENSG00000111341
Minus gene:  ENSG00000167996
Absolute mean change: 1.3101299
Number of non-target spots reduced to: 695
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000111341-ENSG00000167996
===========================================================================
Add gene:  ENSG00000111057
Minus gene:  ENSG00000198938
Absolute mean change: 2.0891788
Number of non-target spots reduced to: 288
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000111341-ENSG00000167996+ENSG00000111057-ENSG00000198938
===========================================================================
Add gene:  ENSG00000026025
Minus gene:  ENSG00000143153
Absolute mean change: 3.1422882
Number of non-target spots reduced to: 183
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000111341-ENSG00000167996+ENSG00000111057-ENSG00000198938+ENSG00000026025-ENSG00000143153
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 19.02629852294922], num_nbr [8.310344827586206, 319.60689655172416]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.51314926147461], num_nbr [8.310344827586206, 120.11724137931034]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.256574630737305], num_nbr [8.310344827586206, 48.262068965517244]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.128287315368652], num_nbr [8.310344827586206, 21.620689655172413]
Calculateing adj matrix using xy only...
recommended radius =  3.064143657684326 num_nbr=11.703448275862069
radius= 3.064143657684326 average number of neighbors for each spot is 11.703448275862069
 Cluster 6 has neighbors:
No neighbor domain found, try bigger radius or smaller ratio.
Found no neighbors for domain 6 . No SVGs will be found for this domain.
