Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br2743_ant...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  392.2883182354826 601.1666037199125 227.8051576414422
Var of x,y,z =  19401423.21545128 29704753.542594433 29704753.542594425
Run 1: l [0.01, 1000], p [0.0, 23.381991142929994]
Run 2: l [0.01, 500.005], p [0.0, 3.4624104499816895]
Run 3: l [250.0075, 500.005], p [0.41881465911865234, 3.4624104499816895]
Run 4: l [250.0075, 375.00625], p [0.41881465911865234, 1.4944093227386475]
Run 5: l [250.0075, 312.50687500000004], p [0.41881465911865234, 0.8579427003860474]
Run 6: l [250.0075, 281.2571875], p [0.41881465911865234, 0.6153998374938965]
Run 7: l [250.0075, 265.63234375], p [0.41881465911865234, 0.5115768909454346]
Run 8: l [257.819921875, 265.63234375], p [0.4638403654098511, 0.5115768909454346]
Run 9: l [261.7261328125, 265.63234375], p [0.4873664379119873, 0.5115768909454346]
recommended l =  263.67923828125004
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
delta_label  0.003861003861003861 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 43
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  6
Res changed to 0.9999999999999999
Initializing cluster centers with louvain, resolution =  1.0999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.0999999999999999 Num of clusters =  9
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  1.0499999999999998
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.0499999999999998 Num of clusters =  7
recommended res =  1.0499999999999998
Initializing cluster centers with louvain, resolution =  1.0499999999999998
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
delta_label  0.004826254826254826 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 64
Initializing cluster centers with louvain, resolution =  1.0499999999999998
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
delta_label  0.003861003861003861 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 61
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.90487514863258, 427.1200951248514]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.90487514863258, 136.84898929845423]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.90487514863258, 55.096313912009514]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.90487514863258, 20.612366230677765]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.809750297265161
radius= 2.982502818107605 average number of neighbors for each spot is 12.809750297265161
 Cluster 0 has neighbors:
Dmain  6 :  2605
Dmain  3 :  1112
Dmain  2 :  492
Dmain  5 :  440
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000198727', 'ENSG00000198786', 'ENSG00000228253']
Add gene:  ENSG00000203930
Minus gene:  ENSG00000132639
Absolute mean change: 0.74939394
Number of non-target spots reduced to: 806
===========================================================================
Meta gene is:  ENSG00000198727+ENSG00000203930-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Absolute mean change: 1.5694387
Number of non-target spots reduced to: 663
===========================================================================
Meta gene is:  ENSG00000198727+ENSG00000203930-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000203930
Stopped! Previous Number of non-target spots 663 406 1.5694387 0.8502641
Previous Number of non-target spots 663 406 1.5694387 0.8502641
Previous Number of non-target spots 663
Current Number of non-target spots 406
Absolute mean change 1.5694387
===========================================================================
Meta gene:  ENSG00000198727+ENSG00000203930-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.83435582822086, 412.6947852760736]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.83435582822086, 131.96472392638037]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.83435582822086, 53.714723926380366]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.83435582822086, 20.309815950920246]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.653374233128835
radius= 2.982502818107605 average number of neighbors for each spot is 12.653374233128835
 Cluster 1 has neighbors:
Dmain  4 :  2245
Dmain  5 :  882
Dmain  2 :  303
SVGs for domain  1 : ['ENSG00000131095']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198938
Absolute mean change: 1.9415584
Number of non-target spots reduced to: 632
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000197971-ENSG00000198938
===========================================================================
Add gene:  ENSG00000198938
Minus gene:  ENSG00000107771
Stopped! Previous Number of non-target spots 632 255 1.9415584 1.1702306
Previous Number of non-target spots 632 255 1.9415584 1.1702306
Previous Number of non-target spots 632
Current Number of non-target spots 255
Absolute mean change 1.9415584
===========================================================================
Meta gene:  ENSG00000131095+ENSG00000197971-ENSG00000198938
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.889583333333333, 438.2416666666667]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.889583333333333, 136.81666666666666]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.889583333333333, 55.03125]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.889583333333333, 20.572916666666668]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.785416666666666
radius= 2.982502818107605 average number of neighbors for each spot is 12.785416666666666
 Cluster 2 has neighbors:
Dmain  5 :  1692
Dmain  6 :  813
Dmain  0 :  492
SVGs for domain  2 : ['ENSG00000034510', 'ENSG00000132639', 'ENSG00000139970', 'ENSG00000067715', 'ENSG00000167552', 'ENSG00000137267', 'ENSG00000104888']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000034510
Absolute mean change: 0.538085
Number of non-target spots reduced to: 202
===========================================================================
Meta gene is:  ENSG00000034510+ENSG00000131095-ENSG00000034510
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 202 909 0.538085 1.3739495
Previous Number of non-target spots 202 909 0.538085 1.3739495
Previous Number of non-target spots 202
Current Number of non-target spots 909
Absolute mean change 0.538085
===========================================================================
Meta gene:  ENSG00000034510+ENSG00000131095-ENSG00000034510
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.534313725490197, 326.53921568627453]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.534313725490197, 115.04411764705883]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.534313725490197, 49.294117647058826]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.534313725490197, 19.291666666666668]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.129901960784315
radius= 2.982502818107605 average number of neighbors for each spot is 12.129901960784315
 Cluster 3 has neighbors:
Dmain  0 :  1112
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000251562']
Add gene:  ENSG00000282885
Minus gene:  ENSG00000132639
Absolute mean change: 1.584029
Number of non-target spots reduced to: 637
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000282885-ENSG00000132639
===========================================================================
Add gene:  ENSG00000255823
Minus gene:  ENSG00000197971
Absolute mean change: 2.9426787
Number of non-target spots reduced to: 199
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000282885-ENSG00000132639+ENSG00000255823-ENSG00000197971
===========================================================================
Add gene:  ENSG00000171885
Minus gene:  ENSG00000123416
Absolute mean change: 3.6863475
Number of non-target spots reduced to: 68
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000282885-ENSG00000132639+ENSG00000255823-ENSG00000197971+ENSG00000171885-ENSG00000123416
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.629076086956522, 377.7880434782609]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.629076086956522, 124.75815217391305]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.629076086956522, 51.41032608695652]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.629076086956522, 19.652173913043477]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.307065217391305
radius= 2.982502818107605 average number of neighbors for each spot is 12.307065217391305
 Cluster 4 has neighbors:
Dmain  1 :  2245
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 4 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 4!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.890041493775934, 444.14522821576764]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.890041493775934, 137.8713692946058]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.890041493775934, 55.05601659751037]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.890041493775934, 20.558091286307054]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.78630705394191
radius= 2.982502818107605 average number of neighbors for each spot is 12.78630705394191
 Cluster 5 has neighbors:
Dmain  2 :  1692
Dmain  1 :  882
Dmain  6 :  460
Dmain  0 :  440
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000198763', 'ENSG00000198888', 'ENSG00000198727', 'ENSG00000198886', 'ENSG00000198840', 'ENSG00000198899', 'ENSG00000198938', 'ENSG00000198804', 'ENSG00000101439']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198763
Absolute mean change: 0.48210895
Number of non-target spots reduced to: 1587
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000197971-ENSG00000198763
===========================================================================
Add gene:  ENSG00000101439
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 1587 941 0.48210895 0.45587075
Previous Number of non-target spots 1587 941 0.48210895 0.45587075
Previous Number of non-target spots 1587
Current Number of non-target spots 941
Absolute mean change 0.48210895
===========================================================================
Meta gene:  ENSG00000198763+ENSG00000197971-ENSG00000198763
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.72004508972168], num_nbr [8.88440366972477, 437.8954128440367]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.86002254486084], num_nbr [8.88440366972477, 136.74311926605503]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.93001127243042], num_nbr [8.88440366972477, 54.913761467889906]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.96500563621521], num_nbr [8.88440366972477, 20.535779816513763]
Calculateing adj matrix using xy only...
recommended radius =  2.982502818107605 num_nbr=12.763302752293578
radius= 2.982502818107605 average number of neighbors for each spot is 12.763302752293578
 Cluster 6 has neighbors:
Dmain  0 :  2605
Dmain  2 :  813
Dmain  5 :  460
SVGs for domain  6 : ['ENSG00000132639', 'ENSG00000111640', 'ENSG00000189043', 'ENSG00000143153']
Add gene:  ENSG00000269028
Minus gene:  ENSG00000131095
Absolute mean change: 1.8315415
Number of non-target spots reduced to: 377
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000269028-ENSG00000131095
===========================================================================
Add gene:  ENSG00000189043
Minus gene:  ENSG00000269028
Stopped! Previous Number of non-target spots 377 396 1.8315415 2.3492293
Previous Number of non-target spots 377 396 1.8315415 2.3492293
Previous Number of non-target spots 377
Current Number of non-target spots 396
Absolute mean change 1.8315415
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000269028-ENSG00000131095
===========================================================================
