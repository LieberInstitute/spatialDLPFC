Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
Continuing with sample Br6432_ant_2...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  458.8589828469559 706.0632504746136 314.3934932629218
Var of x,y,z =  21783783.29373512 23874110.18582406 23874110.18582405
Run 1: l [0.01, 1000], p [0.0, 19.02400281874374]
Run 2: l [0.01, 500.005], p [0.0, 2.633002996444702]
Run 3: l [250.0075, 500.005], p [0.31424975395202637, 2.633002996444702]
Run 4: l [250.0075, 375.00625], p [0.31424975395202637, 1.1181690692901611]
Run 5: l [250.0075, 312.50687500000004], p [0.31424975395202637, 0.6393008232116699]
Run 6: l [281.2571875, 312.50687500000004], p [0.4591398239135742, 0.6393008232116699]
Run 7: l [281.2571875, 296.88203125], p [0.4591398239135742, 0.5446056127548218]
recommended l =  289.069609375
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
delta_label  0.004518072289156626 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 85
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.847977684797769, 401.581589958159]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.847977684797769, 133.0041841004184]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.847977684797769, 46.73082287308229]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.847977684797769, 20.393305439330543]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.701534170153417
radius= 2.9539172649383545 average number of neighbors for each spot is 12.701534170153417
 Cluster 0 has neighbors:
Dmain  5 :  1281
Dmain  4 :  720
Dmain  3 :  443
SVGs for domain  0 : ['ENSG00000132639', 'ENSG00000034510', 'ENSG00000067715', 'ENSG00000137267', 'ENSG00000117632', 'ENSG00000104888']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198899
Absolute mean change: 1.1355376
Number of non-target spots reduced to: 725
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000197971-ENSG00000198899
===========================================================================
Add gene:  ENSG00000034510
Minus gene:  ENSG00000197971
Absolute mean change: 1.5551693
Number of non-target spots reduced to: 517
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000197971-ENSG00000198899+ENSG00000034510-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000187094
Absolute mean change: 1.9302139
Number of non-target spots reduced to: 305
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000197971-ENSG00000198899+ENSG00000034510-ENSG00000197971+ENSG00000197971-ENSG00000187094
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.636229749631811, 386.9322533136966]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.636229749631811, 129.54344624447717]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.636229749631811, 45.68483063328424]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.636229749631811, 19.8659793814433]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.374079528718704
radius= 2.9539172649383545 average number of neighbors for each spot is 12.374079528718704
 Cluster 1 has neighbors:
Dmain  3 :  969
Dmain  5 :  501
Dmain  6 :  282
SVGs for domain  1 : ['ENSG00000131095']
Add gene:  ENSG00000145824
Minus gene:  ENSG00000154146
Absolute mean change: 2.4822845
Number of non-target spots reduced to: 189
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000145824-ENSG00000154146
===========================================================================
Add gene:  ENSG00000113140
Minus gene:  ENSG00000115310
Absolute mean change: 3.634849
Number of non-target spots reduced to: 66
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000145824-ENSG00000154146+ENSG00000113140-ENSG00000115310
===========================================================================
Add gene:  ENSG00000228253
Minus gene:  ENSG00000143153
Absolute mean change: 4.4479337
Number of non-target spots reduced to: 35
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000145824-ENSG00000154146+ENSG00000113140-ENSG00000115310+ENSG00000228253-ENSG00000143153
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.932876712328767, 425.8945205479452]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.932876712328767, 138.77397260273972]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.932876712328767, 47.86164383561644]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.932876712328767, 20.706849315068492]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.861643835616439
radius= 2.9539172649383545 average number of neighbors for each spot is 12.861643835616439
 Cluster 2 has neighbors:
Dmain  3 :  2459
Dmain  4 :  879
Dmain  5 :  240
SVGs for domain  2 : ['ENSG00000154096', 'ENSG00000171617', 'ENSG00000115310', 'ENSG00000128989']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000197971
Absolute mean change: 1.6074932
Number of non-target spots reduced to: 618
===========================================================================
Meta gene is:  ENSG00000154096+ENSG00000115756-ENSG00000197971
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000100097
Absolute mean change: 2.5470648
Number of non-target spots reduced to: 192
===========================================================================
Meta gene is:  ENSG00000154096+ENSG00000115756-ENSG00000197971+ENSG00000171617-ENSG00000100097
===========================================================================
Add gene:  ENSG00000128989
Minus gene:  ENSG00000129244
Absolute mean change: 3.181312
Number of non-target spots reduced to: 103
===========================================================================
Meta gene is:  ENSG00000154096+ENSG00000115756-ENSG00000197971+ENSG00000171617-ENSG00000100097+ENSG00000128989-ENSG00000129244
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.784203102961918, 395.1255289139633]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.784203102961918, 131.50493653032441]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.784203102961918, 46.09590973201693]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.784203102961918, 20.150916784203105]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.56981664315938
radius= 2.9539172649383545 average number of neighbors for each spot is 12.56981664315938
 Cluster 3 has neighbors:
Dmain  2 :  2459
Dmain  4 :  1246
Dmain  1 :  969
Dmain  5 :  542
Dmain  0 :  443
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000198886', 'ENSG00000198763', 'ENSG00000198938', 'ENSG00000198888', 'ENSG00000198840', 'ENSG00000198899', 'ENSG00000198804', 'ENSG00000198712', 'ENSG00000198727', 'ENSG00000198786', 'ENSG00000228253', 'ENSG00000255823']
Add gene:  ENSG00000145824
Minus gene:  ENSG00000132639
Absolute mean change: 0.51762223
Number of non-target spots reduced to: 1406
===========================================================================
Meta gene is:  ENSG00000198886+ENSG00000145824-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Absolute mean change: 0.5919261
Number of non-target spots reduced to: 904
===========================================================================
Meta gene is:  ENSG00000198886+ENSG00000145824-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 904 920 0.5919261 0.51762223
Previous Number of non-target spots 904 920 0.5919261 0.51762223
Previous Number of non-target spots 904
Current Number of non-target spots 920
Absolute mean change 0.5919261
===========================================================================
Meta gene:  ENSG00000198886+ENSG00000145824-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.920430107526881, 426.2795698924731]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.920430107526881, 138.15483870967742]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.920430107526881, 47.79784946236559]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.920430107526881, 20.690322580645162]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.843010752688173
radius= 2.9539172649383545 average number of neighbors for each spot is 12.843010752688173
 Cluster 4 has neighbors:
Dmain  3 :  1246
Dmain  2 :  879
Dmain  0 :  720
Dmain  5 :  490
SVGs for domain  4 : ['ENSG00000277586', 'ENSG00000104722']
Add gene:  ENSG00000104722
Minus gene:  ENSG00000150625
Absolute mean change: 1.196502
Number of non-target spots reduced to: 562
===========================================================================
Meta gene is:  ENSG00000277586+ENSG00000104722-ENSG00000150625
===========================================================================
Add gene:  ENSG00000150625
Minus gene:  ENSG00000131095
Absolute mean change: 1.8364761
Number of non-target spots reduced to: 359
===========================================================================
Meta gene is:  ENSG00000277586+ENSG00000104722-ENSG00000150625+ENSG00000150625-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000150625
Stopped! Previous Number of non-target spots 359 353 1.8364761 1.1965017
Previous Number of non-target spots 359 353 1.8364761 1.1965017
Previous Number of non-target spots 359
Current Number of non-target spots 353
Absolute mean change 1.8364761
===========================================================================
Meta gene:  ENSG00000277586+ENSG00000104722-ENSG00000150625+ENSG00000150625-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.739514348785871, 346.5077262693157]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.739514348785871, 118.97130242825607]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.739514348785871, 43.75496688741722]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.739514348785871, 19.763796909492275]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.437086092715232
radius= 2.9539172649383545 average number of neighbors for each spot is 12.437086092715232
 Cluster 5 has neighbors:
Dmain  0 :  1281
Dmain  3 :  542
Dmain  1 :  501
Dmain  4 :  490
Dmain  6 :  263
Can't find any genes such that more spots in domain 5 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.70995670995671, 314.3982683982684]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.70995670995671, 118.73593073593074]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.70995670995671, 44.12987012987013]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.70995670995671, 19.774891774891774]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.415584415584416
radius= 2.9539172649383545 average number of neighbors for each spot is 12.415584415584416
 Cluster 6 has neighbors:
Dmain  5 :  263
SVGs for domain  6 : ['ENSG00000123560']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198712
Absolute mean change: 3.5494301
Number of non-target spots reduced to: 166
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000197971-ENSG00000198712
===========================================================================
Add gene:  ENSG00000135821
Minus gene:  ENSG00000128656
Absolute mean change: 4.1967697
Number of non-target spots reduced to: 8
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000197971-ENSG00000198712+ENSG00000135821-ENSG00000128656
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000197971-ENSG00000198712+ENSG00000135821-ENSG00000128656
