Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br3942_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  272.38741816140464 448.5836169247123 200.03519645696178
Var of x,y,z =  26822193.675977618 20487518.252042882 26822193.675977614
Run 1: l [0.01, 1000], p [0.0, 21.830009445223585]
Run 2: l [0.01, 500.005], p [0.0, 3.1237668991088867]
Run 3: l [250.0075, 500.005], p [0.364346981048584, 3.1237668991088867]
Run 4: l [250.0075, 375.00625], p [0.364346981048584, 1.3236439228057861]
Run 5: l [250.0075, 312.50687500000004], p [0.364346981048584, 0.7521075010299683]
Run 6: l [250.0075, 281.2571875], p [0.364346981048584, 0.5370563268661499]
Run 7: l [265.63234375, 281.2571875], p [0.44564390182495117, 0.5370563268661499]
recommended l =  273.444765625
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  7
recommended res =  0.7
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.907088122605364, 412.92816091954023]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.907088122605364, 136.5507662835249]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.907088122605364, 47.53544061302682]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.907088122605364, 20.628352490421456]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.817049808429118
radius= 2.9539172649383545 average number of neighbors for each spot is 12.817049808429118
 Cluster 0 has neighbors:
Dmain  1 :  4206
Dmain  5 :  1300
Dmain  4 :  1282
Dmain  6 :  383
Dmain  3 :  262
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000198840', 'ENSG00000198786', 'ENSG00000269028', 'ENSG00000212907']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000154146
Absolute mean change: 0.8448849
Number of non-target spots reduced to: 710
===========================================================================
Meta gene is:  ENSG00000198840+ENSG00000197971-ENSG00000154146
===========================================================================
Add gene:  ENSG00000198712
Minus gene:  ENSG00000197971
Absolute mean change: 1.566371
Number of non-target spots reduced to: 672
===========================================================================
Meta gene is:  ENSG00000198840+ENSG00000197971-ENSG00000154146+ENSG00000198712-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198763
Stopped! Previous Number of non-target spots 672 405 1.566371 0.9410529
Previous Number of non-target spots 672 405 1.566371 0.9410529
Previous Number of non-target spots 672
Current Number of non-target spots 405
Absolute mean change 1.566371
===========================================================================
Meta gene:  ENSG00000198840+ENSG00000197971-ENSG00000154146+ENSG00000198712-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.940881763527054, 429.6302605210421]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.940881763527054, 139.00200400801603]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.940881763527054, 48.02404809619239]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.940881763527054, 20.759519038076153]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.880761523046091
radius= 2.9539172649383545 average number of neighbors for each spot is 12.880761523046091
 Cluster 1 has neighbors:
Dmain  0 :  4206
Dmain  5 :  824
Dmain  4 :  810
Dmain  6 :  210
SVGs for domain  1 : ['ENSG00000111640', 'ENSG00000154277', 'ENSG00000132639', 'ENSG00000117632', 'ENSG00000034510', 'ENSG00000166165', 'ENSG00000196262', 'ENSG00000139970', 'ENSG00000089220', 'ENSG00000137267', 'ENSG00000109971', 'ENSG00000166681', 'ENSG00000128739', 'ENSG00000149925']
Add gene:  ENSG00000149925
Minus gene:  ENSG00000198886
Absolute mean change: 1.6059637
Number of non-target spots reduced to: 57
===========================================================================
Meta gene is:  ENSG00000111640+ENSG00000149925-ENSG00000198886
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 57 83 1.6059637 2.5572824
Previous Number of non-target spots 57 83 1.6059637 2.5572824
Previous Number of non-target spots 57
Current Number of non-target spots 83
Absolute mean change 1.6059637
===========================================================================
Meta gene:  ENSG00000111640+ENSG00000149925-ENSG00000198886
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.513026052104209, 321.54108216432866]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.513026052104209, 116.51302605210421]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.513026052104209, 42.895791583166336]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.513026052104209, 19.190380761523045]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.070140280561123
radius= 2.9539172649383545 average number of neighbors for each spot is 12.070140280561123
 Cluster 2 has neighbors:
Dmain  6 :  170
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 2 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 2!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.755681818181818, 372.96590909090907]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.755681818181818, 127.2784090909091]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.755681818181818, 45.50852272727273]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.755681818181818, 20.06534090909091]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.534090909090908
radius= 2.9539172649383545 average number of neighbors for each spot is 12.534090909090908
 Cluster 3 has neighbors:
Dmain  6 :  372
Dmain  5 :  331
SVGs for domain  3 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000131095', 'ENSG00000109846']
Add gene:  ENSG00000123560
Minus gene:  ENSG00000198712
Absolute mean change: 2.8596568
Number of non-target spots reduced to: 372
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000123560-ENSG00000198712
===========================================================================
Add gene:  ENSG00000146122
Minus gene:  ENSG00000143933
Absolute mean change: 3.5961862
Number of non-target spots reduced to: 23
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000123560-ENSG00000198712+ENSG00000146122-ENSG00000143933
===========================================================================
Add gene:  ENSG00000107317
Minus gene:  ENSG00000166006
Absolute mean change: 3.9617772
Number of non-target spots reduced to: 10
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000123560-ENSG00000198712+ENSG00000146122-ENSG00000143933+ENSG00000107317-ENSG00000166006
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.883720930232558, 382.0797342192691]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.883720930232558, 131.66777408637873]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.883720930232558, 46.69435215946844]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.883720930232558, 20.471760797342192]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.76079734219269
radius= 2.9539172649383545 average number of neighbors for each spot is 12.76079734219269
 Cluster 4 has neighbors:
Dmain  0 :  1282
Dmain  1 :  810
Dmain  5 :  316
Dmain  6 :  222
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000171617', 'ENSG00000171476']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000123416
Absolute mean change: 0.61090755
Number of non-target spots reduced to: 939
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000123416
===========================================================================
Add gene:  ENSG00000198840
Minus gene:  ENSG00000197971
Absolute mean change: 1.665102
Number of non-target spots reduced to: 592
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000123416+ENSG00000198840-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198786
Stopped! Previous Number of non-target spots 592 390 1.665102 0.8883555
Previous Number of non-target spots 592 390 1.665102 0.8883555
Previous Number of non-target spots 592
Current Number of non-target spots 390
Absolute mean change 1.665102
===========================================================================
Meta gene:  ENSG00000171617+ENSG00000115756-ENSG00000123416+ENSG00000198840-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.946009389671362, 432.5211267605634]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.946009389671362, 138.83098591549296]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.946009389671362, 47.924882629107984]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.946009389671362, 20.748826291079812]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.892018779342724
radius= 2.9539172649383545 average number of neighbors for each spot is 12.892018779342724
 Cluster 5 has neighbors:
Dmain  0 :  1300
Dmain  1 :  824
Dmain  3 :  331
Dmain  4 :  316
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000185883', 'ENSG00000096384', 'ENSG00000111674', 'ENSG00000170027', 'ENSG00000104888', 'ENSG00000106976', 'ENSG00000176884', 'ENSG00000174684', 'ENSG00000105220', 'ENSG00000157152', 'ENSG00000005486', 'ENSG00000168159', 'ENSG00000214548', 'ENSG00000171246', 'ENSG00000100321', 'ENSG00000033627', 'ENSG00000264364', 'ENSG00000054793']
Add gene:  ENSG00000164241
Minus gene:  ENSG00000111640
Absolute mean change: 0.430542
Number of non-target spots reduced to: 893
===========================================================================
Meta gene is:  ENSG00000185883+ENSG00000164241-ENSG00000111640
===========================================================================
Add gene:  ENSG00000123416
Minus gene:  ENSG00000157184
Stopped! Previous Number of non-target spots 893 1082 0.430542 1.0722313
Previous Number of non-target spots 893 1082 0.430542 1.0722313
Previous Number of non-target spots 893
Current Number of non-target spots 1082
Absolute mean change 0.430542
===========================================================================
Meta gene:  ENSG00000185883+ENSG00000164241-ENSG00000111640
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.243506493506494, 300.4902597402597]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.243506493506494, 106.58766233766234]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.243506493506494, 40.07142857142857]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.243506493506494, 18.27922077922078]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=11.564935064935066
radius= 2.9539172649383545 average number of neighbors for each spot is 11.564935064935066
 Cluster 6 has neighbors:
Dmain  3 :  372
Dmain  4 :  222
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000251562']
Add gene:  ENSG00000203930
Minus gene:  ENSG00000111640
Absolute mean change: 1.6425514
Number of non-target spots reduced to: 837
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000203930-ENSG00000111640
===========================================================================
Add gene:  ENSG00000198763
Minus gene:  ENSG00000105290
Absolute mean change: 2.2672067
Number of non-target spots reduced to: 107
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000203930-ENSG00000111640+ENSG00000198763-ENSG00000105290
===========================================================================
Add gene:  ENSG00000145824
Minus gene:  ENSG00000154146
Absolute mean change: 3.5138597
Number of non-target spots reduced to: 103
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000203930-ENSG00000111640+ENSG00000198763-ENSG00000105290+ENSG00000145824-ENSG00000154146
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
