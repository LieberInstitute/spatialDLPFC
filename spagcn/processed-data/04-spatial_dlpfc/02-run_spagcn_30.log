Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8325_mid_2...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  644.5327062787259 1104.5108121944234 420.83463996463666
Var of x,y,z =  22063518.018650092 25119000.885260493 25119000.885260485
Run 1: l [0.01, 1000], p [0.0, 22.66729292622188]
Run 2: l [0.01, 500.005], p [0.0, 3.1761598587036133]
Run 3: l [250.0075, 500.005], p [0.3854091167449951, 3.1761598587036133]
Run 4: l [250.0075, 375.00625], p [0.3854091167449951, 1.3582143783569336]
Run 5: l [250.0075, 312.50687500000004], p [0.3854091167449951, 0.7804206609725952]
Run 6: l [250.0075, 281.2571875], p [0.3854091167449951, 0.5619615316390991]
Run 7: l [265.63234375, 281.2571875], p [0.46869051456451416, 0.5619615316390991]
Run 8: l [265.63234375, 273.444765625], p [0.46869051456451416, 0.5140465497970581]
recommended l =  269.5385546875
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
delta_label  0.0016826923076923078 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 49
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.8885440826416], num_nbr [8.93341121495327, 451.70327102803736]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.9442720413208], num_nbr [8.93341121495327, 141.65887850467288]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.9721360206604], num_nbr [8.93341121495327, 55.424065420560744]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9860680103302], num_nbr [8.93341121495327, 20.71144859813084]
Calculateing adj matrix using xy only...
recommended radius =  2.9930340051651 num_nbr=12.863317757009346
radius= 2.9930340051651 average number of neighbors for each spot is 12.863317757009346
 Cluster 0 has neighbors:
Dmain  3 :  2442
Dmain  4 :  2366
Dmain  1 :  951
Dmain  5 :  463
Dmain  2 :  365
Dmain  6 :  180
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000197971']
Add gene:  ENSG00000198763
Minus gene:  ENSG00000197971
Absolute mean change: 0.25861788
Number of non-target spots reduced to: 1071
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000198763-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198763
Stopped! Previous Number of non-target spots 1071 1273 0.25861788 0.4642911
Previous Number of non-target spots 1071 1273 0.25861788 0.4642911
Previous Number of non-target spots 1071
Current Number of non-target spots 1273
Absolute mean change 0.25861788
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000198763-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.8885440826416], num_nbr [8.636363636363637, 398.3436055469954]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.9442720413208], num_nbr [8.636363636363637, 128.54545454545453]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.9721360206604], num_nbr [8.636363636363637, 51.36363636363637]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9860680103302], num_nbr [8.636363636363637, 19.650231124807394]
Calculateing adj matrix using xy only...
recommended radius =  2.9930340051651 num_nbr=12.302003081664099
radius= 2.9930340051651 average number of neighbors for each spot is 12.302003081664099
 Cluster 1 has neighbors:
Dmain  2 :  2218
Dmain  0 :  951
Dmain  3 :  686
Dmain  6 :  578
Dmain  4 :  395
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000131095']
Add gene:  ENSG00000145824
Minus gene:  ENSG00000197971
Absolute mean change: 0.66071224
Number of non-target spots reduced to: 2043
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000145824-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000163399
Stopped! Previous Number of non-target spots 2043 797 0.66071224 0.36465716
Previous Number of non-target spots 2043 797 0.66071224 0.36465716
Previous Number of non-target spots 2043
Current Number of non-target spots 797
Absolute mean change 0.66071224
===========================================================================
Meta gene:  ENSG00000131095+ENSG00000145824-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.8885440826416], num_nbr [8.863033873343152, 433.4521354933726]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.9442720413208], num_nbr [8.863033873343152, 138.15905743740797]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.9721360206604], num_nbr [8.863033873343152, 54.40058910162003]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9860680103302], num_nbr [8.863033873343152, 20.428571428571427]
Calculateing adj matrix using xy only...
recommended radius =  2.9930340051651 num_nbr=12.734904270986744
radius= 2.9930340051651 average number of neighbors for each spot is 12.734904270986744
 Cluster 2 has neighbors:
Dmain  1 :  2218
Dmain  3 :  530
Dmain  6 :  496
SVGs for domain  2 : ['ENSG00000128245', 'ENSG00000187094', 'ENSG00000130558', 'ENSG00000171617', 'ENSG00000150625', 'ENSG00000162545', 'ENSG00000128989', 'ENSG00000020129']
Add gene:  ENSG00000162545
Minus gene:  ENSG00000197971
Absolute mean change: 1.8617876
Number of non-target spots reduced to: 947
===========================================================================
Meta gene is:  ENSG00000128245+ENSG00000162545-ENSG00000197971
===========================================================================
Add gene:  ENSG00000115756
Minus gene:  ENSG00000100285
Absolute mean change: 2.279013
Number of non-target spots reduced to: 217
===========================================================================
Meta gene is:  ENSG00000128245+ENSG00000162545-ENSG00000197971+ENSG00000115756-ENSG00000100285
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000115756
Absolute mean change: 2.653016
Number of non-target spots reduced to: 150
===========================================================================
Meta gene is:  ENSG00000128245+ENSG00000162545-ENSG00000197971+ENSG00000115756-ENSG00000100285+ENSG00000171617-ENSG00000115756
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.8885440826416], num_nbr [8.959827833572453, 463.961262553802]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.9442720413208], num_nbr [8.959827833572453, 143.3873744619799]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.9721360206604], num_nbr [8.959827833572453, 55.862266857962695]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9860680103302], num_nbr [8.959827833572453, 20.800573888091822]
Calculateing adj matrix using xy only...
recommended radius =  2.9930340051651 num_nbr=12.913916786226686
radius= 2.9930340051651 average number of neighbors for each spot is 12.913916786226686
 Cluster 3 has neighbors:
Dmain  0 :  2442
Dmain  1 :  686
Dmain  2 :  530
SVGs for domain  3 : ['ENSG00000132639', 'ENSG00000123416', 'ENSG00000131711', 'ENSG00000277586', 'ENSG00000034510', 'ENSG00000104722']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000187094
Absolute mean change: 1.5056913
Number of non-target spots reduced to: 386
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000183036-ENSG00000187094
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000101439
Absolute mean change: 1.7555583
Number of non-target spots reduced to: 174
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000183036-ENSG00000187094+ENSG00000187094-ENSG00000101439
===========================================================================
Add gene:  ENSG00000101439
Minus gene:  ENSG00000187094
Stopped! Previous Number of non-target spots 174 148 1.7555583 1.5056913
Previous Number of non-target spots 174 148 1.7555583 1.5056913
Previous Number of non-target spots 174
Current Number of non-target spots 148
Absolute mean change 1.7555583
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000183036-ENSG00000187094+ENSG00000187094-ENSG00000101439
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.8885440826416], num_nbr [8.971993410214168, 448.66062602965405]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.9442720413208], num_nbr [8.971993410214168, 142.84184514003294]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.9721360206604], num_nbr [8.971993410214168, 56.01317957166392]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9860680103302], num_nbr [8.971993410214168, 20.86326194398682]
Calculateing adj matrix using xy only...
recommended radius =  2.9930340051651 num_nbr=12.937397034596376
radius= 2.9930340051651 average number of neighbors for each spot is 12.937397034596376
 Cluster 4 has neighbors:
Dmain  0 :  2366
Dmain  5 :  442
Dmain  1 :  395
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 4 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 4!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.8885440826416], num_nbr [8.735376044568245, 327.958217270195]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.9442720413208], num_nbr [8.735376044568245, 117.76601671309193]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.9721360206604], num_nbr [8.735376044568245, 49.92757660167131]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9860680103302], num_nbr [8.735376044568245, 19.738161559888578]
Calculateing adj matrix using xy only...
recommended radius =  2.9930340051651 num_nbr=12.428969359331477
radius= 2.9930340051651 average number of neighbors for each spot is 12.428969359331477
 Cluster 5 has neighbors:
Dmain  0 :  463
Dmain  4 :  442
Dmain  6 :  337
SVGs for domain  5 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000131095']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Absolute mean change: 2.935714
Number of non-target spots reduced to: 498
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000131095-ENSG00000132639
===========================================================================
Add gene:  ENSG00000109846
Minus gene:  ENSG00000160014
Absolute mean change: 4.4452114
Number of non-target spots reduced to: 30
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000131095-ENSG00000132639+ENSG00000109846-ENSG00000160014
===========================================================================
Add gene:  ENSG00000064787
Minus gene:  ENSG00000141367
Absolute mean change: 5.035466
Number of non-target spots reduced to: 13
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000131095-ENSG00000132639+ENSG00000109846-ENSG00000160014+ENSG00000064787-ENSG00000141367
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.8885440826416], num_nbr [7.2492012779552715, 279.0670926517572]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.9442720413208], num_nbr [7.2492012779552715, 93.24600638977635]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.9721360206604], num_nbr [7.2492012779552715, 39.150159744408946]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.9860680103302], num_nbr [7.2492012779552715, 15.715654952076678]
Calculateing adj matrix using xy only...
recommended radius =  2.9930340051651 num_nbr=10.038338658146964
radius= 2.9930340051651 average number of neighbors for each spot is 10.038338658146964
 Cluster 6 has neighbors:
Dmain  1 :  578
Dmain  2 :  496
Dmain  5 :  337
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 6 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 6!
