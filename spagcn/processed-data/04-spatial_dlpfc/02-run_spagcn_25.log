Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8667_ant...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  465.14386906981963 779.0533280623237 412.3848796531873
Var of x,y,z =  19115422.66345541 22813628.597297773 22813628.59729777
Run 1: l [0.01, 1000], p [0.0, 22.962690606029035]
Run 2: l [0.01, 500.005], p [0.0, 3.425630569458008]
Run 3: l [250.0075, 500.005], p [0.4224684238433838, 3.425630569458008]
Run 4: l [250.0075, 375.00625], p [0.4224684238433838, 1.4829835891723633]
Run 5: l [250.0075, 312.50687500000004], p [0.4224684238433838, 0.8557473421096802]
Run 6: l [250.0075, 281.2571875], p [0.4224684238433838, 0.6166287660598755]
Run 7: l [250.0075, 265.63234375], p [0.4224684238433838, 0.5141510963439941]
Run 8: l [257.819921875, 265.63234375], p [0.46698832511901855, 0.5141510963439941]
recommended l =  261.7261328125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
delta_label  0.003553854565336249 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 34
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
delta_label  0.004647348277747403 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 67
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 384.3907284768212]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 126.68344370860927]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 43.267549668874175]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.449006622516556]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.839735099337748, 20.449006622516556]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.71523178807947
radius= 2.8781360052525997 average number of neighbors for each spot is 12.71523178807947
 Cluster 0 has neighbors:
Dmain  3 :  1860
Dmain  4 :  1680
Dmain  2 :  1111
Dmain  1 :  530
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000198763', 'ENSG00000198886', 'ENSG00000198804', 'ENSG00000198786', 'ENSG00000269028', 'ENSG00000087250', 'ENSG00000212907', 'ENSG00000197756']
Add gene:  ENSG00000181195
Minus gene:  ENSG00000132639
Absolute mean change: 0.4108286
Number of non-target spots reduced to: 1391
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000181195-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Absolute mean change: 0.4820447
Number of non-target spots reduced to: 772
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000181195-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 772 996 0.4820447 0.4108286
Previous Number of non-target spots 772 996 0.4820447 0.4108286
Previous Number of non-target spots 772
Current Number of non-target spots 996
Absolute mean change 0.4820447
===========================================================================
Meta gene:  ENSG00000198763+ENSG00000181195-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 394.14426229508194]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 126.27540983606558]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 42.863934426229505]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.291803278688526]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.814754098360655, 20.291803278688526]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.640983606557377
radius= 2.8781360052525997 average number of neighbors for each spot is 12.640983606557377
 Cluster 1 has neighbors:
Dmain  5 :  1478
Dmain  3 :  576
Dmain  0 :  530
Dmain  4 :  306
SVGs for domain  1 : ['ENSG00000132639', 'ENSG00000123416', 'ENSG00000034510', 'ENSG00000067715', 'ENSG00000117632', 'ENSG00000102003']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198712
Absolute mean change: 1.3258164
Number of non-target spots reduced to: 349
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000197971-ENSG00000198712
===========================================================================
Add gene:  ENSG00000067715
Minus gene:  ENSG00000197971
Absolute mean change: 1.537035
Number of non-target spots reduced to: 339
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000197971-ENSG00000198712+ENSG00000067715-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000143153
Absolute mean change: 1.7551646
Number of non-target spots reduced to: 227
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000197971-ENSG00000198712+ENSG00000067715-ENSG00000197971+ENSG00000197971-ENSG00000143153
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 368.16643741403027]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 119.1898211829436]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 41.09215955983494]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.620357634112793]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.570839064649244, 19.620357634112793]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.26685006877579
radius= 2.8781360052525997 average number of neighbors for each spot is 12.26685006877579
 Cluster 2 has neighbors:
Dmain  0 :  1111
Dmain  5 :  371
Dmain  6 :  261
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000131095']
Add gene:  ENSG00000188536
Minus gene:  ENSG00000167996
Absolute mean change: 2.0145793
Number of non-target spots reduced to: 698
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000188536-ENSG00000167996
===========================================================================
Add gene:  ENSG00000113140
Minus gene:  ENSG00000075624
Absolute mean change: 3.359889
Number of non-target spots reduced to: 94
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000188536-ENSG00000167996+ENSG00000113140-ENSG00000075624
===========================================================================
Add gene:  ENSG00000182600
Minus gene:  ENSG00000188536
Stopped! Previous Number of non-target spots 94 41 3.359889 2.7645974
Previous Number of non-target spots 94 41 3.359889 2.7645974
Previous Number of non-target spots 94
Current Number of non-target spots 41
Absolute mean change 3.359889
===========================================================================
Meta gene:  ENSG00000131095+ENSG00000188536-ENSG00000167996+ENSG00000113140-ENSG00000075624
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 375.37264957264955]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 122.591452991453]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 42.256410256410255]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.148717948717948]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.793162393162394, 20.148717948717948]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.577777777777778
radius= 2.8781360052525997 average number of neighbors for each spot is 12.577777777777778
 Cluster 3 has neighbors:
Dmain  0 :  1860
Dmain  4 :  1686
Dmain  1 :  576
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 3 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 3!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 381.13907284768214]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 126.03090507726269]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 43.158940397350996]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 20.43708609271523]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.867549668874172, 20.43708609271523]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.73289183222958
radius= 2.8781360052525997 average number of neighbors for each spot is 12.73289183222958
 Cluster 4 has neighbors:
Dmain  3 :  1686
Dmain  0 :  1680
Dmain  1 :  306
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000269028', 'ENSG00000228253', 'ENSG00000171476']
Add gene:  ENSG00000164326
Minus gene:  ENSG00000269028
Absolute mean change: 0.11796312
Number of non-target spots reduced to: 878
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000164326-ENSG00000269028
===========================================================================
Add gene:  ENSG00000198763
Minus gene:  ENSG00000164326
Absolute mean change: 0.43861222
Number of non-target spots reduced to: 392
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000164326-ENSG00000269028+ENSG00000198763-ENSG00000164326
===========================================================================
Add gene:  ENSG00000166863
Minus gene:  ENSG00000198763
Stopped! Previous Number of non-target spots 392 720 0.43861222 0.05399455
Previous Number of non-target spots 392 720 0.43861222 0.05399455
Previous Number of non-target spots 392
Current Number of non-target spots 720
Absolute mean change 0.43861222
===========================================================================
Meta gene:  ENSG00000269028+ENSG00000164326-ENSG00000269028+ENSG00000198763-ENSG00000164326
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 342.81894736842105]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 117.06315789473685]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 41.13894736842105]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 19.74105263157895]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.67578947368421, 19.74105263157895]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=12.364210526315789
radius= 2.8781360052525997 average number of neighbors for each spot is 12.364210526315789
 Cluster 5 has neighbors:
Dmain  1 :  1478
Dmain  2 :  371
SVGs for domain  5 : ['ENSG00000167996', 'ENSG00000197971', 'ENSG00000123560']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198899
Absolute mean change: 1.7747116
Number of non-target spots reduced to: 1282
===========================================================================
Meta gene is:  ENSG00000167996+ENSG00000197971-ENSG00000198899
===========================================================================
Add gene:  ENSG00000105695
Minus gene:  ENSG00000132639
Absolute mean change: 2.3702314
Number of non-target spots reduced to: 145
===========================================================================
Meta gene is:  ENSG00000167996+ENSG00000197971-ENSG00000198899+ENSG00000105695-ENSG00000132639
===========================================================================
Add gene:  ENSG00000198899
Minus gene:  ENSG00000234745
Stopped! Previous Number of non-target spots 145 61 2.3702314 1.9622805
Previous Number of non-target spots 145 61 2.3702314 1.9622805
Previous Number of non-target spots 145
Current Number of non-target spots 61
Absolute mean change 2.3702314
===========================================================================
Meta gene:  ENSG00000167996+ENSG00000197971-ENSG00000198899+ENSG00000105695-ENSG00000132639
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.029386520385742], num_nbr [1.0, 326.5660377358491]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.221800029277802], num_nbr [1.0, 103.47169811320755]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.318006783723831], num_nbr [1.0, 37.056603773584904]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.366110160946846], num_nbr [1.0, 18.547169811320753]
Calculateing adj matrix using xy only...
Run 5: radius [2.3901618495583534, 3.366110160946846], num_nbr [8.452830188679245, 18.547169811320753]
Calculateing adj matrix using xy only...
recommended radius =  2.8781360052525997 num_nbr=11.88679245283019
radius= 2.8781360052525997 average number of neighbors for each spot is 11.88679245283019
 Cluster 6 has neighbors:
No neighbor domain found, try bigger radius or smaller ratio.
Found no neighbors for domain 6 . No SVGs will be found for this domain.
