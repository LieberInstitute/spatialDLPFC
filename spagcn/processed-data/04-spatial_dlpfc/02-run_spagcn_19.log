Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br6471_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  342.3481825716773 606.479201954341 326.2980477878763
Var of x,y,z =  21604525.063871 29153533.43061607 29153533.430616066
Run 1: l [0.01, 1000], p [0.0, 20.658413639785746]
Run 2: l [0.01, 500.005], p [0.0, 2.990900993347168]
Run 3: l [250.0075, 500.005], p [0.3695716857910156, 2.990900993347168]
Run 4: l [250.0075, 375.00625], p [0.3695716857910156, 1.292217493057251]
Run 5: l [250.0075, 312.50687500000004], p [0.3695716857910156, 0.7461123466491699]
Run 6: l [250.0075, 281.2571875], p [0.3695716857910156, 0.5382537841796875]
Run 7: l [265.63234375, 281.2571875], p [0.449221134185791, 0.5382537841796875]
recommended l =  273.444765625
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  7
recommended res =  0.7
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
delta_label  0.004755434782608696 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 61
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.873668188736682, 460.63774733637746]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.873668188736682, 157.72450532724505]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.873668188736682, 58.54946727549467]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.873668188736682, 24.374429223744293]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.753424657534246
radius= 3.027443051338196 average number of neighbors for each spot is 12.753424657534246
 Cluster 0 has neighbors:
Dmain  6 :  2096
Dmain  4 :  2030
Dmain  2 :  710
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 0 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 0!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.511169513797634, 406.8331143232589]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.511169513797634, 142.0486202365309]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.511169513797634, 53.681997371879106]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.511169513797634, 22.85413929040736]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.122207621550592
radius= 3.027443051338196 average number of neighbors for each spot is 12.122207621550592
 Cluster 1 has neighbors:
Dmain  3 :  1296
SVGs for domain  1 : ['ENSG00000131095']
Add gene:  ENSG00000269028
Minus gene:  ENSG00000197971
Absolute mean change: 2.0149543
Number of non-target spots reduced to: 597
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000269028-ENSG00000197971
===========================================================================
Add gene:  ENSG00000113140
Minus gene:  ENSG00000132639
Absolute mean change: 3.868791
Number of non-target spots reduced to: 121
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000269028-ENSG00000197971+ENSG00000113140-ENSG00000132639
===========================================================================
Add gene:  ENSG00000166710
Minus gene:  ENSG00000087460
Absolute mean change: 4.858867
Number of non-target spots reduced to: 19
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000269028-ENSG00000197971+ENSG00000113140-ENSG00000132639+ENSG00000166710-ENSG00000087460
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.657360406091371, 378.6446700507614]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.657360406091371, 138.0761421319797]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.657360406091371, 54.02791878172589]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.657360406091371, 23.269035532994923]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.307106598984772
radius= 3.027443051338196 average number of neighbors for each spot is 12.307106598984772
 Cluster 2 has neighbors:
Dmain  0 :  710
Dmain  4 :  441
SVGs for domain  2 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000107317', 'ENSG00000131095', 'ENSG00000244274', 'ENSG00000099194', 'ENSG00000109846', 'ENSG00000173786', 'ENSG00000160307']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Absolute mean change: 3.1498966
Number of non-target spots reduced to: 84
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000131095-ENSG00000132639
===========================================================================
Add gene:  ENSG00000123560
Minus gene:  ENSG00000113140
Absolute mean change: 4.6206727
Number of non-target spots reduced to: 43
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000131095-ENSG00000132639+ENSG00000123560-ENSG00000113140
===========================================================================
Add gene:  ENSG00000135940
Minus gene:  ENSG00000197746
Stopped! Previous Number of non-target spots 43 10 4.6206727 4.5402913
Previous Number of non-target spots 43 10 4.6206727 4.5402913
Previous Number of non-target spots 43
Current Number of non-target spots 10
Absolute mean change 4.6206727
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000131095-ENSG00000132639+ENSG00000123560-ENSG00000113140
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.610194902548725, 387.75262368815595]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.610194902548725, 138.94152923538232]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.610194902548725, 54.43328335832084]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.610194902548725, 23.24287856071964]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.275862068965518
radius= 3.027443051338196 average number of neighbors for each spot is 12.275862068965518
 Cluster 3 has neighbors:
Dmain  5 :  1901
Dmain  1 :  1296
Dmain  6 :  414
Dmain  4 :  392
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000101439']
Add gene:  ENSG00000145824
Minus gene:  ENSG00000197971
Absolute mean change: 1.0931194
Number of non-target spots reduced to: 1729
===========================================================================
Meta gene is:  ENSG00000101439+ENSG00000145824-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000152583
Stopped! Previous Number of non-target spots 1729 597 1.0931194 0.7110121
Previous Number of non-target spots 1729 597 1.0931194 0.7110121
Previous Number of non-target spots 1729
Current Number of non-target spots 597
Absolute mean change 1.0931194
===========================================================================
Meta gene:  ENSG00000101439+ENSG00000145824-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.875542691751086, 458.53111432706226]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.875542691751086, 156.83212735166424]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.875542691751086, 58.457308248914615]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.875542691751086, 24.36324167872648]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.755426917510853
radius= 3.027443051338196 average number of neighbors for each spot is 12.755426917510853
 Cluster 4 has neighbors:
Dmain  6 :  2360
Dmain  0 :  2030
Dmain  5 :  460
Dmain  2 :  441
Dmain  3 :  392
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000269028', 'ENSG00000197971', 'ENSG00000131095', 'ENSG00000110436']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000269028
Absolute mean change: 0.39607382
Number of non-target spots reduced to: 1957
===========================================================================
Meta gene is:  ENSG00000269028+ENSG00000197971-ENSG00000269028
===========================================================================
Add gene:  ENSG00000198763
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 1957 1201 0.39607382 0.15042472
Previous Number of non-target spots 1957 1201 0.39607382 0.15042472
Previous Number of non-target spots 1957
Current Number of non-target spots 1201
Absolute mean change 0.39607382
===========================================================================
Meta gene:  ENSG00000269028+ENSG00000197971-ENSG00000269028
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.799564270152505, 416.0152505446623]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.799564270152505, 146.76688453159042]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.799564270152505, 56.265795206971674]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.799564270152505, 23.864923747276688]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.577342047930284
radius= 3.027443051338196 average number of neighbors for each spot is 12.577342047930284
 Cluster 5 has neighbors:
Dmain  3 :  1901
Dmain  6 :  561
Dmain  4 :  460
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000130558', 'ENSG00000162545', 'ENSG00000187094', 'ENSG00000171617', 'ENSG00000128989', 'ENSG00000020129']
Add gene:  ENSG00000136099
Minus gene:  ENSG00000197971
Absolute mean change: 1.5216489
Number of non-target spots reduced to: 1127
===========================================================================
Meta gene is:  ENSG00000130558+ENSG00000136099-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000251562
Stopped! Previous Number of non-target spots 1127 328 1.5216489 0.9159248
Previous Number of non-target spots 1127 328 1.5216489 0.9159248
Previous Number of non-target spots 1127
Current Number of non-target spots 328
Absolute mean change 1.5216489
===========================================================================
Meta gene:  ENSG00000130558+ENSG00000136099-ENSG00000197971
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.903430749682338, 476.78017789072425]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.903430749682338, 160.17916137229986]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.903430749682338, 59.096569250317664]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.903430749682338, 24.52858958068615]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.810673443456162
radius= 3.027443051338196 average number of neighbors for each spot is 12.810673443456162
 Cluster 6 has neighbors:
Dmain  4 :  2360
Dmain  0 :  2096
Dmain  5 :  561
Dmain  3 :  414
SVGs for domain  6 : ['ENSG00000132639', 'ENSG00000154277', 'ENSG00000111640', 'ENSG00000143153', 'ENSG00000277586', 'ENSG00000080824', 'ENSG00000133318', 'ENSG00000104435']
Add gene:  ENSG00000173267
Minus gene:  ENSG00000187094
Absolute mean change: 1.4334018
Number of non-target spots reduced to: 179
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000173267-ENSG00000187094
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000135821
Stopped! Previous Number of non-target spots 179 275 1.4334018 1.9224551
Previous Number of non-target spots 179 275 1.4334018 1.9224551
Previous Number of non-target spots 179
Current Number of non-target spots 275
Absolute mean change 1.4334018
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000173267-ENSG00000187094
===========================================================================
