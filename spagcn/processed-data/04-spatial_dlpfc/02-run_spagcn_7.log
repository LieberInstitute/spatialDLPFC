Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br6423_ant...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  297.72496399889474 496.66346556954244 193.9442014890256
Var of x,y,z =  17923843.2282156 29176313.674814884 29176313.674814884
Run 1: l [0.01, 1000], p [0.0, 21.54759070668791]
Run 2: l [0.01, 500.005], p [0.0, 3.1590824127197266]
Run 3: l [250.0075, 500.005], p [0.37347519397735596, 3.1590824127197266]
Run 4: l [250.0075, 375.00625], p [0.37347519397735596, 1.3493220806121826]
Run 5: l [250.0075, 312.50687500000004], p [0.37347519397735596, 0.769823431968689]
Run 6: l [250.0075, 281.2571875], p [0.37347519397735596, 0.5504692792892456]
Run 7: l [265.63234375, 281.2571875], p [0.45689451694488525, 0.5504692792892456]
recommended l =  273.444765625
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
delta_label  0.00486431131592422 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 28
Res =  0.7 Num of clusters =  4
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  5
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  6
Res changed to 0.9999999999999999
Initializing cluster centers with louvain, resolution =  1.0999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.0999999999999999 Num of clusters =  6
Res changed to 1.0999999999999999
Initializing cluster centers with louvain, resolution =  1.2
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.2 Num of clusters =  7
recommended res =  1.2
Initializing cluster centers with louvain, resolution =  1.2
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
delta_label  0.00486431131592422 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 46
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.20465087890625], num_nbr [1.0, 403.52423900789177]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.309432208538055], num_nbr [1.0, 128.91995490417136]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.361822873353958], num_nbr [1.0, 43.70462232243518]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3880182057619095], num_nbr [1.0, 20.597519729425027]
Calculateing adj matrix using xy only...
Run 5: radius [2.401115871965885, 3.3880182057619095], num_nbr [8.890642615558061, 20.597519729425027]
Calculateing adj matrix using xy only...
recommended radius =  2.8945670388638973 num_nbr=12.795941375422773
radius= 2.8945670388638973 average number of neighbors for each spot is 12.795941375422773
 Cluster 0 has neighbors:
Dmain  6 :  1636
Dmain  5 :  561
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 0 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 0!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.20465087890625], num_nbr [1.0, 397.81325301204816]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.309432208538055], num_nbr [1.0, 124.45180722891567]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.361822873353958], num_nbr [1.0, 42.62198795180723]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3880182057619095], num_nbr [1.0, 20.253012048192772]
Calculateing adj matrix using xy only...
Run 5: radius [2.401115871965885, 3.3880182057619095], num_nbr [8.810240963855422, 20.253012048192772]
Calculateing adj matrix using xy only...
recommended radius =  2.8945670388638973 num_nbr=12.637048192771084
radius= 2.8945670388638973 average number of neighbors for each spot is 12.637048192771084
 Cluster 1 has neighbors:
Dmain  4 :  1992
Dmain  2 :  1801
Dmain  3 :  911
Dmain  5 :  269
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000256618']
Add gene:  ENSG00000203930
Minus gene:  ENSG00000163032
Absolute mean change: 0.3743198
Number of non-target spots reduced to: 814
===========================================================================
Meta gene is:  ENSG00000256618+ENSG00000203930-ENSG00000163032
===========================================================================
Add gene:  ENSG00000198727
Minus gene:  ENSG00000168314
Stopped! Previous Number of non-target spots 814 1378 0.3743198 1.4802942
Previous Number of non-target spots 814 1378 0.3743198 1.4802942
Previous Number of non-target spots 814
Current Number of non-target spots 1378
Absolute mean change 0.3743198
===========================================================================
Meta gene:  ENSG00000256618+ENSG00000203930-ENSG00000163032
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.20465087890625], num_nbr [1.0, 412.3501628664495]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.309432208538055], num_nbr [1.0, 127.26547231270358]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.361822873353958], num_nbr [1.0, 43.17915309446254]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3880182057619095], num_nbr [1.0, 20.44299674267101]
Calculateing adj matrix using xy only...
Run 5: radius [2.401115871965885, 3.3880182057619095], num_nbr [8.866449511400651, 20.44299674267101]
Calculateing adj matrix using xy only...
recommended radius =  2.8945670388638973 num_nbr=12.732899022801304
radius= 2.8945670388638973 average number of neighbors for each spot is 12.732899022801304
 Cluster 2 has neighbors:
Dmain  4 :  1975
Dmain  1 :  1801
Dmain  3 :  897
Dmain  5 :  269
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 2 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 2!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.20465087890625], num_nbr [1.0, 394.0271002710027]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.309432208538055], num_nbr [1.0, 122.94579945799458]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.361822873353958], num_nbr [1.0, 42.19241192411924]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3880182057619095], num_nbr [1.0, 20.097560975609756]
Calculateing adj matrix using xy only...
Run 5: radius [2.401115871965885, 3.3880182057619095], num_nbr [8.764227642276422, 20.097560975609756]
Calculateing adj matrix using xy only...
recommended radius =  2.8945670388638973 num_nbr=12.528455284552846
radius= 2.8945670388638973 average number of neighbors for each spot is 12.528455284552846
 Cluster 3 has neighbors:
Dmain  1 :  911
Dmain  2 :  897
Dmain  5 :  690
Dmain  4 :  437
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 3 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 3!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.20465087890625], num_nbr [1.0, 416.68971332209105]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.309432208538055], num_nbr [1.0, 128.56998313659358]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.361822873353958], num_nbr [1.0, 43.468802698145026]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3880182057619095], num_nbr [1.0, 20.504215851602023]
Calculateing adj matrix using xy only...
Run 5: radius [2.401115871965885, 3.3880182057619095], num_nbr [8.865092748735245, 20.504215851602023]
Calculateing adj matrix using xy only...
recommended radius =  2.8945670388638973 num_nbr=12.748735244519393
radius= 2.8945670388638973 average number of neighbors for each spot is 12.748735244519393
 Cluster 4 has neighbors:
Dmain  1 :  1992
Dmain  2 :  1975
Dmain  3 :  437
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000111640', 'ENSG00000143153', 'ENSG00000014641', 'ENSG00000109475', 'ENSG00000172809', 'ENSG00000176340', 'ENSG00000186010', 'ENSG00000265681', 'ENSG00000147403']
Add gene:  ENSG00000006128
Minus gene:  ENSG00000111640
Absolute mean change: 0.1373781
Number of non-target spots reduced to: 783
===========================================================================
Meta gene is:  ENSG00000111640+ENSG00000006128-ENSG00000111640
===========================================================================
Add gene:  ENSG00000212907
Minus gene:  ENSG00000006128
Absolute mean change: 0.5157669
Number of non-target spots reduced to: 303
===========================================================================
Meta gene is:  ENSG00000111640+ENSG00000006128-ENSG00000111640+ENSG00000212907-ENSG00000006128
===========================================================================
Add gene:  ENSG00000186010
Minus gene:  ENSG00000212907
Stopped! Previous Number of non-target spots 303 817 0.5157669 0.42054194
Previous Number of non-target spots 303 817 0.5157669 0.42054194
Previous Number of non-target spots 303
Current Number of non-target spots 817
Absolute mean change 0.5157669
===========================================================================
Meta gene:  ENSG00000111640+ENSG00000006128-ENSG00000111640+ENSG00000212907-ENSG00000006128
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.20465087890625], num_nbr [1.0, 380.7134670487106]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.309432208538055], num_nbr [1.0, 119.20630372492836]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.361822873353958], num_nbr [1.0, 41.03151862464183]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3880182057619095], num_nbr [1.0, 19.555873925501434]
Calculateing adj matrix using xy only...
Run 5: radius [2.401115871965885, 3.3880182057619095], num_nbr [8.558739255014327, 19.555873925501434]
Calculateing adj matrix using xy only...
recommended radius =  2.8945670388638973 num_nbr=12.223495702005732
radius= 2.8945670388638973 average number of neighbors for each spot is 12.223495702005732
 Cluster 5 has neighbors:
Dmain  3 :  690
Dmain  6 :  684
Dmain  0 :  561
Can't find any genes such that more spots in domain 5 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.20465087890625], num_nbr [1.0, 333.7372093023256]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.309432208538055], num_nbr [1.0, 111.61627906976744]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.361822873353958], num_nbr [1.0, 40.193023255813955]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3880182057619095], num_nbr [1.0, 19.506976744186048]
Calculateing adj matrix using xy only...
Run 5: radius [2.401115871965885, 3.3880182057619095], num_nbr [8.64186046511628, 19.506976744186048]
Calculateing adj matrix using xy only...
recommended radius =  2.8945670388638973 num_nbr=12.265116279069767
radius= 2.8945670388638973 average number of neighbors for each spot is 12.265116279069767
 Cluster 6 has neighbors:
Dmain  0 :  1636
Dmain  5 :  684
Can't find any genes such that more spots in domain 6 express the gene than its neighbors!
