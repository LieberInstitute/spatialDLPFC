Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br3942_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  341.230660826563 484.0109365746961 252.53216956951835
Var of x,y,z =  27711099.55686591 24117240.56186111 27711099.556865912
Run 1: l [0.01, 1000], p [0.0, 16.98216933726966]
Run 2: l [0.01, 500.005], p [0.0, 2.3343052864074707]
Run 3: l [250.0075, 500.005], p [0.26931560039520264, 2.3343052864074707]
Run 4: l [250.0075, 375.00625], p [0.26931560039520264, 0.9823868274688721]
Run 5: l [250.0075, 312.50687500000004], p [0.26931560039520264, 0.5569627285003662]
Run 6: l [281.2571875, 312.50687500000004], p [0.3973919153213501, 0.5569627285003662]
Run 7: l [296.88203125, 312.50687500000004], p [0.47305214405059814, 0.5569627285003662]
Run 8: l [296.88203125, 304.694453125], p [0.47305214405059814, 0.5139529705047607]
recommended l =  300.78824218750003
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  6
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  7
recommended res =  0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.82048872180451, 407.04135338345867]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.82048872180451, 146.7734962406015]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.82048872180451, 56.48872180451128]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.82048872180451, 23.973684210526315]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.62312030075188
radius= 3.027443051338196 average number of neighbors for each spot is 12.62312030075188
 Cluster 0 has neighbors:
Dmain  2 :  1730
Dmain  5 :  1687
Dmain  1 :  1677
Dmain  3 :  734
Dmain  6 :  446
Dmain  4 :  369
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 0 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 0!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.726102941176471, 396.2242647058824]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.726102941176471, 144.8125]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.726102941176471, 55.6875]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.726102941176471, 23.641544117647058]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.450367647058824
radius= 3.027443051338196 average number of neighbors for each spot is 12.450367647058824
 Cluster 1 has neighbors:
Dmain  5 :  1870
Dmain  0 :  1677
Dmain  3 :  621
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 1 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 1!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.955587392550143, 502.0974212034384]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.955587392550143, 165.10888252148996]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.955587392550143, 60.19627507163324]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.955587392550143, 24.797994269340975]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.916905444126074
radius= 3.027443051338196 average number of neighbors for each spot is 12.916905444126074
 Cluster 2 has neighbors:
Dmain  0 :  1730
Dmain  3 :  1340
Dmain  4 :  558
Dmain  5 :  495
Dmain  1 :  319
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 2 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 2!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.965909090909092, 493.7651515151515]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.965909090909092, 165.29924242424244]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.965909090909092, 60.28030303030303]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.965909090909092, 24.81628787878788]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.928030303030303
radius= 3.027443051338196 average number of neighbors for each spot is 12.928030303030303
 Cluster 3 has neighbors:
Dmain  2 :  1340
Dmain  5 :  893
Dmain  0 :  734
Dmain  1 :  621
Can't find any genes such that more spots in domain 3 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.868167202572348, 459.15273311897107]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.868167202572348, 155.91479099678457]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.868167202572348, 58.18327974276527]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.868167202572348, 24.310289389067524]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.733118971061094
radius= 3.027443051338196 average number of neighbors for each spot is 12.733118971061094
 Cluster 4 has neighbors:
Dmain  6 :  899
Dmain  2 :  558
SVGs for domain  4 : ['ENSG00000197971', 'ENSG00000123560', 'ENSG00000131095', 'ENSG00000099194', 'ENSG00000173786', 'ENSG00000109846', 'ENSG00000091513', 'ENSG00000168314', 'ENSG00000105695']
Add gene:  ENSG00000168314
Minus gene:  ENSG00000154146
Absolute mean change: 2.2588718
Number of non-target spots reduced to: 265
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000168314-ENSG00000154146
===========================================================================
Add gene:  ENSG00000167552
Minus gene:  ENSG00000065057
Absolute mean change: 2.267983
Number of non-target spots reduced to: 25
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000168314-ENSG00000154146+ENSG00000167552-ENSG00000065057
===========================================================================
Add gene:  ENSG00000011426
Minus gene:  ENSG00000111674
Stopped! Previous Number of non-target spots 25 40 2.267983 3.170419
Previous Number of non-target spots 25 40 2.267983 3.170419
Previous Number of non-target spots 25
Current Number of non-target spots 40
Absolute mean change 2.267983
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000168314-ENSG00000154146+ENSG00000167552-ENSG00000065057
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.828125, 422.1875]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.828125, 150.5640625]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.828125, 57.2375]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.828125, 24.1015625]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=12.6625
radius= 3.027443051338196 average number of neighbors for each spot is 12.6625
 Cluster 5 has neighbors:
Dmain  1 :  1870
Dmain  0 :  1687
Dmain  3 :  893
Dmain  2 :  495
Can't find any genes such that more spots in domain 5 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.439088821411133], num_nbr [8.279605263157896, 391.4703947368421]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.219544410705566], num_nbr [8.279605263157896, 134.58881578947367]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.109772205352783], num_nbr [8.279605263157896, 51.49013157894737]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.054886102676392], num_nbr [8.279605263157896, 22.075657894736842]
Calculateing adj matrix using xy only...
recommended radius =  3.027443051338196 num_nbr=11.677631578947368
radius= 3.027443051338196 average number of neighbors for each spot is 11.677631578947368
 Cluster 6 has neighbors:
Dmain  4 :  899
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 6 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 6 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 6!
