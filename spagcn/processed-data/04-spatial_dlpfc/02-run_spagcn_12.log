Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br8492_post...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  445.77151340140955 714.6923258819679 291.0265818846653
Var of x,y,z =  26511156.977617525 26851678.544596 26851678.544596
Run 1: l [0.01, 1000], p [0.0, 27.709503259604222]
Run 2: l [0.01, 500.005], p [0.0, 4.277775764465332]
Run 3: l [0.01, 250.0075], p [0.0, 0.5229928493499756]
Run 4: l [125.00874999999999, 250.0075], p [0.027730822563171387, 0.5229928493499756]
Run 5: l [187.508125, 250.0075], p [0.1905614137649536, 0.5229928493499756]
Run 6: l [218.7578125, 250.0075], p [0.3331791162490845, 0.5229928493499756]
Run 7: l [234.38265625, 250.0075], p [0.4218428134918213, 0.5229928493499756]
Run 8: l [242.195078125, 250.0075], p [0.47081542015075684, 0.5229928493499756]
recommended l =  246.1012890625
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  5
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  8
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.95 Num of clusters =  5
Res changed to 0.95
Initializing cluster centers with louvain, resolution =  1.0
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  1.0 Num of clusters =  8
Step changed to 0.025
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.975 Num of clusters =  7
recommended res =  0.975
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.975
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.83392539964476, 451.9333925399645]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.83392539964476, 158.58081705150977]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.83392539964476, 57.4582593250444]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.83392539964476, 24.159857904085257]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.674955595026644
radius= 3.0375672578811646 average number of neighbors for each spot is 12.674955595026644
 Cluster 0 has neighbors:
Dmain  5 :  3019
Dmain  2 :  2371
Dmain  1 :  1845
Dmain  4 :  1418
Dmain  7 :  606
Dmain  6 :  25
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000256618']
Add gene:  ENSG00000112531
Minus gene:  ENSG00000256618
Absolute mean change: 0.010196105
Number of non-target spots reduced to: 1249
===========================================================================
Meta gene is:  ENSG00000256618+ENSG00000112531-ENSG00000256618
===========================================================================
Add gene:  ENSG00000256618
Minus gene:  ENSG00000112531
Absolute mean change: 0.082757175
Number of non-target spots reduced to: 586
===========================================================================
Meta gene is:  ENSG00000256618+ENSG00000112531-ENSG00000256618+ENSG00000256618-ENSG00000112531
===========================================================================
Add gene:  ENSG00000112531
Minus gene:  ENSG00000256618
Stopped! Previous Number of non-target spots 586 1249 0.082757175 0.010196105
Previous Number of non-target spots 586 1249 0.082757175 0.010196105
Previous Number of non-target spots 586
Current Number of non-target spots 1249
Absolute mean change 0.082757175
===========================================================================
Meta gene:  ENSG00000256618+ENSG00000112531-ENSG00000256618+ENSG00000256618-ENSG00000112531
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.917933130699089, 489.4179331306991]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.917933130699089, 168.60030395136778]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.917933130699089, 59.70060790273556]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.917933130699089, 24.653495440729483]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.848024316109422
radius= 3.0375672578811646 average number of neighbors for each spot is 12.848024316109422
 Cluster 1 has neighbors:
Dmain  2 :  1951
Dmain  0 :  1845
Dmain  5 :  894
Dmain  4 :  719
Dmain  7 :  347
Dmain  6 :  18
Can't find any genes such that more spots in domain 1 express the gene than its neighbors!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.985185185185186, 521.594708994709]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.985185185185186, 173.24444444444444]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.985185185185186, 60.41798941798942]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.985185185185186, 24.87936507936508]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.964021164021164
radius= 3.0375672578811646 average number of neighbors for each spot is 12.964021164021164
 Cluster 2 has neighbors:
Dmain  0 :  2371
Dmain  1 :  1951
Dmain  4 :  1613
Dmain  5 :  798
Dmain  7 :  185
Dmain  6 :  36
SVGs for domain  2 : ['ENSG00000111640', 'ENSG00000132639']
Add gene:  ENSG00000154277
Minus gene:  ENSG00000111640
Absolute mean change: 0.68266976
Number of non-target spots reduced to: 444
===========================================================================
Meta gene is:  ENSG00000111640+ENSG00000154277-ENSG00000111640
===========================================================================
Add gene:  ENSG00000111640
Minus gene:  ENSG00000154277
Stopped! Previous Number of non-target spots 444 478 0.68266976 0.6729686
Previous Number of non-target spots 444 478 0.68266976 0.6729686
Previous Number of non-target spots 444
Current Number of non-target spots 478
Absolute mean change 0.68266976
===========================================================================
Meta gene:  ENSG00000111640+ENSG00000154277-ENSG00000111640
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.88, 495.06947368421055]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.88, 166.41473684210527]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.88, 58.70736842105263]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.88, 24.39578947368421]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.772631578947369
radius= 3.0375672578811646 average number of neighbors for each spot is 12.772631578947369
 Cluster 4 has neighbors:
Dmain  2 :  1613
Dmain  0 :  1418
Dmain  5 :  862
Dmain  1 :  719
Dmain  7 :  119
Dmain  6 :  19
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 4 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 4 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 4!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.604340567612688, 400.18196994991655]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.604340567612688, 145.00500834724542]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.604340567612688, 53.84390651085142]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.604340567612688, 23.096828046744573]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.22787979966611
radius= 3.0375672578811646 average number of neighbors for each spot is 12.22787979966611
 Cluster 5 has neighbors:
Dmain  0 :  3019
Dmain  1 :  894
Dmain  4 :  862
Dmain  7 :  831
Dmain  2 :  798
Dmain  6 :  7
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000131095', 'ENSG00000251562']
Add gene:  ENSG00000251562
Minus gene:  ENSG00000132639
Absolute mean change: 1.0426586
Number of non-target spots reduced to: 1518
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000132639
===========================================================================
Add gene:  ENSG00000100100
Minus gene:  ENSG00000154146
Absolute mean change: 1.7497416
Number of non-target spots reduced to: 413
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000132639+ENSG00000100100-ENSG00000154146
===========================================================================
Add gene:  ENSG00000228253
Minus gene:  ENSG00000111640
Absolute mean change: 2.5756888
Number of non-target spots reduced to: 201
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000251562-ENSG00000132639+ENSG00000100100-ENSG00000154146+ENSG00000228253-ENSG00000111640
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [9.0, 523.2222222222222]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [9.0, 176.88888888888889]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [9.0, 61.0]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [9.0, 25.0]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=13.0
radius= 3.0375672578811646 average number of neighbors for each spot is 13.0
 Cluster 6 has neighbors:
No neighbor domain found, try bigger radius or smaller ratio.
Found no neighbors for domain 6 . No SVGs will be found for this domain.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.601076126098633], num_nbr [8.903381642512077, 455.1304347826087]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.300538063049316], num_nbr [8.903381642512077, 161.12077294685992]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.150269031524658], num_nbr [8.903381642512077, 58.47342995169082]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.075134515762329], num_nbr [8.903381642512077, 24.454106280193237]
Calculateing adj matrix using xy only...
recommended radius =  3.0375672578811646 num_nbr=12.801932367149758
radius= 3.0375672578811646 average number of neighbors for each spot is 12.801932367149758
 Cluster 7 has neighbors:
Dmain  5 :  831
Dmain  0 :  606
Dmain  1 :  347
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 7 to find at least 1 SVG.
SVGs for domain  7 : ['ENSG00000171617', 'ENSG00000133169']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000131711
Absolute mean change: 0.8588042
Number of non-target spots reduced to: 1783
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000131711
===========================================================================
Add gene:  ENSG00000101439
Minus gene:  ENSG00000104435
Absolute mean change: 1.3583398
Number of non-target spots reduced to: 835
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000131711+ENSG00000101439-ENSG00000104435
===========================================================================
Add gene:  ENSG00000133169
Minus gene:  ENSG00000198763
Absolute mean change: 1.6076727
Number of non-target spots reduced to: 621
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000131711+ENSG00000101439-ENSG00000104435+ENSG00000133169-ENSG00000198763
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
