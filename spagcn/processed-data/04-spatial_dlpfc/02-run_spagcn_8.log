Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br6423_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  259.8576745632769 428.5203960867525 235.72852108627754
Var of x,y,z =  19065427.38271604 29218631.57390701 29218631.573907018
Run 1: l [0.01, 1000], p [0.0, 17.480907406735113]
Run 2: l [0.01, 500.005], p [0.0, 2.4057960510253906]
Run 3: l [250.0075, 500.005], p [0.27908480167388916, 2.4057960510253906]
Run 4: l [250.0075, 375.00625], p [0.27908480167388916, 1.0162100791931152]
Run 5: l [250.0075, 312.50687500000004], p [0.27908480167388916, 0.5770732164382935]
Run 6: l [281.2571875, 312.50687500000004], p [0.4118407964706421, 0.5770732164382935]
recommended l =  296.88203125
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  5
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  7
recommended res =  0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.957236842105264, 428.0855263157895]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.957236842105264, 138.94243421052633]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.957236842105264, 47.985197368421055]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.957236842105264, 20.76480263157895]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.90625
radius= 2.9539172649383545 average number of neighbors for each spot is 12.90625
 Cluster 0 has neighbors:
Dmain  1 :  2133
Dmain  2 :  2064
Dmain  3 :  556
Dmain  4 :  362
Dmain  6 :  354
Dmain  5 :  10
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000123560']
Add gene:  ENSG00000198899
Minus gene:  ENSG00000123560
Absolute mean change: 0.1299839
Number of non-target spots reduced to: 1087
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000198899-ENSG00000123560
===========================================================================
Add gene:  ENSG00000123560
Minus gene:  ENSG00000198899
Stopped! Previous Number of non-target spots 1087 1368 0.1299839 0.19953299
Previous Number of non-target spots 1087 1368 0.1299839 0.19953299
Previous Number of non-target spots 1087
Current Number of non-target spots 1368
Absolute mean change 0.1299839
===========================================================================
Meta gene:  ENSG00000123560+ENSG00000198899-ENSG00000123560
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.935448577680525, 413.0765864332604]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.935448577680525, 137.15645514223195]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.935448577680525, 47.79540481400438]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.935448577680525, 20.72428884026258]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.87089715536105
radius= 2.9539172649383545 average number of neighbors for each spot is 12.87089715536105
 Cluster 1 has neighbors:
Dmain  2 :  2925
Dmain  0 :  2133
Dmain  4 :  1223
Dmain  3 :  757
Dmain  6 :  490
Dmain  5 :  16
SVGs for domain  1 : ['ENSG00000154146', 'ENSG00000111640', 'ENSG00000132639', 'ENSG00000154277', 'ENSG00000128245', 'ENSG00000163399']
Add gene:  ENSG00000163399
Minus gene:  ENSG00000135821
Absolute mean change: 1.6995807
Number of non-target spots reduced to: 160
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000163399-ENSG00000135821
===========================================================================
Add gene:  ENSG00000135821
Minus gene:  ENSG00000152661
Absolute mean change: 1.7523284
Number of non-target spots reduced to: 141
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000163399-ENSG00000135821+ENSG00000135821-ENSG00000152661
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000135821
Absolute mean change: 2.6229725
Number of non-target spots reduced to: 118
===========================================================================
Meta gene is:  ENSG00000154146+ENSG00000163399-ENSG00000135821+ENSG00000135821-ENSG00000152661+ENSG00000171617-ENSG00000135821
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.873184898354308, 407.15488867376575]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.873184898354308, 134.53920619554694]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.873184898354308, 47.01161665053243]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.873184898354308, 20.466602129719263]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.73862536302033
radius= 2.9539172649383545 average number of neighbors for each spot is 12.73862536302033
 Cluster 2 has neighbors:
Dmain  1 :  2925
Dmain  0 :  2064
Dmain  3 :  1423
Dmain  4 :  1363
Dmain  6 :  879
Dmain  5 :  44
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000198886', 'ENSG00000198763', 'ENSG00000198888', 'ENSG00000198840', 'ENSG00000198899', 'ENSG00000198938', 'ENSG00000198804', 'ENSG00000198786', 'ENSG00000135821', 'ENSG00000110436', 'ENSG00000130203', 'ENSG00000079215', 'ENSG00000255823']
Add gene:  ENSG00000282885
Minus gene:  ENSG00000154146
Absolute mean change: 0.4400127
Number of non-target spots reduced to: 1330
===========================================================================
Meta gene is:  ENSG00000198886+ENSG00000282885-ENSG00000154146
===========================================================================
Add gene:  ENSG00000154146
Minus gene:  ENSG00000282885
Stopped! Previous Number of non-target spots 1330 841 0.4400127 0.11416054
Previous Number of non-target spots 1330 841 0.4400127 0.11416054
Previous Number of non-target spots 1330
Current Number of non-target spots 841
Absolute mean change 0.4400127
===========================================================================
Meta gene:  ENSG00000198886+ENSG00000282885-ENSG00000154146
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.278219395866454, 328.3783783783784]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.278219395866454, 112.55802861685214]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.278219395866454, 41.170111287758345]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.278219395866454, 18.53100158982512]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=11.705882352941176
radius= 2.9539172649383545 average number of neighbors for each spot is 11.705882352941176
 Cluster 3 has neighbors:
Dmain  2 :  1423
Dmain  1 :  757
Dmain  4 :  593
Dmain  0 :  556
Dmain  6 :  313
Dmain  5 :  16
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 3 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 3 to find at least 1 SVG.
SVGs for domain  3 : ['ENSG00000131095']
Add gene:  ENSG00000244734
Minus gene:  ENSG00000154146
Absolute mean change: 1.4159257
Number of non-target spots reduced to: 729
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000154146
===========================================================================
Add gene:  ENSG00000171885
Minus gene:  ENSG00000111640
Absolute mean change: 2.5062811
Number of non-target spots reduced to: 156
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000154146+ENSG00000171885-ENSG00000111640
===========================================================================
Add gene:  ENSG00000212907
Minus gene:  ENSG00000277586
Absolute mean change: 3.3038578
Number of non-target spots reduced to: 56
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000244734-ENSG00000154146+ENSG00000171885-ENSG00000111640+ENSG00000212907-ENSG00000277586
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.779475982532752, 340.2707423580786]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.779475982532752, 123.3995633187773]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.779475982532752, 45.23362445414847]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.779475982532752, 20.061135371179038]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.537117903930131
radius= 2.9539172649383545 average number of neighbors for each spot is 12.537117903930131
 Cluster 4 has neighbors:
Dmain  2 :  1363
Dmain  1 :  1223
Dmain  3 :  593
Dmain  0 :  362
SVGs for domain  4 : ['ENSG00000171617']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000154146
Absolute mean change: 0.87441206
Number of non-target spots reduced to: 629
===========================================================================
Meta gene is:  ENSG00000171617+ENSG00000115756-ENSG00000154146
===========================================================================
Add gene:  ENSG00000154146
Minus gene:  ENSG00000115756
Stopped! Previous Number of non-target spots 629 521 0.87441206 0.747965
Previous Number of non-target spots 629 521 0.87441206 0.747965
Previous Number of non-target spots 629
Current Number of non-target spots 521
Absolute mean change 0.87441206
===========================================================================
Meta gene:  ENSG00000171617+ENSG00000115756-ENSG00000154146
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [8.8, 457.46666666666664]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [8.8, 140.4]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [8.8, 47.53333333333333]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [8.8, 20.4]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=12.666666666666666
radius= 2.9539172649383545 average number of neighbors for each spot is 12.666666666666666
 Cluster 5 has neighbors:
No neighbor domain found, try bigger radius or smaller ratio.
Found no neighbors for domain 5 . No SVGs will be found for this domain.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 17.262676239013672], num_nbr [9.0, 471.0183486238532]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 9.631338119506836], num_nbr [9.0, 144.81039755351682]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 5.815669059753418], num_nbr [9.0, 48.97553516819572]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 3.907834529876709], num_nbr [9.0, 21.0]
Calculateing adj matrix using xy only...
recommended radius =  2.9539172649383545 num_nbr=13.0
radius= 2.9539172649383545 average number of neighbors for each spot is 13.0
 Cluster 6 has neighbors:
Dmain  2 :  879
Dmain  1 :  490
Dmain  0 :  354
Dmain  5 :  87
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000034510', 'ENSG00000087460', 'ENSG00000117632', 'ENSG00000197971', 'ENSG00000123560']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000171617
Absolute mean change: 1.4239156
Number of non-target spots reduced to: 803
===========================================================================
Meta gene is:  ENSG00000034510+ENSG00000183036-ENSG00000171617
===========================================================================
Add gene:  ENSG00000087460
Minus gene:  ENSG00000198899
Absolute mean change: 2.1890793
Number of non-target spots reduced to: 197
===========================================================================
Meta gene is:  ENSG00000034510+ENSG00000183036-ENSG00000171617+ENSG00000087460-ENSG00000198899
===========================================================================
Add gene:  ENSG00000112137
Minus gene:  ENSG00000104722
Absolute mean change: 2.578303
Number of non-target spots reduced to: 102
===========================================================================
Meta gene is:  ENSG00000034510+ENSG00000183036-ENSG00000171617+ENSG00000087460-ENSG00000198899+ENSG00000112137-ENSG00000104722
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
