Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br6522_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  545.7001603056119 929.3903602082238 449.6552165036405
Var of x,y,z =  17686963.326307308 26042693.973274678 26042693.973274678
Run 1: l [0.01, 1000], p [0.0, 15.144508093097336]
Run 2: l [0.01, 500.005], p [0.0, 2.099034309387207]
Run 3: l [250.0075, 500.005], p [0.25129175186157227, 2.099034309387207]
Run 4: l [250.0075, 375.00625], p [0.25129175186157227, 0.8958178758621216]
Run 5: l [250.0075, 312.50687500000004], p [0.25129175186157227, 0.5131402015686035]
Run 6: l [281.2571875, 312.50687500000004], p [0.3683035373687744, 0.5131402015686035]
Run 7: l [296.88203125, 312.50687500000004], p [0.4370943307876587, 0.5131402015686035]
Run 8: l [304.694453125, 312.50687500000004], p [0.4741917848587036, 0.5131402015686035]
recommended l =  308.6006640625
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
delta_label  0.004778338200159278 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 46
Res =  0.7 Num of clusters =  8
Initializing cluster centers with louvain, resolution =  0.6
Epoch  0
Epoch  10
Epoch  20
delta_label  0.003981948500132732 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 25
Res =  0.6 Num of clusters =  7
recommended res =  0.6
Initializing cluster centers with louvain, resolution =  0.6
Epoch  0
Epoch  10
Epoch  20
Epoch  30
delta_label  0.004247411733474914 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 31
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.0880069732666], num_nbr [1.0, 407.38823529411764]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.251110255718231], num_nbr [1.0, 129.52436974789916]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.332661896944046], num_nbr [1.0, 43.7781512605042]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3734377175569534], num_nbr [1.0, 20.625210084033615]
Calculateing adj matrix using xy only...
Run 5: radius [2.393825627863407, 3.3734377175569534], num_nbr [8.905882352941177, 20.625210084033615]
Calculateing adj matrix using xy only...
recommended radius =  2.8836316727101803 num_nbr=12.810084033613446
radius= 2.8836316727101803 average number of neighbors for each spot is 12.810084033613446
 Cluster 0 has neighbors:
Dmain  1 :  1437
Dmain  4 :  781
Dmain  6 :  456
SVGs for domain  0 : ['ENSG00000189043', 'ENSG00000154277', 'ENSG00000067715', 'ENSG00000164919', 'ENSG00000014641', 'ENSG00000111775', 'ENSG00000034510', 'ENSG00000127184', 'ENSG00000132639', 'ENSG00000111640', 'ENSG00000123416', 'ENSG00000173915', 'ENSG00000131711', 'ENSG00000277586', 'ENSG00000173660', 'ENSG00000104435', 'ENSG00000100097', 'ENSG00000173267', 'ENSG00000183036']
Add gene:  ENSG00000183036
Minus gene:  ENSG00000162545
Absolute mean change: 1.4211798
Number of non-target spots reduced to: 425
===========================================================================
Meta gene is:  ENSG00000189043+ENSG00000183036-ENSG00000162545
===========================================================================
Add gene:  ENSG00000173915
Minus gene:  ENSG00000131095
Absolute mean change: 2.5959768
Number of non-target spots reduced to: 236
===========================================================================
Meta gene is:  ENSG00000189043+ENSG00000183036-ENSG00000162545+ENSG00000173915-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000110436
Stopped! Previous Number of non-target spots 236 135 2.5959768 2.3471322
Previous Number of non-target spots 236 135 2.5959768 2.3471322
Previous Number of non-target spots 236
Current Number of non-target spots 135
Absolute mean change 2.5959768
===========================================================================
Meta gene:  ENSG00000189043+ENSG00000183036-ENSG00000162545+ENSG00000173915-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.0880069732666], num_nbr [1.0, 388.56211562115624]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.251110255718231], num_nbr [1.0, 124.78351783517836]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.332661896944046], num_nbr [1.0, 42.51168511685117]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3734377175569534], num_nbr [1.0, 20.127921279212792]
Calculateing adj matrix using xy only...
Run 5: radius [2.393825627863407, 3.3734377175569534], num_nbr [8.74169741697417, 20.127921279212792]
Calculateing adj matrix using xy only...
recommended radius =  2.8836316727101803 num_nbr=12.539975399753997
radius= 2.8836316727101803 average number of neighbors for each spot is 12.539975399753997
 Cluster 1 has neighbors:
Dmain  6 :  2049
Dmain  0 :  1437
Dmain  2 :  1128
Dmain  4 :  599
Dmain  3 :  406
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
SVGs for domain  1 : ['ENSG00000212907']
Add gene:  ENSG00000282885
Minus gene:  ENSG00000132639
Absolute mean change: 0.49287963
Number of non-target spots reduced to: 1320
===========================================================================
Meta gene is:  ENSG00000212907+ENSG00000282885-ENSG00000132639
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000131095
Absolute mean change: 0.5831244
Number of non-target spots reduced to: 898
===========================================================================
Meta gene is:  ENSG00000212907+ENSG00000282885-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 898 1008 0.5831244 0.49287963
Previous Number of non-target spots 898 1008 0.5831244 0.49287963
Previous Number of non-target spots 898
Current Number of non-target spots 1008
Absolute mean change 0.5831244
===========================================================================
Meta gene:  ENSG00000212907+ENSG00000282885-ENSG00000132639+ENSG00000132639-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.0880069732666], num_nbr [1.0, 396.00506756756755]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.251110255718231], num_nbr [1.0, 122.51689189189189]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.332661896944046], num_nbr [1.0, 40.972972972972975]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3734377175569534], num_nbr [1.0, 19.363175675675677]
Calculateing adj matrix using xy only...
Run 5: radius [2.393825627863407, 3.3734377175569534], num_nbr [8.440878378378379, 19.363175675675677]
Calculateing adj matrix using xy only...
recommended radius =  2.8836316727101803 num_nbr=12.074324324324325
radius= 2.8836316727101803 average number of neighbors for each spot is 12.074324324324325
 Cluster 2 has neighbors:
Dmain  1 :  1128
Dmain  6 :  322
Dmain  3 :  270
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 2 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 2 to find at least 1 SVG.
SVGs for domain  2 : ['ENSG00000131095']
Add gene:  ENSG00000282885
Minus gene:  ENSG00000167996
Absolute mean change: 1.5259807
Number of non-target spots reduced to: 1307
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000282885-ENSG00000167996
===========================================================================
Add gene:  ENSG00000269028
Minus gene:  ENSG00000197971
Absolute mean change: 2.7788727
Number of non-target spots reduced to: 221
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000282885-ENSG00000167996+ENSG00000269028-ENSG00000197971
===========================================================================
Add gene:  ENSG00000113140
Minus gene:  ENSG00000154146
Absolute mean change: 4.49435
Number of non-target spots reduced to: 80
===========================================================================
Meta gene is:  ENSG00000131095+ENSG00000282885-ENSG00000167996+ENSG00000269028-ENSG00000197971+ENSG00000113140-ENSG00000154146
===========================================================================
Warning: dropping one or more meta genes for this domain when forming CSV, since we are only taking the first 5.
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.0880069732666], num_nbr [1.0, 288.6861313868613]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.251110255718231], num_nbr [1.0, 102.23844282238443]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.332661896944046], num_nbr [1.0, 36.632603406326034]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3734377175569534], num_nbr [1.0, 18.070559610705597]
Calculateing adj matrix using xy only...
Run 5: radius [2.393825627863407, 3.3734377175569534], num_nbr [8.265206812652067, 18.070559610705597]
Calculateing adj matrix using xy only...
recommended radius =  2.8836316727101803 num_nbr=11.525547445255475
radius= 2.8836316727101803 average number of neighbors for each spot is 11.525547445255475
 Cluster 3 has neighbors:
Dmain  6 :  256
SVGs for domain  3 : ['ENSG00000111674', 'ENSG00000034510', 'ENSG00000102003', 'ENSG00000123416', 'ENSG00000101210', 'ENSG00000137267', 'ENSG00000131711', 'ENSG00000010404', 'ENSG00000172757', 'ENSG00000067715', 'ENSG00000104888', 'ENSG00000104435', 'ENSG00000123560', 'ENSG00000109107', 'ENSG00000125814', 'ENSG00000107317', 'ENSG00000155980', 'ENSG00000197971', 'ENSG00000135472', 'ENSG00000105409', 'ENSG00000104722', 'ENSG00000166963', 'ENSG00000168993', 'ENSG00000131095']
Add gene:  ENSG00000101439
Minus gene:  ENSG00000014641
Absolute mean change: 0.8458395
Number of non-target spots reduced to: 282
===========================================================================
Meta gene is:  ENSG00000111674+ENSG00000101439-ENSG00000014641
===========================================================================
Add gene:  ENSG00000154146
Minus gene:  ENSG00000237949
Stopped! Previous Number of non-target spots 282 573 0.8458395 2.0606608
Previous Number of non-target spots 282 573 0.8458395 2.0606608
Previous Number of non-target spots 282
Current Number of non-target spots 573
Absolute mean change 0.8458395
===========================================================================
Meta gene:  ENSG00000111674+ENSG00000101439-ENSG00000014641
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.0880069732666], num_nbr [1.0, 394.72745490981964]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.251110255718231], num_nbr [1.0, 127.83967935871743]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.332661896944046], num_nbr [1.0, 43.22645290581163]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3734377175569534], num_nbr [1.0, 20.416833667334668]
Calculateing adj matrix using xy only...
Run 5: radius [2.393825627863407, 3.3734377175569534], num_nbr [8.843687374749498, 20.416833667334668]
Calculateing adj matrix using xy only...
recommended radius =  2.8836316727101803 num_nbr=12.705410821643287
radius= 2.8836316727101803 average number of neighbors for each spot is 12.705410821643287
 Cluster 4 has neighbors:
Dmain  0 :  781
Dmain  1 :  599
Dmain  5 :  534
SVGs for domain  4 : ['ENSG00000170315', 'ENSG00000120885', 'ENSG00000167552', 'ENSG00000154096', 'ENSG00000109472', 'ENSG00000050165', 'ENSG00000165023', 'ENSG00000171246']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000154146
Absolute mean change: 1.1173711
Number of non-target spots reduced to: 998
===========================================================================
Meta gene is:  ENSG00000170315+ENSG00000197971-ENSG00000154146
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000197971
Stopped! Previous Number of non-target spots 998 492 1.1173711 0.6307905
Previous Number of non-target spots 998 492 1.1173711 0.6307905
Previous Number of non-target spots 998
Current Number of non-target spots 492
Absolute mean change 1.1173711
===========================================================================
Meta gene:  ENSG00000170315+ENSG00000197971-ENSG00000154146
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.0880069732666], num_nbr [1.0, 308.28612716763007]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.251110255718231], num_nbr [1.0, 110.97398843930635]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.332661896944046], num_nbr [1.0, 40.20520231213873]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3734377175569534], num_nbr [1.0, 19.479768786127167]
Calculateing adj matrix using xy only...
Run 5: radius [2.393825627863407, 3.3734377175569534], num_nbr [8.630057803468208, 19.479768786127167]
Calculateing adj matrix using xy only...
recommended radius =  2.8836316727101803 num_nbr=12.254335260115607
radius= 2.8836316727101803 average number of neighbors for each spot is 12.254335260115607
 Cluster 5 has neighbors:
Dmain  4 :  534
SVGs for domain  5 : ['ENSG00000123560', 'ENSG00000131095', 'ENSG00000173786', 'ENSG00000109846', 'ENSG00000099194', 'ENSG00000244274', 'ENSG00000091513', 'ENSG00000168314', 'ENSG00000129538', 'ENSG00000080822', 'ENSG00000242808']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Absolute mean change: 4.2838497
Number of non-target spots reduced to: 59
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000131095-ENSG00000132639
===========================================================================
Meta gene is:  ENSG00000123560+ENSG00000131095-ENSG00000132639
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [1.4142135381698608, 17.0880069732666], num_nbr [1.0, 399.0508806262231]
Calculateing adj matrix using xy only...
Run 2: radius [1.4142135381698608, 9.251110255718231], num_nbr [1.0, 128.7710371819961]
Calculateing adj matrix using xy only...
Run 3: radius [1.4142135381698608, 5.332661896944046], num_nbr [1.0, 43.62818003913895]
Calculateing adj matrix using xy only...
Run 4: radius [1.4142135381698608, 3.3734377175569534], num_nbr [1.0, 20.589041095890412]
Calculateing adj matrix using xy only...
Run 5: radius [2.393825627863407, 3.3734377175569534], num_nbr [8.911937377690803, 20.589041095890412]
Calculateing adj matrix using xy only...
recommended radius =  2.8836316727101803 num_nbr=12.800391389432486
radius= 2.8836316727101803 average number of neighbors for each spot is 12.800391389432486
 Cluster 6 has neighbors:
Dmain  1 :  2049
Dmain  0 :  456
Dmain  2 :  322
Dmain  3 :  256
SVGs for domain  6 : ['ENSG00000128989', 'ENSG00000128656', 'ENSG00000162545', 'ENSG00000171617', 'ENSG00000187094', 'ENSG00000171867', 'ENSG00000020129', 'ENSG00000171476']
Add gene:  ENSG00000171476
Minus gene:  ENSG00000197971
Absolute mean change: 2.3354301
Number of non-target spots reduced to: 431
===========================================================================
Meta gene is:  ENSG00000128989+ENSG00000171476-ENSG00000197971
===========================================================================
Add gene:  ENSG00000171617
Minus gene:  ENSG00000135821
Absolute mean change: 3.32691
Number of non-target spots reduced to: 96
===========================================================================
Meta gene is:  ENSG00000128989+ENSG00000171476-ENSG00000197971+ENSG00000171617-ENSG00000135821
===========================================================================
Add gene:  ENSG00000135821
Minus gene:  ENSG00000123560
Absolute mean change: 4.015847
Number of non-target spots reduced to: 77
===========================================================================
Meta gene is:  ENSG00000128989+ENSG00000171476-ENSG00000197971+ENSG00000171617-ENSG00000135821+ENSG00000135821-ENSG00000123560
===========================================================================
