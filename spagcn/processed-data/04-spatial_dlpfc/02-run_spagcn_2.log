Loading LIBD module for spagcn/1.2.0
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Trying to set attribute `.obs` of view, copying.
WARNING: It seems you use rank_genes_groups on the raw count data. Please logarithmize your data before calling rank_genes_groups.
Continuing with sample Br2743_mid...
Calculateing adj matrix using histology image...
Var of c0,c1,c2 =  312.17203106884875 529.841646517975 200.83654681639226
Var of x,y,z =  23625925.672484912 26709639.178343743 26709639.178343743
Run 1: l [0.01, 1000], p [0.0, 20.395168555018746]
Run 2: l [0.01, 500.005], p [0.0, 2.856581926345825]
Run 3: l [250.0075, 500.005], p [0.33422160148620605, 2.856581926345825]
Run 4: l [250.0075, 375.00625], p [0.33422160148620605, 1.2114384174346924]
Run 5: l [250.0075, 312.50687500000004], p [0.33422160148620605, 0.6896224021911621]
recommended l =  281.2571875
Start at res =  0.7 step =  0.1
Initializing cluster centers with louvain, resolution =  0.7
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7 Num of clusters =  5
Initializing cluster centers with louvain, resolution =  0.7999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.7999999999999999 Num of clusters =  6
Res changed to 0.7999999999999999
Initializing cluster centers with louvain, resolution =  0.8999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.8999999999999999 Num of clusters =  6
Res changed to 0.8999999999999999
Initializing cluster centers with louvain, resolution =  0.9999999999999999
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.9999999999999999 Num of clusters =  8
Step changed to 0.05
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Res =  0.95 Num of clusters =  7
recommended res =  0.95
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
delta_label  0.004710315591144607 < tol  0.005
Reach tolerance threshold. Stopping training.
Total epoch: 103
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Initializing cluster centers with louvain, resolution =  0.95
Epoch  0
Epoch  10
Epoch  20
Epoch  30
Epoch  40
Epoch  50
Epoch  60
Epoch  70
Epoch  80
Epoch  90
Epoch  100
Epoch  110
Epoch  120
Epoch  130
Epoch  140
Epoch  150
Epoch  160
Epoch  170
Epoch  180
Epoch  190
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.11077117919922], num_nbr [8.817927170868348, 443.5280112044818]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.05538558959961], num_nbr [8.817927170868348, 147.61484593837534]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.027692794799805], num_nbr [8.817927170868348, 57.675070028011206]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.013846397399902], num_nbr [8.817927170868348, 24.11484593837535]
Calculateing adj matrix using xy only...
recommended radius =  3.006923198699951 num_nbr=12.635854341736694
radius= 3.006923198699951 average number of neighbors for each spot is 12.635854341736694
 Cluster 0 has neighbors:
Dmain  3 :  1979
Dmain  1 :  1963
Dmain  4 :  985
Dmain  5 :  822
Dmain  2 :  366
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 0 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 0 to find at least 1 SVG.
SVGs for domain  0 : ['ENSG00000255823', 'ENSG00000198786', 'ENSG00000269028', 'ENSG00000228253', 'ENSG00000164241']
Add gene:  ENSG00000197971
Minus gene:  ENSG00000255823
Stopped! Previous Number of non-target spots 4246 1638 0 -0.03516698
Previous Number of non-target spots 4246 1638 0 -0.03516698
Previous Number of non-target spots 4246
Current Number of non-target spots 1638
Absolute mean change 0
===========================================================================
Meta gene:  ENSG00000255823
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.11077117919922], num_nbr [8.836538461538462, 424.7802197802198]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.05538558959961], num_nbr [8.836538461538462, 145.4120879120879]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.027692794799805], num_nbr [8.836538461538462, 57.52884615384615]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.013846397399902], num_nbr [8.836538461538462, 24.15934065934066]
Calculateing adj matrix using xy only...
recommended radius =  3.006923198699951 num_nbr=12.67445054945055
radius= 3.006923198699951 average number of neighbors for each spot is 12.67445054945055
 Cluster 1 has neighbors:
Dmain  0 :  1963
Dmain  3 :  1880
Dmain  5 :  1166
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.5000000000000001 and "min_fold_change" to  1.0625 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.40000000000000013 and "min_fold_change" to  1.03125 for domain 1 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.30000000000000016 and "min_fold_change" to  1.015625 for domain 1 to find at least 1 SVG.
No "fold_change" > 1.01 exists that finds any SVGs for domain 1!
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.11077117919922], num_nbr [8.908474576271187, 441.52372881355933]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.05538558959961], num_nbr [8.908474576271187, 149.6949152542373]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.027692794799805], num_nbr [8.908474576271187, 58.728813559322035]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.013846397399902], num_nbr [8.908474576271187, 24.47966101694915]
Calculateing adj matrix using xy only...
recommended radius =  3.006923198699951 num_nbr=12.808474576271186
radius= 3.006923198699951 average number of neighbors for each spot is 12.808474576271186
 Cluster 2 has neighbors:
Dmain  4 :  898
Dmain  6 :  500
Dmain  0 :  366
SVGs for domain  2 : ['ENSG00000197971', 'ENSG00000131095']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Absolute mean change: 2.8416579
Number of non-target spots reduced to: 126
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000131095-ENSG00000132639
===========================================================================
Add gene:  ENSG00000064787
Minus gene:  ENSG00000105409
Absolute mean change: 3.7920523
Number of non-target spots reduced to: 42
===========================================================================
Meta gene is:  ENSG00000197971+ENSG00000131095-ENSG00000132639+ENSG00000064787-ENSG00000105409
===========================================================================
Add gene:  ENSG00000132639
Minus gene:  ENSG00000071553
Stopped! Previous Number of non-target spots 42 34 3.7920523 3.033659
Previous Number of non-target spots 42 34 3.7920523 3.033659
Previous Number of non-target spots 42
Current Number of non-target spots 34
Absolute mean change 3.7920523
===========================================================================
Meta gene:  ENSG00000197971+ENSG00000131095-ENSG00000132639+ENSG00000064787-ENSG00000105409
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.11077117919922], num_nbr [8.9652870493992, 476.0694259012016]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.05538558959961], num_nbr [8.9652870493992, 155.63818424566088]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.027692794799805], num_nbr [8.9652870493992, 60.040053404539385]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.013846397399902], num_nbr [8.9652870493992, 24.790387182910546]
Calculateing adj matrix using xy only...
recommended radius =  3.006923198699951 num_nbr=12.927903871829105
radius= 3.006923198699951 average number of neighbors for each spot is 12.927903871829105
 Cluster 3 has neighbors:
Dmain  0 :  1979
Dmain  1 :  1880
Dmain  4 :  1357
Dmain  5 :  514
SVGs for domain  3 : ['ENSG00000132639', 'ENSG00000034510', 'ENSG00000111640', 'ENSG00000154277', 'ENSG00000160014', 'ENSG00000139970', 'ENSG00000133318']
Add gene:  ENSG00000034510
Minus gene:  ENSG00000198888
Absolute mean change: 1.9345889
Number of non-target spots reduced to: 117
===========================================================================
Meta gene is:  ENSG00000132639+ENSG00000034510-ENSG00000198888
===========================================================================
Add gene:  ENSG00000198888
Minus gene:  ENSG00000123560
Stopped! Previous Number of non-target spots 117 67 1.9345889 1.8902678
Previous Number of non-target spots 117 67 1.9345889 1.8902678
Previous Number of non-target spots 117
Current Number of non-target spots 67
Absolute mean change 1.9345889
===========================================================================
Meta gene:  ENSG00000132639+ENSG00000034510-ENSG00000198888
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.11077117919922], num_nbr [8.91976516634051, 481.4168297455969]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.05538558959961], num_nbr [8.91976516634051, 154.36594911937377]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.027692794799805], num_nbr [8.91976516634051, 59.34442270058708]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.013846397399902], num_nbr [8.91976516634051, 24.58512720156556]
Calculateing adj matrix using xy only...
recommended radius =  3.006923198699951 num_nbr=12.847358121330725
radius= 3.006923198699951 average number of neighbors for each spot is 12.847358121330725
 Cluster 4 has neighbors:
Dmain  3 :  1357
Dmain  0 :  985
Dmain  2 :  898
Dmain  5 :  368
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 4 to find at least 1 SVG.
SVGs for domain  4 : ['ENSG00000120885', 'ENSG00000104888', 'ENSG00000187094', 'ENSG00000150625', 'ENSG00000050165', 'ENSG00000088986', 'ENSG00000105696', 'ENSG00000165023', 'ENSG00000171246']
Add gene:  ENSG00000131095
Minus gene:  ENSG00000198712
Absolute mean change: 0.81212616
Number of non-target spots reduced to: 1181
===========================================================================
Meta gene is:  ENSG00000120885+ENSG00000131095-ENSG00000198712
===========================================================================
Add gene:  ENSG00000187094
Minus gene:  ENSG00000131095
Stopped! Previous Number of non-target spots 1181 760 0.81212616 0.7369807
Previous Number of non-target spots 1181 760 0.81212616 0.7369807
Previous Number of non-target spots 1181
Current Number of non-target spots 760
Absolute mean change 0.81212616
===========================================================================
Meta gene:  ENSG00000120885+ENSG00000131095-ENSG00000198712
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.11077117919922], num_nbr [8.758558558558558, 389.8774774774775]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.05538558959961], num_nbr [8.758558558558558, 137.81621621621622]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.027692794799805], num_nbr [8.758558558558558, 55.72792792792793]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.013846397399902], num_nbr [8.758558558558558, 23.715315315315316]
Calculateing adj matrix using xy only...
recommended radius =  3.006923198699951 num_nbr=12.520720720720721
radius= 3.006923198699951 average number of neighbors for each spot is 12.520720720720721
 Cluster 5 has neighbors:
Dmain  1 :  1166
Dmain  0 :  822
Dmain  6 :  552
Dmain  3 :  514
Dmain  4 :  368
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 5 to find at least 1 SVG.
Warning: lowering "min_in_group_fraction" to  0.6000000000000001 and "min_fold_change" to  1.125 for domain 5 to find at least 1 SVG.
SVGs for domain  5 : ['ENSG00000198763', 'ENSG00000198804', 'ENSG00000198888', 'ENSG00000198899', 'ENSG00000198840', 'ENSG00000198886', 'ENSG00000198727', 'ENSG00000087250', 'ENSG00000101439', 'ENSG00000162545', 'ENSG00000171617', 'ENSG00000020129', 'ENSG00000128989', 'ENSG00000214548']
Add gene:  ENSG00000115756
Minus gene:  ENSG00000131711
Absolute mean change: 0.8430116
Number of non-target spots reduced to: 1027
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000115756-ENSG00000131711
===========================================================================
Add gene:  ENSG00000131711
Minus gene:  ENSG00000131095
Absolute mean change: 0.9101546
Number of non-target spots reduced to: 578
===========================================================================
Meta gene is:  ENSG00000198763+ENSG00000115756-ENSG00000131711+ENSG00000131711-ENSG00000131095
===========================================================================
Add gene:  ENSG00000131095
Minus gene:  ENSG00000132639
Stopped! Previous Number of non-target spots 578 691 0.9101546 0.6882436
Previous Number of non-target spots 578 691 0.9101546 0.6882436
Previous Number of non-target spots 578
Current Number of non-target spots 691
Absolute mean change 0.9101546
===========================================================================
Meta gene:  ENSG00000198763+ENSG00000115756-ENSG00000131711+ENSG00000131711-ENSG00000131095
===========================================================================
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Calculateing adj matrix using xy only...
Run 1: radius [2.0, 18.11077117919922], num_nbr [8.007518796992482, 311.31829573934834]
Calculateing adj matrix using xy only...
Run 2: radius [2.0, 10.05538558959961], num_nbr [8.007518796992482, 114.72932330827068]
Calculateing adj matrix using xy only...
Run 3: radius [2.0, 6.027692794799805], num_nbr [8.007518796992482, 47.771929824561404]
Calculateing adj matrix using xy only...
Run 4: radius [2.0, 4.013846397399902], num_nbr [8.007518796992482, 20.952380952380953]
Calculateing adj matrix using xy only...
recommended radius =  3.006923198699951 num_nbr=11.275689223057643
radius= 3.006923198699951 average number of neighbors for each spot is 11.275689223057643
 Cluster 6 has neighbors:
Dmain  5 :  552
Dmain  2 :  500
Warning: lowering "min_in_group_fraction" to  0.7000000000000001 and "min_fold_change" to  1.25 for domain 6 to find at least 1 SVG.
SVGs for domain  6 : ['ENSG00000251562']
Add gene:  ENSG00000197943
Minus gene:  ENSG00000132639
Absolute mean change: 1.734745
Number of non-target spots reduced to: 1799
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000197943-ENSG00000132639
===========================================================================
Add gene:  ENSG00000212907
Minus gene:  ENSG00000197971
Absolute mean change: 2.7038631
Number of non-target spots reduced to: 164
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000197943-ENSG00000132639+ENSG00000212907-ENSG00000197971
===========================================================================
Add gene:  ENSG00000197971
Minus gene:  ENSG00000198668
Absolute mean change: 2.8681002
Number of non-target spots reduced to: 56
===========================================================================
Meta gene is:  ENSG00000251562+ENSG00000197943-ENSG00000132639+ENSG00000212907-ENSG00000197971+ENSG00000197971-ENSG00000198668
===========================================================================
